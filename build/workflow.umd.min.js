!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("raphael"));else if("function"==typeof define&&define.amd)define(["raphael"],e);else{var n="object"==typeof exports?e(require("raphael")):e(t.raphael);for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}("undefined"!=typeof self?self:this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return i(t,null,[{key:"clone",value:function(t){t="object"==(void 0===t?"undefined":r(t))?t:{};return $.extend(!0,{},t)}},{key:"ArrayMergeSameValue",value:function(t){if("object"==(void 0===t?"undefined":r(t))&&t.length&&t.length>1){for(var e={},n=[],i=0;i<t.length;i++)e[t[i]]||(n.push(t[i]),e[t[i]]=!0);t=n}return t}},{key:"each",value:function(t,e){if("object"==(void 0===t?"undefined":r(t)))if($.isArray(t))for(var n=0;n<t.length&&!1!==e(n,t[n]);n++);else for(var i in t)if(!1===e(i,t[i]))break}}]),t}();e.Util=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fromLine=[],this.toLine=[],this.NodeType=null}return r(t,[{key:"recordLine",value:function(t,e){"from"==t?this.fromLine.push(e):"to"==t&&this.toLine.push(e)}},{key:"syncLineMove",value:function(t){"function"!=typeof t&&(t=function(t,e){});for(var e=this.fromLine,n=this.toLine,r=0;r<e.length;r++){var i=e[r].c;i.attr("path");t(i,"from",e[r])}for(var o=0;o<n.length;o++){t(n[o].c,"to",n[o])}}},{key:"toJson",value:function(){var t={NodeType:this.NodeType,opt:this.opt,c:{attr:this.c.attr()}};return this.label&&(t.label={attr:this.label.attr()}),t}}]),t}();e.default=i},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.NodeJudge=e.NodeOperation=e.NodeEndpoint=e.NodeArrow=e.NodeLine=e.Flow=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=(n(0),r(n(7))),a=r(n(8)),u=r(n(3)),c=r(n(9)),s=r(n(10)),l=r(n(11)),f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.paper=e}return i(t,[{key:"endpoint",value:function(t,e,n,r){var i=new o.default(this.paper);return i.create(t,e,n,r),i}},{key:"judge",value:function(t,e,n,r,i){var o=new u.default(this.paper);return o.create(t,e,n,r,i),o}},{key:"operation",value:function(t,e,n,r,i){var o=new a.default(this.paper);return o.create(t,e,n,r,i),o}},{key:"line",value:function(t,e){var n=new c.default(this.paper);return n.create(t,e),n}},{key:"rightAngleLine",value:function(t){var e=new c.default(this.paper);return e.RightAngle(t),e}},{key:"arrow",value:function(t,e,n){var r=new s.default(this.paper);return r.create(t,e,n),r}},{key:"bow",value:function(t){var e=new l.default(this.paper);return e.create(t),e}},{key:"getEmptyNode",value:function(t){var e=null;switch(t){case"endpoint":e=new o.default(this.paper);break;case"judge":e=new u.default(this.paper);break;case"operation":e=new a.default(this.paper);break;case"line":e=new c.default(this.paper);break;case"arrow":e=new s.default(this.paper)}return e}}]),t}();e.Flow=f,e.NodeLine=c.default,e.NodeArrow=s.default,e.NodeEndpoint=o.default,e.NodeOperation=a.default,e.NodeJudge=u.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(1)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.NodeType="judge",n.instance=t,n.opt={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"onlyCell",value:function(t,e,n,r){this.opt={cx:t,cy:e,w:n,h:r};var i=this.getAp(),o=this.getBp(),a=this.getCp(),u=this.getDp();return this.instance.path("M"+i.x+","+i.y+"L"+o.x+","+o.y+"L"+a.x+","+a.y+"L"+u.x+","+u.y+"Z")}},{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":r(t))){var e=arguments;t={cx:e[0],cy:e[1],w:e[2],h:e[3]},e[4]&&(t.text=e[4])}this.opt=t,this.minWidth=t.w;var n=this.getAp(),i=this.getBp(),o=this.getCp(),a=this.getDp();this.c=this.instance.path("M"+n.x+","+n.y+"L"+i.x+","+i.y+"L"+o.x+","+o.y+"L"+a.x+","+a.y+"Z");var u;u=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=u,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("w");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=25,this.opt.w=e,this.resizeByOpt()}}},{key:"resizeByOpt",value:function(){var t=this.getAp(),e=this.getBp(),n=this.getCp(),r=this.getDp();this.c.attr("path",[["M",t.x,t.y],["L",e.x,e.y],["L",n.x,n.y],["L",r.x,r.y],["Z"]])}},{key:"move",value:function(t,e){var n=this.getCpByAp(t,e),r=this.getBp(n.x,n.y),i=this.getCp(n.x,n.y),o=this.getDp(n.x,n.y);this.c.attr("path",[["M",t,e],["L",r.x,r.y],["L",i.x,i.y],["L",o.x,o.y],["Z"]]),this.opt.cx=n.x,this.opt.cy=n.y,this.label.attr(n)}},{key:"ToSyncLine",value:function(t,e){var n=this,r=this.getCpByAp(t,e);this.syncLineMove(function(t,e,i){var o,a=i.position;if("from"==e){o="get"+a.from+"p";var u=n[o](r.x,r.y),c=t.attr("path");c[0]=["M",u.x,u.y],t.attr("path",c)}else if("to"==e){o="get"+a.to+"p";var s=n[o](r.x,r.y),l=t.attr("path");l[l.length-1]=["L",s.x,s.y],t.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this,r=this.getCpByAp(t,e);this.syncLineMove(function(t,e,i){var o,a=i.position;if("from"==e){o="get"+a.from+"p";var u=n[o](r.x,r.y);i.updatePath([u.x,u.y])}else if("to"==e){o="get"+a.to+"p";var c=n[o](r.x,r.y);i.updatePath(null,[c.x,c.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"D")+"p"]();this.isCoincidence(e,"from")&&(e=this.getCp(),t="C");return{x:e.x,y:e.y,position:t}}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"B")+"p"]();return e.position=t,e}},{key:"getCpByAp",value:function(t,e){return t+=this.opt.w/2,{x:t,y:e}}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.h/2,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.h/2,{x:t,y:e}}},{key:"isCoincidence",value:function(t,e){var n=!1;if(t&&"object"==(void 0===t?"undefined":r(t))&&void 0!==t.x&&void 0!==t.y)if("from"==e){if(this.fromLine.length>0)for(var i=0;i<this.fromLine.length;i++){if((u=(a=this.fromLine[i].c.attr("path"))[0])[1]==t.x&&u[2]==t.y){n=!0;break}}}else if("to"==e&&this.toLine.length>0)for(var o=0;o<this.toLine.length;o++){var a,u;if((u=(a=this.toLine[o].c.attr("path"))[a.length-1])[1]==t.x&&u[2]==t.y){n=!0;break}}return n}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=0,a={},u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return i(t,null,[{key:"createInstance",value:function(t){return(t="object"==(void 0===t?"undefined":r(t))?t:{}).dom,"string"==typeof t.dom&&(t.dom=$(t.dom)),t.w||(t.w=parseInt(1.1*$(window).width())),t.h||(t.h=parseInt(1.1*$(window).height())),Raphael(t.dom.get(0),t.w,t.h)}},{key:"onMoveEvt",value:function(){}},{key:"onStartEvt",value:function(){}},{key:"onEndEvt",value:function(){}},{key:"getIndex",value:function(){return o+=1}},{key:"src",value:function(t,e,n){a[t]||(a[t]={});var r=a[t];return void 0===e?r:void 0===n?r[e]||null:void(r[e]=n)}}]),t}();e.default=u},function(t,e,n){"use strict";var r,i,o=function(t){return t&&t.__esModule?t:{default:t}}(n(6));r=[n(14)],void 0===(i=function(t){return window.Raphael=t,o.default}.apply(e,r))||(t.exports=i)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(2),u=n(0),c=r(n(4)),s=r(n(12)),l=r(n(13)),f=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$index=c.default.getIndex(),this.config=u.Util.clone(e),this.$raphael=c.default.createInstance(this.config),this.$flow=new a.Flow(this.$raphael),this.setOption(n),this.leastLineQue=[],this.draw()}return o(t,[{key:"cNodeMap",value:function(t,e){var n=c.default.src(this.$index,"CodeNodeMaps");return n||(n={}),t?e?(n[t]=e,c.default.src(this.$index,"CodeNodeMaps",n),this):n[t]||!1:n}},{key:"draw2",value:function(){var t=this;if(this.option){var e=this.option.step;this.codeIndex(e);for(var n=this.config,r=n.x||parseInt(.4*n.w),i=n.y||10,o=n.cH||50,a=n.dH||30,c={},s=function(e){var n=t.codeIndex(e),r=null;return n&&n.length>0&&u.Util.each(n,function(t,e){if(c[e])return r=c[e].y,!1}),r},l=function(e){var n=t.codeIndex(e),r=n.length,i=0;return u.Util.each(n,function(t,e){c[e]&&(i+=1)}),r-i},f=0;f<e.length;f++){var h=e[f],p=h.code,y=h.name||p,v=this.cNodeMap(p),d=!1;if(v&&(d=!0),!d)if(1==h.type)i+=a+o/2,(v=this.$flow.endpoint(r,i,o/2,y)).c.attr("fill","rgb(181, 216, 126)"),v.$step=h,this.drag(v),i+=o/2;else if(2==h.type){var g=100,x=this.codeIndex(p),b=r;if(h.prev&&-1==h.prev.indexOf(",")){var w=this.getNodeByCode(h.prev);w&&w.c&&(b=this.getStandX(w))}if(x&&x.length>1){var m=l(p),k=Math.ceil(x.length/2),M=b+(25+g)*(k-m),P=s(p);P?M=b+(25+g)*(k-m):i+=a+o/2,P=P||i,v=this.$flow.operation(M,P,g,o,y),c[p]={y:i}}else i+=a+o/2,v=this.$flow.operation(b,i,g,o,y);v.$step=h,this.drag(v),v.c.attr("fill","rgb(224, 223, 226)"),i+=o/2}else 3==h.type?(i+=a+o/2,(v=this.$flow.judge(r,i,g+60,o,y)).c.attr("fill","rgb(49, 174, 196)"),v.$step=h,this.drag(v),i+=o/2):9==h.type&&(i+=a+o/2,(v=this.$flow.endpoint(r,i,o/2,y)).c.attr("fill","rgb(34, 185, 41)"),v.$step=h,this.drag(v));v&&(d?this.line(v,h):(this.cNodeMap(p,v),this.line(v),this._eventBind(v)))}}}},{key:"checkPaperHight",value:function(t){var e=this.config.dom.find("svg"),n=e.height();n<t+180&&e.css({height:n+80})}},{key:"draw",value:function(){var t=this;this.getNodeCls();var e=c.default.src(this.$index,"_nodeCls"),n=u.Util.clone(this.option),r=.21,i=this.conf("cH",50),o=this.conf("dH",30),a=this.conf("h"),s=e.clsValue,l=this.conf("sColumnMk",!0);r=l?.43:i*(s-1)+o*s<a?.43:r;var f=this.conf("x",parseInt(this.conf("w")*r)),h=f,p=this.conf("y",10),y=p,v=this.conf("bkgOperCol","rgb(224, 223, 226)"),d=this.conf("bkgJudgeCol","rgb(49, 174, 196)");this.conf("currentCode",!1);e.isMuti=function(t){var n=e.map[t];return e.mapDt[n].length>1},e.getMutiY=function(n,r){var i=0;r=r||0;var o=e.map[n],a=e.mapDt[o];return a.length>1&&u.Util.each(a,function(e,n){var r=t.getNodeByCode(n);if(r)return i=t.getStandY(r),!1}),i=i||r},e.getMutiCtt=function(n){var r=e.map[n],i=e.mapDt[r],o=i.length,a=0;return o>1&&u.Util.each(i,function(e,n){t.getNodeByCode(n)&&(a+=1)}),{len:o,hasEd:a}},u.Util.each(n.step,function(n,r){var u,c,s=r.type,g=r.code,x=r.name||g;switch(l?t.checkPaperHight(y):y+2*i>a&&(y=p,h+=f),s){case 1:y+=o,(u=t.$flow.endpoint(h,y,i/2,x)).c.attr("fill",t.conf("pkgStartCol","rgb(181, 216, 126)"));break;case 2:if(c=h,e.isMuti(g)){var b=e.getMutiY(g,null),w=e.getMutiCtt(g);if(2==w.len)w.hasEd>0&&(c+=50+1.5*i);else if(w.len>2){var m=Math.ceil(w.len/2);c+=(25+2*i)*(m-(w.len-w.hasEd))}b?y=b:y+=e.getMutiY(g,2*o+i/2)}else y+=2*o+i/2;(u=t.$flow.operation(c,y,100,i,x)).c.attr("fill",v);break;case 3:y+=2*o+i/2,(u=t.$flow.judge(h,y,100,i,x)).c.attr("fill",d);break;case 9:y+=2*o+i/2,(u=t.$flow.endpoint(h,y,i/2,x)).c.attr("fill",t.conf("bkgEndCol","rgb(34, 185, 41)"))}u&&(u.$step=r,u.c.data("_code",g),u.c.data("_type",s),t.cNodeMap(g,u),t.line(u),t._eventBind(u),t.drag(u))}),this.connectLeastLines()}},{key:"getNodeCls",value:function(){var t=u.Util.clone(this.option),e=0,n={},r={};u.Util.each(t.step,function(t,i){var o=i.prev,a=i.code;o&&n[o]&&(e=n[o]),e+=1,n[a]=e,r[e]?r[e].push(a):r[e]=[a]}),c.default.src(this.$index,"_nodeCls",{map:n,mapDt:r,clsValue:e})}},{key:"drag",value:function(t){!function(t,e){var n={};t.c.drag(function(r,i){r+=n.x,i+=n.y,t.move(r,i),!e.line||"arrow"!=e.line&&"bow"!=e.line?t.ToSyncLine(r,i):t.ToSyncArrow(r,i)},function(){var t,e;if("ellipse"==this.type)t=this.attr("cx"),e=this.attr("cy");else if("rect"==this.type)t=this.attr("x"),e=this.attr("y");else if("path"==this.type){var r=this.attr("path")[0];t=r[1],e=r[2]}n.x=t,n.y=e},function(){})}(t,this.config)}},{key:"line",value:function(t,e){var n=this,r=u.Util.clone(t.$step);if(r.prev&&(r.prev=r.prev.replace(/\s/g,"")),r.prev){var i,o=this.config,a=void 0===o.rightAngle||o.rightAngle,c=this.conf("bkgLineCol","rgb(14, 10, 10)"),s=function(t,e){var r,i=n.getNodeByCode(t),u=n.getNodeByCode(e);if(i&&u){if(o.line&&"arrow"==o.line){var s=i.getStlnP(),l=u.getEnlnP();(r=n.$flow.arrow([s.x,s.y],[l.x,l.y],o.arrowLen?o.arrowLen:4)).position={from:s.position,to:l.position},r.c.attr("fill",c)}else if(o.line&&"bow"==o.line){s=i.getStlnP(),l=u.getEnlnP();var f={queue:[{x:s.x,y:s.y},{x:l.x,y:l.y}]};(r=n.$flow.bow(f)).position={from:s.position,to:l.position},r.arrow.attr({fill:c,stroke:c})}else{s=i.getStlnP(),l=u.getEnlnP();(r=a?n.$flow.rightAngleLine({p1:{x:s.x,y:s.y},p2:{x:l.x,y:l.y}}):n.$flow.line([s.x,s.y],[l.x,l.y])).position={from:s.position,to:l.position}}i.recordLine("from",r),u.recordLine("to",r);var h=n.nodeRunedMk(e);if(h&&r){var p=n.conf("bkgRunedCol","rgb(255, 0, 0)");r.c.attr({stroke:p}),r.arrow&&r.arrow.attr({fill:p,stroke:p}),u.c.attr({stroke:p}),2==h&&i.c.attr({stroke:p})}}else n.leastLineQue.push({from:t,to:e})};i=(e=e||r).prev.indexOf(",")>-1?e.prev.split(","):[e.prev];for(var l=0;l<i.length;l++)s(i[l],e.code)}}},{key:"connectLeastLines",value:function(){var t=this,e=this.config,n=void 0===e.rightAngle||e.rightAngle,r=this.conf("bkgRunedCol","rgb(255, 0, 0)"),i=this.conf("bkgLineCol","rgb(14, 10, 10)");u.Util.each(this.leastLineQue,function(o,a){!function(o,a){var u,c=t.getNodeByCode(o),s=t.getNodeByCode(a);if(c&&s){if(e.line&&"arrow"==e.line){var l=c.getStlnP(),f=s.getEnlnP();(u=t.$flow.arrow([l.x,l.y],[f.x,f.y],e.arrowLen?e.arrowLen:4)).position={from:l.position,to:f.position},u.c.attr("fill",i)}else if(e.line&&"bow"==e.line){var h=3==c.c.data("_type"),p=(l=c.getStlnP(h?"A":null),!1);h&&(p=2==s.c.data("_type")?"L":"A"),f=s.getEnlnP(p);var y={queue:[{x:l.x,y:l.y},{x:l.x-50,y:l.y},{x:l.x-50,y:f.y},{x:f.x,y:f.y}]};(u=t.$flow.bow(y)).position={from:l.position,to:f.position},u.arrow.attr({fill:i,stroke:i})}else l=c.getStlnP(),f=s.getEnlnP(),(u=n?t.$flow.rightAngleLine({p1:{x:l.x,y:l.y},p2:{x:f.x,y:f.y}}):t.$flow.line([l.x,l.y],[f.x,f.y])).position={from:l.position,to:f.position};c.recordLine("from",u),s.recordLine("to",u);var v=t.nodeRunedMk(a);v&&u&&(u.c.attr({stroke:r}),u.arrow&&u.arrow.attr({fill:r,stroke:r}),s.c.attr({stroke:r}),2==v&&c.c.attr({stroke:r}))}}(a.from,a.to)})}},{key:"setOption",value:function(t){"object"==(void 0===t?"undefined":i(t))&&(this.option=u.Util.clone(t))}},{key:"getNodeByCode",value:function(t){var e=null,n=this.cNodeMap(t);return n&&(e=n),e}},{key:"codeIndex",value:function(t){if("object"==(void 0===t?"undefined":i(t))){for(var e={},n=0;n<t.length;n++){var r=t[n],o=r.code;if(r.prev)for(var a=r.prev.replace(/\s/g,"").split(","),s=0;s<a.length;s++){var l=a[s],f=e[l]?e[l]:0;if("object"==(void 0===f?"undefined":i(f))&&f.length&&(f=1==f.length?f[0]:f),f+=1,e[o]){if("object"!=i(e[o])){var h=e[o];e[o]=[h]}e[o].push(f),e[o]=u.Util.ArrayMergeSameValue(e[o])}else e[o]=f}else e[o]=1}c.default.src(this.$index,"clsMap",e)}else if(t){if(e=c.default.src(this.$index,"clsMap")){var p=e[t]||null,y=[t];for(var v in e)p==e[v]&&-1==$.inArray(v,y)&&y.push(v);return y}}}},{key:"getStandX",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cx");break;case"rect":e=n.attr("x")+n.attr("width")/2;break;case"path":e=t.opt.cx}}return e}},{key:"getStandY",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cy");break;case"rect":e=n.attr("y")+n.attr("height")/2;break;case"path":e=t.opt.cy}}return e}},{key:"removeBBox",value:function(){var t=this.cNodeMap();for(var e in t){var n=t[e];n.bBox&&n.bBox.remove()}}},{key:"_eventBind",value:function(t){var e=this;t.c.click(function(){e.removeBBox(),t.bBox&&t.bBox.remove();var n=this.getBBox();t.bBox=t.instance.rect(n.x-5,n.y-5,n.width+10,n.height+10),t.bBox.attr({stroke:e.conf("bkgNodeBox","rgb(15, 13, 105)")})});var n=this.conf("texteditor",!1),r=t.label;if(n&&r){var o=this.conf("texteditor");(o="object"==(void 0===o?"undefined":i(o))?o:{}).id=o.id?o.id:"worker-txteditor",o.class=o.class?o.class:"worker-txteditor-div",r.dblclick(function(){var e=r.attr("text"),n=$("#"+o.id);if(0==n.length){var i='<div class="'+o.class+'"><input type="text" id="'+o.id+'"></div>';$("body").append(i),n=$("#"+o.id)}n.show(),n.val(e),n.css({top:r.attr("y"),left:r.attr("x")}),n.focus(),n.off("blur").on("blur",function(){var e=$(this),n=e.val();n&&r.attr("text",n),e.hide(),"function"==typeof t.resizeByText&&t.resizeByText()})})}}},{key:"conf",value:function(t,e){return e=e||null,void 0!==this.config[t]&&(e=this.config[t]),e}},{key:"nodeRunedMk",value:function(t){var e=this.conf("currentCode",!1);if(e){var n=c.default.src(this.$index,"_nodeCls"),r=n.map[e],i=n.map[t];e=i<=r&&i}return e}}],[{key:"editor",value:function(t){return new s.default(t)}}]),t}();f.Version=l.default,e.default=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=(n(0),function(t){return t&&t.__esModule?t:{default:t}}(n(1))),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.NodeType="endpnt",n.instance=t,n.opt={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":r(t))){var e=arguments;t={cx:e[0],cy:e[1],r:e[2]},e[3]&&(t.text=e[3])}t.h=t.h?t.h:t.r,this.minWidth=2*t.r,this.opt=t,this.c=this.instance.ellipse(t.cx,t.cy,t.r,t.h);var n;n=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=n,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("rx");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=2,this.opt.r=e/2,this.resizeByOpt()}}},{key:"resizeByOpt",value:function(){var t=this.opt;this.c.attr({cx:t.cx,cy:t.cy,rx:t.r,ry:t.h})}},{key:"move",value:function(t,e){this.c.attr({cx:t,cy:e}),this.label.attr({x:t,y:e}),this.opt.cx=t,this.opt.cy=e}},{key:"ToSyncLine",value:function(t,e){var n=this;this.syncLineMove(function(r,i,o){var a,u=o.position;if("from"==i){var c=r.attr("path");a="get"+u.from+"p";var s=n[a](t,e);c[0]=["M",s.x,s.y],r.attr("path",c)}else if("to"==i){var l=r.attr("path");a="get"+u.to+"p";var f=n[a](t,e);l[l.length-1]=["L",f.x,f.y],r.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this;this.syncLineMove(function(r,i,o){var a,u=o.position;if("from"==i){a="get"+u.from+"p";var c=n[a](t,e);o.updatePath([c.x,c.y])}else if("to"==i){a="get"+u.to+"p";var s=n[a](t,e);o.updatePath(null,[s.x,s.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"D")+"p"]();return e.position=t,e}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"B")+"p"]();return e.position=t,e}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.r,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.r,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.r,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.r,{x:t,y:e}}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(1)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.NodeType="opera",n.instance=t,n.opt={},n.bBox=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":r(t))){var e=arguments;t={cx:e[0],cy:e[1],w:e[2],h:e[3]},e[4]&&(t.text=e[4])}this.opt=t,this.minWidth=t.w;var n=this.getAp();this.c=this.instance.rect(n.x,n.y,t.w,t.h);var i;i=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=i,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("w");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=10,this.opt.w=e;var r=this.getAp();this.c.attr({width:e,x:r.x,y:r.y})}}},{key:"move",value:function(t,e){var n=this.getCtpByAp(t,e);this.c.attr({x:t,y:e}),this.label.attr(n),this.opt.cx=t,this.opt.cy=e}},{key:"ToSyncLine",value:function(t,e){var n=this,r=this.getCtpByAp(t,e);this.syncLineMove(function(t,e,i){var o,a=i.position;if("from"==e){var u=t.attr("path");o="get"+a.from+"p";var c=n[o](r.x,r.y);u[0]=["M",c.x,c.y],t.attr("path",u)}else if("to"==e){o="get"+a.to+"p";var s=n[o](r.x,r.y),l=t.attr("path");l[l.length-1]=["L",s.x,s.y],t.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this,r=this.getCtpByAp(t,e);this.syncLineMove(function(t,e,i){var o,a=i.position;if("from"==e){o="get"+a.from+"p";var u=n[o](r.x,r.y);i.updatePath([u.x,u.y])}else if("to"==e){o="get"+a.to+"p";var c=n[o](r.x,r.y);i.updatePath(null,[c.x,c.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"Bt")+"p"]();return e.position=t,e}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"T")+"p"]();return e.position=t,e}},{key:"getCtpByAp",value:function(t,e){var n=this.opt;return t+=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e-=n.h/2,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getTp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.h/2,{x:t,y:e}}},{key:"getRp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,{x:t,y:e}}},{key:"getBtp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.h/2,{x:t,y:e}}},{key:"getLp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,{x:t,y:e}}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(0),o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.NodeType="line",this.instance=e,this.opt={},this.position={},this.rightAngle=!1}return r(t,[{key:"create",value:function(t,e){this.opt={p1:t,p2:e},this.c=this.instance.path("M"+t[0]+","+t[1]+"L"+e[0]+","+e[1])}},{key:"RightAngle",value:function(t){this.opt=t,this.rightAngle=!0;var e=t.p1,n=t.p2,r=20;t.d&&(r=t.d);var i="";if(e.x!=n.x&&e.y!=n.y){var o=n.x-e.x;i="L"+(e.x+o+r*(o>0?1:-1))+","+e.y+"L"+(e.x+o+r*(o>0?1:-1))+","+n.y}this.c=this.instance.path("M"+e.x+","+e.y+i+"L"+n.x+","+n.y)}},{key:"createByPoint",value:function(t){this.opt=t;var e="";i.Util.each(this.opt.points,function(t,n){n&&(e+=(e?"L":"M")+n.x+","+n.y)}),this.c=this.instance.path(e)}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.NodeType="arrow",this.instance=e,this.opt={},this.position={}}return r(t,[{key:"create",value:function(t,e,n){this.opt={p1:t,p2:e,r:n};var r=this.getPoints();this.c=this.instance.path("M"+t[0]+","+t[1]+"L"+e[0]+","+e[1]+"L"+r.cP.x+","+r.cP.y+"L"+r.dP.x+","+r.dP.y+"L"+e[0]+","+e[1])}},{key:"getPoints",value:function(t,e,n){var r=this.opt;t||(t=r.p1),e||(e=r.p2),n||(n=r.r);var i=Math.atan2(t[1]-e[1],e[0]-t[0])*(180/Math.PI),o=e[0]-n*Math.cos(i*(Math.PI/180)),a=e[1]+n*Math.sin(i*(Math.PI/180));return{cP:{x:o+n*Math.cos((i+120)*(Math.PI/180)),y:a-n*Math.sin((i+120)*(Math.PI/180))},dP:{x:o+n*Math.cos((i+240)*(Math.PI/180)),y:a-n*Math.sin((i+240)*(Math.PI/180))}}}},{key:"updatePath",value:function(t,e,n){var r=this.opt;t||(t=r.p1),e||(e=r.p2),n||(n=r.r);var i=this.getPoints(t,e,n);this.c.attr("path",[["M",t[0],t[1]],["L",e[0],e[1]],["L",i.cP.x,i.cP.y],["L",i.dP.x,i.dP.y],["L",e[0],e[1]]]),this.opt={p1:t,p2:e,r:n}}}]),t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.NodeType="bow",this.instance=e,this.opt={},this.position={}}return r(t,[{key:"create",value:function(t){this.opt=t,this.queueCheck(),this.bodySharp(),this.arrowSharp()}},{key:"arrowSharp",value:function(){var t=this.opt,e=t.queue,n=t.r?t.r:5,r=e.length,i=e[r-1],o=e[r-2],a=Math.atan2(o.y-i.y,i.x-o.x)*(180/Math.PI),u=i.x-n*Math.cos(a*(Math.PI/180)),c=i.y+n*Math.sin(a*(Math.PI/180)),s=u+n*Math.cos((a+120)*(Math.PI/180)),l=c-n*Math.sin((a+120)*(Math.PI/180)),f=u+n*Math.cos((a+240)*(Math.PI/180)),h=c-n*Math.sin((a+240)*(Math.PI/180));this.arrow?this.arrow.attr("path",[["M",i.x,i.y],["L",s,l],["L",f,h],["L",i.x,i.y]]):this.arrow=this.instance.path("M"+i.x+","+i.y+"L"+s+","+l+"L"+f+","+h+"L"+i.x+","+i.y)}},{key:"bodySharp",value:function(){var t=this.opt.queue,e="",n=[],r=!1,i=!0;r=!!this.c;for(var o=0;o<t.length;o++){var a=t[o];r?(i&&n.length>0&&(i=!1),n.push([i?"M":"L",a.x,a.y])):e+=(e?"L":"M")+","+a.x+","+a.y}r?this.c.attr("path",n):this.c=this.instance.path(e)}},{key:"queueCheck",value:function(){var t=this.opt.queue;if(2==t.length){var e=[],n=t[0],r=t[1];n.x<r.x?e.push({x:r.x,y:n.y}):n.x>r.x&&(e.push({x:n.x,y:r.y-20}),e.push({x:r.x,y:r.y-20})),this.opt.queue=[n].concat(e,r)}}},{key:"updatePath",value:function(t,e,n){var r=this.opt;if(t&&(r.queue[0]={x:t[0],y:t[1]}),e){var i=r.queue.length-1;r.queue[i]={x:e[0],y:e[1]}}this.queueCheck(),this.bodySharp(),this.arrowSharp()}}]),t}();e.default=i},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=r(n(4)),u=r(n(3)),c=n(2),s={type:1,text:"开始"},l={type:2,text:"流程"},f={type:3,text:"判断"},h={type:9,text:"结束"},p={type:1801,text:"箭头"},y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.raphael=a.default.createInstance(e),this._configMergeToDefule(),this._LineDragingP=null,this.flow=new c.Flow(this.raphael),this.nodes=[],this.lineQueues=[],this.tempNodes=[],this.MagneticCore=null,this._toolbar()}return o(t,[{key:"_configMergeToDefule",value:function(){var t=this.config.pkgClr||{};t.start=t.start||"rgb(181, 216, 126)",t.opera=t.opera||"rgb(224, 223, 226)",t.judge=t.judge||"rgb(49, 174, 196)",t.end=t.end||"rgb(34, 185, 41)",t.arrow=t.arrow||"rgb(3, 84, 41)",t.NodeBox=t.NodeBox||"rgb(15, 13, 105)",this.config.pkgClr=t,this.config.listener=this.config.listener||{}}},{key:"_toolbar",value:function(){var t={},e=this.raphael,n=5,r=5,i=this.config.pkgClr;t.containerIst=e.rect(5,5,75,300),t.containerIst.attr("fill","#ffffff"),n+=20,r+=50,t.startIst=e.ellipse(n,r,8,6),t.startIst.attr("fill",i.start),t.startTxtIst=e.text(n+30,r,s.text),r+=20,t.operaIst=e.rect(n-8,r,16,12),t.operaIst.attr("fill",i.opera),t.operaTxtIst=e.text(n+30,r+4,l.text),r+=30,t.judgeIst=new u.default(e).onlyCell(n,r,16,12),t.judgeIst.attr("fill",i.judge),t.judgeTxtIst=e.text(n+30,r,f.text),r+=30,t.endIst=e.ellipse(n,r,8,6),t.endIst.attr("fill",i.end),t.endTxtIst=e.text(n+30,r,h.text),r+=30,t.arrowIst=this.flow.arrow([n-5,r],[n+10,r],3),t.arrowIst.c.attr("fill",i.arrow),t.arrowTxtIst=e.text(n+30,r,p.text),this.$tool=t,this._toolbarDragEvt()}},{key:"_toolbarDragEvt",value:function(){var t=this,e=this.config.pkgClr,n=function(e,n){t.MagneticCore=null;var r={};e.drag(function(e,n){e+=r.dx,n+=r.dy;var i=t.getLastElem();i&&i.move(e,n)},function(){var e,i;if(2==n)e=this.attr("x"),i=this.attr("y");else if(3==n){var o=this.attr("path")[0];e=o[1],i=o[2]}else e=this.attr("cx"),i=this.attr("cy");r.dx=e+5,r.dy=i+10,t._createNode(r,n)},function(){})};n(this.$tool.startIst,s.type),n(this.$tool.startTxtIst,s.type),n(this.$tool.operaIst,l.type),n(this.$tool.operaTxtIst,l.type),n(this.$tool.judgeIst,f.type),n(this.$tool.judgeTxtIst,f.type),n(this.$tool.endIst,h.type),n(this.$tool.endTxtIst,h.type);var r=function(n){var r={x:0,y:0},i=null;n.drag(function(t,e){t+=r.x,e+=r.y,i&&i.updatePath([t,e],[t+50,e])},function(){if("text"==n.type)r.x=n.attr("x"),r.y=n.attr("y");else{var o=n.attr("path");o=o[0],r.x=o[1],r.y=o[2]}(function(n){n.c.attr("fill",e.arrow),n.c.click(function(){t.removeBBox();var e=n.opt,r=t.raphael.circle(e.p1[0],e.p1[1],3);r.attr("fill","#000000");var i=t.raphael.circle(e.p2[0],e.p2[1],3);i.attr("fill","#000000");var o=function(e,r){var i={ax:0,ay:0};e.drag(function(e,o){e+=i.ax,o+=i.ay;var a=t.getIntersectElem({x:e,y:o});if(a){t.removeIntersectMk(),a.c.attr("fill","#FF0000"),a._IntersectMk=!0;var u;e=(u=r?a.getEnlnP():a.getStlnP()).x,o=u.y;var c=r?"to":"from";t.removeConLine(n,c),a.recordLine(c,n),n.position||(n.position={}),n.position[c]=u.position}r?(n.updatePath(null,[e,o]),this.data("type","to")):(n.updatePath([e,o]),this.data("type","from")),t.MagneticCore=this,this.attr({cx:e,cy:o})},function(){i.ax=this.attr("cx"),i.ay=this.attr("cy")},function(){t.MagneticCore=null})};o(r),o(i,!0),t.tempNodes.push(r,i)})})(i=t.flow.arrow([r.x,r.y],[r.x+50,r.y],5)),t.lineQueues.push(i)},function(){})};r(this.$tool.arrowIst.c),r(this.$tool.arrowTxtIst)}},{key:"removeBBox",value:function(){this.MagneticCore=null;for(var t=this.nodes,e=0;e<t.length;e++){var n=t[e];n.bBox&&(n.bBox.remove(),n.bBox=null)}for(var r=this.tempNodes,i=0;i<r.length;i++){r[i].remove()}this.removeIntersectMk(),this.tempNodes=[]}},{key:"removeNode",value:function(t){if(t||(t=this.getSelected()),t){var e="object"==(void 0===t?"undefined":i(t))?t:this.raphael.getById(t);if("object"==(void 0===e?"undefined":i(e))){var n=e.id;e.bBox&&(e.bBox.remove(),e.bBox=null),e.label&&(e.label.remove(),e.label=null),e.c.remove(),e=null;for(var r=this.nodes,o=[],a=0;a<r.length;a++){var u=r[a];n!=u.c.id&&o.push(u)}return!0}}return!1}},{key:"removeIntersectMk",value:function(){for(var t=this.nodes,e=null,n=0;n<t.length;n++){var r=t[n];if(r._IntersectMk){r._IntersectMk=!1;var i=r.NodeType,o=this.config.pkgClr;o[i]?r.c.attr("fill",o[i]):1==(i=r.c.data("type"))?r.c.attr("fill",o.start):9==i&&r.c.attr("fill",o.end),e=r}}return e}},{key:"removeConLine",value:function(t,e){if(t&&e)for(var n=this.nodes,r=t.c.id,i=0;i<n.length;i++){var o=n[i],a=e+"Line";if(o[a]&&o[a].length){for(var u=o[a],c=[],s=0;s<u.length;s++){var l=u[s];r!=l.c.id&&c.push(l)}o[a]=c}}return!1}},{key:"setOption",value:function(t,e){if(t){"object"!=(void 0===t?"undefined":i(t))&&(t={text:t}),e||(e=this.getSelected());var n="object"==(void 0===e?"undefined":i(e))?e:this.raphael.getById(e);t.text&&n.label&&(n.label.attr("text",t.text),n.opt=n.opt||{},n.opt.text=t.text,"function"==typeof n.resizeByText&&n.resizeByText())}return!1}},{key:"cloneNode",value:function(t){if(t||(t=this.getSelected()),t){var e="object"==(void 0===t?"undefined":i(t))?t:this.raphael.getById(t);if("object"==(void 0===e?"undefined":i(e))){e.id;return e.c.clone(),e.label.clone(),!0}}return!1}},{key:"getSelected",value:function(){for(var t=this.nodes,e=null,n=0;n<t.length;n++){var r=t[n];if(r.bBox){e=r;break}}for(var i=this.lineQueues,o=0;o<i.length;o++)i[o];return e}},{key:"getLastElem",value:function(){var t=null,e=this.nodes;return e.length>0&&(t=e[e.length-1]),t}},{key:"getFlowStep",value:function(){for(var t=[],e=this.nodes,n=0;n<e.length;n++){var r=e[n],i=this.getFlowJson(r);t.push(i)}return t}},{key:"getFlowJson",value:function(t){t||(t=this.getSelected());var e={};if(t){var n=t.label||null,r=t.c;e={name:n?n.attr("text"):"",code:r.id,type:r.data("type"),_struct:t.toJson()};for(var i=t.toLine,o=[],a=0;a<i.length;a++){(l=this.getLineCntCode("from",i[a].c.id,t))&&o.push(l)}e.prev=o.length>0?o.join(","):"";for(var u=t.fromLine,c=[],s=0;s<u.length;s++){var l;(l=this.getLineCntCode("to",u[s].c.id,t))&&c.push(l)}e.next=c.length>0?c.join(","):""}else e=null;return e}},{key:"getLineCntCode",value:function(t,e,n){if(t&&e){var r=this.nodes,i=null;n&&(i="string"==typeof n?n:n.c.id);for(var o=t+"Line",a=0;a<r.length;a++){var u=r[a],c=u.c.id;if(i!=c)for(var s=u[o],l=0;l<s.length;l++){if(e==s[l].c.id)return c}}}return null}},{key:"getIntersectElem",value:function(t){var e=null;if("object"==(void 0===t?"undefined":i(t)))for(var n=this.nodes,r=0;r<n.length;r++){var o=n[r],a=o.NodeType;if("endpnt"==a){var u=(f=o.c).attr("cx"),c=f.attr("cy"),s=f.attr("rx"),l=f.attr("ry");if(t.x>=u-s&&t.x<=u+s&&t.y>=c-l&&t.y<=c+l){e=o;break}}else if("opera"==a){var f,h=(f=o.c).attr("x"),p=f.attr("y"),y=f.attr("width"),v=f.attr("height");if(t.x>=h&&t.x<=h+y&&t.y>=p&&t.y<=p+v){e=o;break}}else if("judge"==a){var d=o.opt;u=d.cx,c=d.cy,v=d.h,y=d.w;if(t.x>=u-y/2&&t.x<=u+y/2&&t.y>=c-v/2&&t.y<=c+v/2){e=o;break}}}return e}},{key:"_createNode",value:function(t,e){var n=this,r=null,i=this.config.pkgClr;switch(e){case 1:(r=this.flow.endpoint(t.dx,t.dy,10,"开始")).c.attr("fill",i.start);break;case 2:(r=this.flow.operation(t.dx,t.dy,50,40,"操作流程")).c.attr("fill",i.opera);break;case 3:(r=this.flow.judge(t.dx,t.dy,50,40,"流程判断")).c.attr("fill",i.judge);break;case 9:(r=this.flow.endpoint(t.dx,t.dy,10,"结束")).c.attr("fill",i.end)}r&&(!function(){var t={};r.c.drag(function(e,n){e+=t.x,n+=t.y,r.move(e,n),r.ToSyncArrow(e,n)},function(){var e,n;if("ellipse"==this.type)e=this.attr("cx"),n=this.attr("cy");else if("rect"==this.type)e=this.attr("x"),n=this.attr("y");else if("path"==this.type){var r=this.attr("path")[0];e=r[1],n=r[2]}t.x=e,t.y=n},function(){t={x:0,y:0}})}(),r.c.click(function(){n.removeBBox();var t=this.getBBox();r.bBox=r.instance.rect(t.x-5,t.y-5,t.width+10,t.height+10),r.bBox.attr({stroke:i.NodeBox})}),r.c.data("type",e),this.nodes.push(r))}}]),t}();e.default=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={version:"1.1.3",release:"20180307",author:"Joshua Conero"}},function(e,n){e.exports=t}])});