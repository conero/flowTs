!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return o(t,null,[{key:"clone",value:function(t){t="object"==(void 0===t?"undefined":i(t))?t:{};return $.extend(!0,{},t)}},{key:"ArrayMergeSameValue",value:function(t){if("object"==(void 0===t?"undefined":i(t))&&t.length&&t.length>1){for(var e={},n=[],o=0;o<t.length;o++)e[t[o]]||(n.push(t[o]),e[t[o]]=!0);t=n}return t}},{key:"each",value:function(t,e){if("object"==(void 0===t?"undefined":i(t)))if($.isArray(t))for(var n=0;n<t.length&&!1!==e(n,t[n]);n++);else for(var o in t)if(!1===e(o,t[o]))break}}]),t}();e.Util=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fromLine=[],this.toLine=[]}return i(t,[{key:"recordLine",value:function(t,e){"from"==t?this.fromLine.push(e):"to"==t&&this.toLine.push(e)}},{key:"syncLineMove",value:function(t){"function"!=typeof t&&(t=function(t,e){});for(var e=this.fromLine,n=this.toLine,i=0;i<e.length;i++){var o=e[i].c;o.attr("path");t(o,"from",e[i])}for(var r=0;r<n.length;r++){t(n[r].c,"to",n[r])}}}]),t}();e.default=o},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.NodeJudge=e.NodeOperation=e.NodeEndpoint=e.NodeArrow=e.NodeLine=e.Flow=void 0;var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=(n(0),i(n(6))),a=i(n(7)),u=i(n(3)),c=i(n(8)),s=i(n(9)),l=i(n(10)),f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.paper=e}return o(t,[{key:"endpoint",value:function(t,e,n,i){var o=new r.default(this.paper);return o.create(t,e,n,i),o}},{key:"judge",value:function(t,e,n,i,o){var r=new u.default(this.paper);return r.create(t,e,n,i,o),r}},{key:"operation",value:function(t,e,n,i,o){var r=new a.default(this.paper);return r.create(t,e,n,i,o),r}},{key:"line",value:function(t,e){var n=new c.default(this.paper);return n.create(t,e),n}},{key:"rightAngleLine",value:function(t){var e=new c.default(this.paper);return e.RightAngle(t),e}},{key:"arrow",value:function(t,e,n){var i=new s.default(this.paper);return i.create(t,e,n),i}},{key:"bow",value:function(t){var e=new l.default(this.paper);return e.create(t),e}},{key:"getEmptyNode",value:function(t){var e=null;switch(t){case"endpoint":e=new r.default(this.paper);break;case"judge":e=new u.default(this.paper);break;case"operation":e=new a.default(this.paper);break;case"line":e=new c.default(this.paper);break;case"arrow":e=new s.default(this.paper)}return e}}]),t}();e.Flow=f,e.NodeLine=c.default,e.NodeArrow=s.default,e.NodeEndpoint=r.default,e.NodeOperation=a.default,e.NodeJudge=u.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.instance=t,n.opt={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),o(e,[{key:"onlyCell",value:function(t,e,n,i){this.opt={cx:t,cy:e,w:n,h:i};var o=this.getAp(),r=this.getBp(),a=this.getCp(),u=this.getDp();return this.instance.path("M"+o.x+","+o.y+"L"+r.x+","+r.y+"L"+a.x+","+a.y+"L"+u.x+","+u.y+"Z")}},{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":i(t))){var e=arguments;t={cx:e[0],cy:e[1],w:e[2],h:e[3]},e[4]&&(t.text=e[4])}this.opt=t,this.minWidth=t.w;var n=this.getAp(),o=this.getBp(),r=this.getCp(),a=this.getDp();this.c=this.instance.path("M"+n.x+","+n.y+"L"+o.x+","+o.y+"L"+r.x+","+r.y+"L"+a.x+","+a.y+"Z");var u;u=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=u,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("w");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=25,this.opt.w=e,this.resizeByOpt()}}},{key:"resizeByOpt",value:function(){var t=this.getAp(),e=this.getBp(),n=this.getCp(),i=this.getDp();this.c.attr("path",[["M",t.x,t.y],["L",e.x,e.y],["L",n.x,n.y],["L",i.x,i.y],["Z"]])}},{key:"move",value:function(t,e){var n=this.getCpByAp(t,e),i=this.getBp(n.x,n.y),o=this.getCp(n.x,n.y),r=this.getDp(n.x,n.y);this.c.attr("path",[["M",t,e],["L",i.x,i.y],["L",o.x,o.y],["L",r.x,r.y],["Z"]]),this.label.attr(n)}},{key:"ToSyncLine",value:function(t,e){var n=this,i=this.getCpByAp(t,e);this.syncLineMove(function(t,e,o){var r,a=o.position;if("from"==e){r="get"+a.from+"p";var u=n[r](i.x,i.y),c=t.attr("path");c[0]=["M",u.x,u.y],t.attr("path",c)}else if("to"==e){r="get"+a.to+"p";var s=n[r](i.x,i.y),l=t.attr("path");l[l.length-1]=["L",s.x,s.y],t.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this,i=this.getCpByAp(t,e);this.syncLineMove(function(t,e,o){var r,a=o.position;if("from"==e){r="get"+a.from+"p";var u=n[r](i.x,i.y);o.updatePath([u.x,u.y])}else if("to"==e){r="get"+a.to+"p";var c=n[r](i.x,i.y);o.updatePath(null,[c.x,c.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"D")+"p"]();this.isCoincidence(e,"from")&&(e=this.getCp(),t="C");return{x:e.x,y:e.y,position:t}}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"B")+"p"]();return e.position=t,e}},{key:"getCpByAp",value:function(t,e){return t+=this.opt.w/2,{x:t,y:e}}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.h/2,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.h/2,{x:t,y:e}}},{key:"isCoincidence",value:function(t,e){var n=!1;if(t&&"object"==(void 0===t?"undefined":i(t))&&void 0!==t.x&&void 0!==t.y)if("from"==e){if(this.fromLine.length>0)for(var o=0;o<this.fromLine.length;o++){if((u=(a=this.fromLine[o].c.attr("path"))[0])[1]==t.x&&u[2]==t.y){n=!0;break}}}else if("to"==e&&this.toLine.length>0)for(var r=0;r<this.toLine.length;r++){var a,u;if((u=(a=this.toLine[r].c.attr("path"))[a.length-1])[1]==t.x&&u[2]==t.y){n=!0;break}}return n}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=0,a={},u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return o(t,null,[{key:"createInstance",value:function(t){return(t="object"==(void 0===t?"undefined":i(t))?t:{}).dom,"string"==typeof t.dom&&(t.dom=$(t.dom)),t.w||(t.w=parseInt(1.1*$(window).width())),t.h||(t.h=parseInt(1.1*$(window).height())),Raphael(t.dom.get(0),t.w,t.h)}},{key:"onMoveEvt",value:function(){}},{key:"onStartEvt",value:function(){}},{key:"onEndEvt",value:function(){}},{key:"getIndex",value:function(){return r+=1}},{key:"src",value:function(t,e,n){a[t]||(a[t]={});var i=a[t];return void 0===e?i:void 0===n?i[e]||null:void(i[e]=n)}}]),t}();e.default=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(2),u=n(0),c=i(n(4)),s=i(n(11)),l=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$index=c.default.getIndex(),this.config=u.Util.clone(e),this.$raphael=c.default.createInstance(this.config),this.$flow=new a.Flow(this.$raphael),this.setOption(n),this.leastLineQue=[],this.draw()}return r(t,[{key:"cNodeMap",value:function(t,e){var n=c.default.src(this.$index,"CodeNodeMaps");return n||(n={}),t?e?(n[t]=e,c.default.src(this.$index,"CodeNodeMaps",n),this):n[t]||!1:n}},{key:"draw2",value:function(){var t=this;if(this.option){var e=this.option.step;this.codeIndex(e);for(var n=this.config,i=n.x||parseInt(.4*n.w),o=n.y||10,r=n.cH||50,a=n.dH||30,c={},s=function(e){var n=t.codeIndex(e),i=null;return n&&n.length>0&&u.Util.each(n,function(t,e){if(c[e])return i=c[e].y,!1}),i},l=function(e){var n=t.codeIndex(e),i=n.length,o=0;return u.Util.each(n,function(t,e){c[e]&&(o+=1)}),i-o},f=0;f<e.length;f++){var h=e[f],p=h.code,y=h.name||p,v=this.cNodeMap(p),d=!1;if(v&&(d=!0),!d)if(1==h.type)o+=a+r/2,(v=this.$flow.endpoint(i,o,r/2,y)).c.attr("fill","rgb(181, 216, 126)"),v.$step=h,this.drag(v),o+=r/2;else if(2==h.type){var g=100,x=this.codeIndex(p),b=i;if(h.prev&&-1==h.prev.indexOf(",")){var w=this.getNodeByCode(h.prev);w&&w.c&&(b=this.getStandX(w))}if(x&&x.length>1){var k=l(p),m=Math.ceil(x.length/2),M=b+(25+g)*(m-k),P=s(p);P?M=b+(25+g)*(m-k):o+=a+r/2,P=P||o,v=this.$flow.operation(M,P,g,r,y),c[p]={y:o}}else o+=a+r/2,v=this.$flow.operation(b,o,g,r,y);v.$step=h,this.drag(v),v.c.attr("fill","rgb(224, 223, 226)"),o+=r/2}else 3==h.type?(o+=a+r/2,(v=this.$flow.judge(i,o,g+60,r,y)).c.attr("fill","rgb(49, 174, 196)"),v.$step=h,this.drag(v),o+=r/2):9==h.type&&(o+=a+r/2,(v=this.$flow.endpoint(i,o,r/2,y)).c.attr("fill","rgb(34, 185, 41)"),v.$step=h,this.drag(v));v&&(d?this.line(v,h):(this.cNodeMap(p,v),this.line(v),this._eventBind(v)))}}}},{key:"checkPaperHight",value:function(t){var e=this.config.dom.find("svg"),n=e.height();n<t+180&&e.css({height:n+80})}},{key:"draw",value:function(){var t=this;this.getNodeCls();var e=c.default.src(this.$index,"_nodeCls"),n=u.Util.clone(this.option),i=.21,o=this.conf("cH",50),r=this.conf("dH",30),a=this.conf("h"),s=e.clsValue,l=this.conf("sColumnMk",!0);i=l?.43:o*(s-1)+r*s<a?.43:i;var f=this.conf("x",parseInt(this.conf("w")*i)),h=f,p=this.conf("y",10),y=p,v=this.conf("bkgOperCol","rgb(224, 223, 226)"),d=this.conf("bkgJudgeCol","rgb(49, 174, 196)");this.conf("currentCode",!1);e.isMuti=function(t){var n=e.map[t];return e.mapDt[n].length>1},e.getMutiY=function(n,i){var o=0;i=i||0;var r=e.map[n],a=e.mapDt[r];return a.length>1&&u.Util.each(a,function(e,n){var i=t.getNodeByCode(n);if(i)return o=t.getStandY(i),!1}),o=o||i},e.getMutiCtt=function(n){var i=e.map[n],o=e.mapDt[i],r=o.length,a=0;return r>1&&u.Util.each(o,function(e,n){t.getNodeByCode(n)&&(a+=1)}),{len:r,hasEd:a}},u.Util.each(n.step,function(n,i){var u,c,s=i.type,g=i.code,x=i.name||g;switch(l?t.checkPaperHight(y):y+2*o>a&&(y=p,h+=f),s){case 1:y+=r,(u=t.$flow.endpoint(h,y,o/2,x)).c.attr("fill",t.conf("pkgStartCol","rgb(181, 216, 126)"));break;case 2:if(c=h,e.isMuti(g)){var b=e.getMutiY(g,null),w=e.getMutiCtt(g);if(2==w.len)w.hasEd>0&&(c+=50+1.5*o);else if(w.len>2){var k=Math.ceil(w.len/2);c+=(25+2*o)*(k-(w.len-w.hasEd))}b?y=b:y+=e.getMutiY(g,2*r+o/2)}else y+=2*r+o/2;(u=t.$flow.operation(c,y,100,o,x)).c.attr("fill",v);break;case 3:y+=2*r+o/2,(u=t.$flow.judge(h,y,100,o,x)).c.attr("fill",d);break;case 9:y+=2*r+o/2,(u=t.$flow.endpoint(h,y,o/2,x)).c.attr("fill",t.conf("bkgEndCol","rgb(34, 185, 41)"))}u&&(u.$step=i,u.c.data("_code",g),u.c.data("_type",s),t.cNodeMap(g,u),t.line(u),t._eventBind(u),t.drag(u))}),this.connectLeastLines()}},{key:"getNodeCls",value:function(){var t=u.Util.clone(this.option),e=0,n={},i={};u.Util.each(t.step,function(t,o){var r=o.prev,a=o.code;r&&n[r]&&(e=n[r]),e+=1,n[a]=e,i[e]?i[e].push(a):i[e]=[a]}),c.default.src(this.$index,"_nodeCls",{map:n,mapDt:i,clsValue:e})}},{key:"drag",value:function(t){!function(t,e){var n={};t.c.drag(function(i,o){i+=n.x,o+=n.y,t.move(i,o),!e.line||"arrow"!=e.line&&"bow"!=e.line?t.ToSyncLine(i,o):t.ToSyncArrow(i,o)},function(){var t,e;if("ellipse"==this.type)t=this.attr("cx"),e=this.attr("cy");else if("rect"==this.type)t=this.attr("x"),e=this.attr("y");else if("path"==this.type){var i=this.attr("path")[0];t=i[1],e=i[2]}n.x=t,n.y=e},function(){})}(t,this.config)}},{key:"line",value:function(t,e){var n=this,i=u.Util.clone(t.$step);if(i.prev&&(i.prev=i.prev.replace(/\s/g,"")),i.prev){var o,r=this.config,a=void 0===r.rightAngle||r.rightAngle,c=this.conf("bkgLineCol","rgb(14, 10, 10)"),s=function(t,e){var i,o=n.getNodeByCode(t),u=n.getNodeByCode(e);if(o&&u){if(r.line&&"arrow"==r.line){var s=o.getStlnP(),l=u.getEnlnP();(i=n.$flow.arrow([s.x,s.y],[l.x,l.y],r.arrowLen?r.arrowLen:4)).position={from:s.position,to:l.position},i.c.attr("fill",c)}else if(r.line&&"bow"==r.line){s=o.getStlnP(),l=u.getEnlnP();var f={queue:[{x:s.x,y:s.y},{x:l.x,y:l.y}]};(i=n.$flow.bow(f)).position={from:s.position,to:l.position},i.arrow.attr({fill:c,stroke:c})}else{s=o.getStlnP(),l=u.getEnlnP();(i=a?n.$flow.rightAngleLine({p1:{x:s.x,y:s.y},p2:{x:l.x,y:l.y}}):n.$flow.line([s.x,s.y],[l.x,l.y])).position={from:s.position,to:l.position}}o.recordLine("from",i),u.recordLine("to",i);var h=n.nodeRunedMk(e);if(h&&i){var p=n.conf("bkgRunedCol","rgb(255, 0, 0)");i.c.attr({stroke:p}),i.arrow&&i.arrow.attr({fill:p,stroke:p}),u.c.attr({stroke:p}),2==h&&o.c.attr({stroke:p})}}else n.leastLineQue.push({from:t,to:e})};o=(e=e||i).prev.indexOf(",")>-1?e.prev.split(","):[e.prev];for(var l=0;l<o.length;l++)s(o[l],e.code)}}},{key:"connectLeastLines",value:function(){var t=this,e=this.config,n=void 0===e.rightAngle||e.rightAngle,i=this.conf("bkgRunedCol","rgb(255, 0, 0)"),o=this.conf("bkgLineCol","rgb(14, 10, 10)");u.Util.each(this.leastLineQue,function(r,a){!function(r,a){var u,c=t.getNodeByCode(r),s=t.getNodeByCode(a);if(c&&s){if(e.line&&"arrow"==e.line){var l=c.getStlnP(),f=s.getEnlnP();(u=t.$flow.arrow([l.x,l.y],[f.x,f.y],e.arrowLen?e.arrowLen:4)).position={from:l.position,to:f.position},u.c.attr("fill",o)}else if(e.line&&"bow"==e.line){var h=3==c.c.data("_type"),p=(l=c.getStlnP(h?"A":null),!1);h&&(p=2==s.c.data("_type")?"L":"A"),f=s.getEnlnP(p);var y={queue:[{x:l.x,y:l.y},{x:l.x-50,y:l.y},{x:l.x-50,y:f.y},{x:f.x,y:f.y}]};(u=t.$flow.bow(y)).position={from:l.position,to:f.position},u.arrow.attr({fill:o,stroke:o})}else l=c.getStlnP(),f=s.getEnlnP(),(u=n?t.$flow.rightAngleLine({p1:{x:l.x,y:l.y},p2:{x:f.x,y:f.y}}):t.$flow.line([l.x,l.y],[f.x,f.y])).position={from:l.position,to:f.position};c.recordLine("from",u),s.recordLine("to",u);var v=t.nodeRunedMk(a);v&&u&&(u.c.attr({stroke:i}),u.arrow&&u.arrow.attr({fill:i,stroke:i}),s.c.attr({stroke:i}),2==v&&c.c.attr({stroke:i}))}}(a.from,a.to)})}},{key:"setOption",value:function(t){"object"==(void 0===t?"undefined":o(t))&&(this.option=u.Util.clone(t))}},{key:"getNodeByCode",value:function(t){var e=null,n=this.cNodeMap(t);return n&&(e=n),e}},{key:"codeIndex",value:function(t){if("object"==(void 0===t?"undefined":o(t))){for(var e={},n=0;n<t.length;n++){var i=t[n],r=i.code;if(i.prev)for(var a=i.prev.replace(/\s/g,"").split(","),s=0;s<a.length;s++){var l=a[s],f=e[l]?e[l]:0;if("object"==(void 0===f?"undefined":o(f))&&f.length&&(f=1==f.length?f[0]:f),f+=1,e[r]){if("object"!=o(e[r])){var h=e[r];e[r]=[h]}e[r].push(f),e[r]=u.Util.ArrayMergeSameValue(e[r])}else e[r]=f}else e[r]=1}c.default.src(this.$index,"clsMap",e)}else if(t){if(e=c.default.src(this.$index,"clsMap")){var p=e[t]||null,y=[t];for(var v in e)p==e[v]&&-1==$.inArray(v,y)&&y.push(v);return y}}}},{key:"getStandX",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cx");break;case"rect":e=n.attr("x")+n.attr("width")/2;break;case"path":e=t.opt.cx}}return e}},{key:"getStandY",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cy");break;case"rect":e=n.attr("y")+n.attr("height")/2;break;case"path":e=t.opt.cy}}return e}},{key:"removeBBox",value:function(){var t=this.cNodeMap();for(var e in t){var n=t[e];n.bBox&&n.bBox.remove()}}},{key:"_eventBind",value:function(t){var e=this;t.c.click(function(){e.removeBBox(),t.bBox&&t.bBox.remove();var n=this.getBBox();t.bBox=t.instance.rect(n.x-5,n.y-5,n.width+10,n.height+10),t.bBox.attr({stroke:e.conf("bkgNodeBox","rgb(15, 13, 105)")})});var n=this.conf("texteditor",!1),i=t.label;if(n&&i){var r=this.conf("texteditor");(r="object"==(void 0===r?"undefined":o(r))?r:{}).id=r.id?r.id:"worker-txteditor",r.class=r.class?r.class:"worker-txteditor-div",i.dblclick(function(){var e=i.attr("text"),n=$("#"+r.id);if(0==n.length){var o='<div class="'+r.class+'"><input type="text" id="'+r.id+'"></div>';$("body").append(o),n=$("#"+r.id)}n.show(),n.val(e),n.css({top:i.attr("y"),left:i.attr("x")}),n.focus(),n.off("blur").on("blur",function(){var e=$(this),n=e.val();n&&i.attr("text",n),e.hide(),"function"==typeof t.resizeByText&&t.resizeByText()})})}}},{key:"conf",value:function(t,e){return e=e||null,void 0!==this.config[t]&&(e=this.config[t]),e}},{key:"nodeRunedMk",value:function(t){var e=this.conf("currentCode",!1);if(e){var n=c.default.src(this.$index,"_nodeCls"),i=n.map[e],o=n.map[t];e=o<=i&&o}return e}}],[{key:"editor",value:function(t){return new s.default(t)}}]),t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=(n(0),function(t){return t&&t.__esModule?t:{default:t}}(n(1))),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.instance=t,n.opt={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),o(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":i(t))){var e=arguments;t={cx:e[0],cy:e[1],r:e[2]},e[3]&&(t.text=e[3])}t.h=t.h?t.h:t.r,this.minWidth=2*t.r,this.opt=t,this.c=this.instance.ellipse(t.cx,t.cy,t.r,t.h);var n;n=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=n,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("rx");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=2,this.opt.r=e/2,this.resizeByOpt()}}},{key:"resizeByOpt",value:function(){var t=this.opt;this.c.attr({cx:t.cx,cy:t.cy,rx:t.r,ry:t.h})}},{key:"move",value:function(t,e){this.c.attr({cx:t,cy:e}),this.label.attr({x:t,y:e})}},{key:"ToSyncLine",value:function(t,e){var n=this;this.syncLineMove(function(i,o,r){var a,u=r.position;if("from"==o){var c=i.attr("path");a="get"+u.from+"p";var s=n[a](t,e);c[0]=["M",s.x,s.y],i.attr("path",c)}else if("to"==o){var l=i.attr("path");a="get"+u.to+"p";var f=n[a](t,e);l[l.length-1]=["L",f.x,f.y],i.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this;this.syncLineMove(function(i,o,r){var a,u=r.position;if("from"==o){a="get"+u.from+"p";var c=n[a](t,e);r.updatePath([c.x,c.y])}else if("to"==o){a="get"+u.to+"p";var s=n[a](t,e);r.updatePath(null,[s.x,s.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"D")+"p"]();return e.position=t,e}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"B")+"p"]();return e.position=t,e}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.r,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.r,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.r,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.r,{x:t,y:e}}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.instance=t,n.opt={},n.bBox=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),o(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":i(t))){var e=arguments;t={cx:e[0],cy:e[1],w:e[2],h:e[3]},e[4]&&(t.text=e[4])}this.opt=t,this.minWidth=t.w;var n=this.getAp();this.c=this.instance.rect(n.x,n.y,t.w,t.h);var o;o=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=o,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("w");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=10,this.opt.w=e;var i=this.getAp();this.c.attr({width:e,x:i.x,y:i.y})}}},{key:"move",value:function(t,e){var n=this.getCtpByAp(t,e);this.c.attr({x:t,y:e}),this.label.attr(n)}},{key:"ToSyncLine",value:function(t,e){var n=this,i=this.getCtpByAp(t,e);this.syncLineMove(function(t,e,o){var r,a=o.position;if("from"==e){var u=t.attr("path");r="get"+a.from+"p";var c=n[r](i.x,i.y);u[0]=["M",c.x,c.y],t.attr("path",u)}else if("to"==e){r="get"+a.to+"p";var s=n[r](i.x,i.y),l=t.attr("path");l[l.length-1]=["L",s.x,s.y],t.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this,i=this.getCtpByAp(t,e);this.syncLineMove(function(t,e,o){var r,a=o.position;if("from"==e){r="get"+a.from+"p";var u=n[r](i.x,i.y);o.updatePath([u.x,u.y])}else if("to"==e){r="get"+a.to+"p";var c=n[r](i.x,i.y);o.updatePath(null,[c.x,c.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"Bt")+"p"]();return e.position=t,e}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"T")+"p"]();return e.position=t,e}},{key:"getCtpByAp",value:function(t,e){var n=this.opt;return t+=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e-=n.h/2,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getTp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.h/2,{x:t,y:e}}},{key:"getRp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,{x:t,y:e}}},{key:"getBtp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.h/2,{x:t,y:e}}},{key:"getLp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,{x:t,y:e}}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(0),r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=e,this.opt={},this.position={},this.rightAngle=!1}return i(t,[{key:"create",value:function(t,e){this.opt={p1:t,p2:e},this.c=this.instance.path("M"+t[0]+","+t[1]+"L"+e[0]+","+e[1])}},{key:"RightAngle",value:function(t){this.opt=t,this.rightAngle=!0;var e=t.p1,n=t.p2,i=20;t.d&&(i=t.d);var o="";if(e.x!=n.x&&e.y!=n.y){var r=n.x-e.x;o="L"+(e.x+r+i*(r>0?1:-1))+","+e.y+"L"+(e.x+r+i*(r>0?1:-1))+","+n.y}this.c=this.instance.path("M"+e.x+","+e.y+o+"L"+n.x+","+n.y)}},{key:"createByPoint",value:function(t){this.opt=t;var e="";o.Util.each(this.opt.points,function(t,n){n&&(e+=(e?"L":"M")+n.x+","+n.y)}),this.c=this.instance.path(e)}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=e,this.opt={},this.position={}}return i(t,[{key:"create",value:function(t,e,n){this.opt={p1:t,p2:e,r:n};var i=this.getPoints();this.c=this.instance.path("M"+t[0]+","+t[1]+"L"+e[0]+","+e[1]+"L"+i.cP.x+","+i.cP.y+"L"+i.dP.x+","+i.dP.y+"L"+e[0]+","+e[1])}},{key:"getPoints",value:function(t,e,n){var i=this.opt;t||(t=i.p1),e||(e=i.p2),n||(n=i.r);var o=Math.atan2(t[1]-e[1],e[0]-t[0])*(180/Math.PI),r=e[0]-n*Math.cos(o*(Math.PI/180)),a=e[1]+n*Math.sin(o*(Math.PI/180));return{cP:{x:r+n*Math.cos((o+120)*(Math.PI/180)),y:a-n*Math.sin((o+120)*(Math.PI/180))},dP:{x:r+n*Math.cos((o+240)*(Math.PI/180)),y:a-n*Math.sin((o+240)*(Math.PI/180))}}}},{key:"updatePath",value:function(t,e,n){var i=this.opt;t||(t=i.p1),e||(e=i.p2),n||(n=i.r);var o=this.getPoints(t,e,n);this.c.attr("path",[["M",t[0],t[1]],["L",e[0],e[1]],["L",o.cP.x,o.cP.y],["L",o.dP.x,o.dP.y],["L",e[0],e[1]]]),this.opt={p1:t,p2:e,r:n}}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=e,this.opt={},this.position={}}return i(t,[{key:"create",value:function(t){this.opt=t,this.queueCheck(),this.bodySharp(),this.arrowSharp()}},{key:"arrowSharp",value:function(){var t=this.opt,e=t.queue,n=t.r?t.r:5,i=e.length,o=e[i-1],r=e[i-2],a=Math.atan2(r.y-o.y,o.x-r.x)*(180/Math.PI),u=o.x-n*Math.cos(a*(Math.PI/180)),c=o.y+n*Math.sin(a*(Math.PI/180)),s=u+n*Math.cos((a+120)*(Math.PI/180)),l=c-n*Math.sin((a+120)*(Math.PI/180)),f=u+n*Math.cos((a+240)*(Math.PI/180)),h=c-n*Math.sin((a+240)*(Math.PI/180));this.arrow?this.arrow.attr("path",[["M",o.x,o.y],["L",s,l],["L",f,h],["L",o.x,o.y]]):this.arrow=this.instance.path("M"+o.x+","+o.y+"L"+s+","+l+"L"+f+","+h+"L"+o.x+","+o.y)}},{key:"bodySharp",value:function(){var t=this.opt.queue,e="",n=[],i=!1,o=!0;i=!!this.c;for(var r=0;r<t.length;r++){var a=t[r];i?(o&&n.length>0&&(o=!1),n.push([o?"M":"L",a.x,a.y])):e+=(e?"L":"M")+","+a.x+","+a.y}i?this.c.attr("path",n):this.c=this.instance.path(e)}},{key:"queueCheck",value:function(){var t=this.opt.queue;if(2==t.length){var e=[],n=t[0],i=t[1];n.x<i.x?e.push({x:i.x,y:n.y}):n.x>i.x&&(e.push({x:n.x,y:i.y-20}),e.push({x:i.x,y:i.y-20})),this.opt.queue=[n].concat(e,i)}}},{key:"updatePath",value:function(t,e,n){var i=this.opt;if(t&&(i.queue[0]={x:t[0],y:t[1]}),e){var o=i.queue.length-1;i.queue[o]={x:e[0],y:e[1]}}this.queueCheck(),this.bodySharp(),this.arrowSharp()}}]),t}();e.default=o},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=i(n(4)),u=i(n(3)),c=n(2),s={type:1,text:"开始"},l={type:2,text:"流程"},f={type:3,text:"判断"},h={type:9,text:"结束"},p=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.raphael=a.default.createInstance(e),this._configMergeToDefule(),this.flow=new c.Flow(this.raphael),this.nodes=[],this._toolbar()}return r(t,[{key:"_configMergeToDefule",value:function(){var t=this.config.pkgClr||{};t.start=t.start||"rgb(181, 216, 126)",t.opera=t.opera||"rgb(224, 223, 226)",t.judge=t.judge||"rgb(49, 174, 196)",t.end=t.end||"rgb(34, 185, 41)",t.NodeBox=t.NodeBox||"rgb(15, 13, 105)",this.config.pkgClr=t,this.config.listener=this.config.listener||{}}},{key:"_toolbar",value:function(){var t={},e=this.raphael,n=5,i=5,o=this.config.pkgClr;t.containerIst=e.rect(5,5,75,300),t.containerIst.attr("fill","#ffffff"),n+=20,i+=50,t.startIst=e.ellipse(n,i,8,6),t.startIst.attr("fill",o.start),t.startTxtIst=e.text(n+30,i,s.text),i+=20,t.operaIst=e.rect(n-8,i,16,12),t.operaIst.attr("fill",o.opera),t.operaTxtIst=e.text(n+30,i+4,l.text),i+=30,t.judgeIst=new u.default(e).onlyCell(n,i,16,12),t.judgeIst.attr("fill",o.judge),t.judgeTxtIst=e.text(n+30,i,f.text),i+=30,t.endIst=e.ellipse(n,i,8,6),t.endIst.attr("fill",o.end),t.endTxtIst=e.text(n+30,i,h.text),this.$tool=t,this._toolbarDragEvt()}},{key:"_toolbarDragEvt",value:function(){var t=this,e=function(e,n){var i={};e.drag(function(t,e){i={dx:t,dy:e}},function(){(i={dx:0,dy:0}).x=void 0,i.y=void 0},function(){if(i.dx<75||i.dy<50)return null;t._createNode(i,n)})};e(this.$tool.startIst,s.type),e(this.$tool.startTxtIst,s.type),e(this.$tool.operaIst,l.type),e(this.$tool.operaTxtIst,l.type),e(this.$tool.judgeIst,f.type),e(this.$tool.judgeTxtIst,f.type),e(this.$tool.endIst,h.type),e(this.$tool.endTxtIst,h.type)}},{key:"removeBBox",value:function(){for(var t=this.nodes,e=0;e<t.length;e++){var n=t[e];n.bBox&&(n.bBox.remove(),n.bBox=null)}}},{key:"removeNode",value:function(t){if(t||(t=this.getSelected()),t){var e="object"==(void 0===t?"undefined":o(t))?t:this.raphael.getById(t);if("object"==(void 0===e?"undefined":o(e))){var n=e.id;e.bBox&&(e.bBox.remove(),e.bBox=null),e.label&&(e.label.remove(),e.label=null),e.c.remove(),e=null;for(var i=this.nodes,r=[],a=0;a<i.length;a++){var u=i[a];n!=u.c.id&&r.push(u)}return!0}}return!1}},{key:"getSelected",value:function(){for(var t=this.nodes,e=null,n=0;n<t.length;n++){var i=t[n];if(i.bBox){e=i;break}}return e}},{key:"getFlowStep",value:function(){for(var t=[],e=this.nodes,n=0;n<e.length;n++){var i=e[n],o=this.getFlowJson(i);t.push(o)}return t}},{key:"getFlowJson",value:function(t){t||(t=this.getSelected());var e={};if(t){var n=t.label||null,i=t.c;e={text:n?n.attr("text"):"",code:i.id,type:i.data("type")}}else e=null;return e}},{key:"_createNode",value:function(t,e){var n=this,i=null,o=this.config.pkgClr;switch(e){case 1:(i=this.flow.endpoint(t.dx,t.dy,10,"开始")).c.attr("fill",o.start);break;case 2:(i=this.flow.operation(t.dx,t.dy,50,40,"操作流程")).c.attr("fill",o.opera);break;case 3:(i=this.flow.judge(t.dx,t.dy,50,40,"流程判断")).c.attr("fill",o.judge);break;case 9:(i=this.flow.endpoint(t.dx,t.dy,10,"结束")).c.attr("fill",o.end)}i&&(!function(){var t={};i.c.drag(function(e,n){e+=t.x,n+=t.y,i.move(e,n)},function(){var e,n;if("ellipse"==this.type)e=this.attr("cx"),n=this.attr("cy");else if("rect"==this.type)e=this.attr("x"),n=this.attr("y");else if("path"==this.type){var i=this.attr("path")[0];e=i[1],n=i[2]}t.x=e,t.y=n},function(){t={x:0,y:0}})}(),i.c.click(function(){n.removeBBox();var t=this.getBBox();i.bBox=i.instance.rect(t.x-5,t.y-5,t.width+10,t.height+10),i.bBox.attr({stroke:o.NodeBox})}),i.c.data("type",e),this.nodes.push(i))}}]),t}();e.default=p}]);