!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=6)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return o(t,null,[{key:"clone",value:function(t){t="object"==(void 0===t?"undefined":r(t))?t:{};return $.extend(!0,{},t)}},{key:"ArrayMergeSameValue",value:function(t){if("object"==(void 0===t?"undefined":r(t))&&t.length&&t.length>1){for(var e={},n=[],o=0;o<t.length;o++)e[t[o]]||(n.push(t[o]),e[t[o]]=!0);t=n}return t}},{key:"each",value:function(t,e){if("object"==(void 0===t?"undefined":r(t)))if($.isArray(t))for(var n=0;n<t.length&&!1!==e(n,t[n]);n++);else for(var o in t)if(!1===e(o,t[o]))break}}]),t}();e.Util=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fromLine=[],this.toLine=[]}return r(t,[{key:"recordLine",value:function(t,e){"from"==t?this.fromLine.push(e):"to"==t&&this.toLine.push(e)}},{key:"syncLineMove",value:function(t){"function"!=typeof t&&(t=function(t,e){});for(var e=this.fromLine,n=this.toLine,r=0;r<e.length;r++){var o=e[r].c;o.attr("path");t(o,"from",e[r])}for(var i=0;i<n.length;i++){t(n[i].c,"to",n[i])}}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(n(1)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.instance=t,n.opt={},n.bBox=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.default),o(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":r(t))){var e=arguments;t={cx:e[0],cy:e[1],w:e[2],h:e[3]},e[4]&&(t.text=e[4])}this.opt=t;var n=this.getAp();this.c=this.instance.rect(n.x,n.y,t.w,t.h);var o;o=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=o}},{key:"move",value:function(t,e){var n=this.getCtpByAp(t,e);this.c.attr({x:t,y:e}),this.label.attr(n)}},{key:"ToSyncLine",value:function(t,e){var n=this,r=this.getCtpByAp(t,e);this.syncLineMove(function(t,e,o){var i,a=o.position;if("from"==e){var c=t.attr("path");i="get"+a.from+"p";var u=n[i](r.x,r.y);c[0]=["M",u.x,u.y],t.attr("path",c)}else if("to"==e){i="get"+a.to+"p";var f=n[i](r.x,r.y),l=t.attr("path");l[l.length-1]=["L",f.x,f.y],t.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this,r=this.getCtpByAp(t,e);this.syncLineMove(function(t,e,o){var i,a=o.position;if("from"==e){i="get"+a.from+"p";var c=n[i](r.x,r.y);o.updatePath([c.x,c.y])}else if("to"==e){i="get"+a.to+"p";var u=n[i](r.x,r.y);o.updatePath(null,[u.x,u.y])}})}},{key:"getStlnP",value:function(){var t=this.getBtp();return t.position="Bt",t}},{key:"getEnlnP",value:function(){var t=this.getTp();return t.position="T",t}},{key:"getCtpByAp",value:function(t,e){var n=this.opt;return t+=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e-=n.h/2,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getTp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.h/2,{x:t,y:e}}},{key:"getRp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,{x:t,y:e}}},{key:"getBtp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.h/2,{x:t,y:e}}},{key:"getLp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=e,this.opt={},this.position={},this.rightAngle=!1}return r(t,[{key:"create",value:function(t,e){this.opt={p1:t,p2:e},this.c=this.instance.path("M"+t[0]+","+t[1]+"L"+e[0]+","+e[1])}},{key:"RightAngle",value:function(t){this.opt=t,this.rightAngle=!0;var e=t.p1,n=t.p2,r=20;t.d&&(r=t.d);var o="";if(e.x!=n.x&&e.y!=n.y){var i=n.x-e.x;o="L"+(e.x+i+r*(i>0?1:-1))+","+e.y+"L"+(e.x+i+r*(i>0?1:-1))+","+n.y}this.c=this.instance.path("M"+e.x+","+e.y+o+"L"+n.x+","+n.y)}},{key:"createByPoint",value:function(t){this.opt=t;var e="";o.Util.each(this.opt.points,function(t,n){n&&(e+=(e?"L":"M")+n.x+","+n.y)}),this.c=this.instance.path(e)}}]),t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=e,this.opt={},this.position={}}return r(t,[{key:"create",value:function(t,e,n){this.opt={p1:t,p2:e,r:n};var r=this.getPoints();this.c=this.instance.path("M"+t[0]+","+t[1]+"L"+e[0]+","+e[1]+"L"+r.cP.x+","+r.cP.y+"L"+r.dP.x+","+r.dP.y+"L"+e[0]+","+e[1])}},{key:"getPoints",value:function(t,e,n){var r=this.opt;t||(t=r.p1),e||(e=r.p2),n||(n=r.r);var o=Math.atan2(t[1]-e[1],e[0]-t[0])*(180/Math.PI),i=e[0]-n*Math.cos(o*(Math.PI/180)),a=e[1]+n*Math.sin(o*(Math.PI/180));return{cP:{x:i+n*Math.cos((o+120)*(Math.PI/180)),y:a-n*Math.sin((o+120)*(Math.PI/180))},dP:{x:i+n*Math.cos((o+240)*(Math.PI/180)),y:a-n*Math.sin((o+240)*(Math.PI/180))}}}},{key:"updatePath",value:function(t,e,n){var r=this.opt;t||(t=r.p1),e||(e=r.p2),n||(n=r.r);var o=this.getPoints(t,e,n);this.c.attr("path",[["M",t[0],t[1]],["L",e[0],e[1]],["L",o.cP.x,o.cP.y],["L",o.dP.x,o.dP.y],["L",e[0],e[1]]]),this.opt={p1:t,p2:e,r:n}}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=0,a={},c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return o(t,null,[{key:"createInstance",value:function(t){return(t="object"==(void 0===t?"undefined":r(t))?t:{}).dom,"string"==typeof t.dom&&(t.dom=$(t.dom)),t.w||(t.w=parseInt(1.1*$(window).width())),t.h||(t.h=parseInt(1.1*$(window).height())),Raphael(t.dom.get(0),t.w,t.h)}},{key:"onMoveEvt",value:function(){}},{key:"onStartEvt",value:function(){}},{key:"onEndEvt",value:function(){}},{key:"getIndex",value:function(){return i+=1}},{key:"src",value:function(t,e,n){a[t]||(a[t]={});var r=a[t];return void 0===e?r:void 0===n?r[e]||null:void(r[e]=n)}}]),t}();e.default=c},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.worker=e.tree=void 0;var o=r(n(7)),i=r(n(9));e.tree=o.default,e.worker=i.default},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=r(n(8)),c=n(0),u=r(n(5)),f=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$index=u.default.getIndex(),this.Nodes={},this.config=c.Util.clone(e),this.$raphael=u.default.createInstance(this.config),this.$flow=new a.default(this.$raphael),this.setOption(n),this.draw()}return i(t,[{key:"draw",value:function(){var t=this;if(this.option){var e=this.option.nodes;this.codeIndex(e);var n=this.config,r=this.feature("background.female","rgb(190, 113, 82)"),o=this.feature("background.male","rgb(224, 223, 226)");this.createFeatureKey(r,o);for(var i=n.x||parseInt(.4*n.w),a=n.y||10,u=n.cH||50,f=n.dH||30,l={},s=function(e){var n=t.codeIndex(e),r=null;return n&&n.length>0&&c.Util.each(n,function(t,e){if(l[e])return r=l[e].y,!1}),r},p=function(e){var n=t.codeIndex(e),r=n.length,o=0;return c.Util.each(n,function(t,e){l[e]&&(o+=1)}),r-o},h=0;h<e.length;h++){var y,v=e[h],d=v.code,g=v.name||d,b=this.codeIndex(v.code),x=i;if(v.parent&&-1==v.parent.indexOf(",")){var w=this.getNodeByCode(v.parent);w&&w.c&&(x=this.getStandX(w))}if(b&&b.length>1){var m=p(d),k=Math.ceil(b.length/2),M=x-50,P=(M=x+125*(k-m),s(d));P?M=x+125*(k-m):a+=f+u/2,P=P||a,y=this.$flow.operation(M,P,100,u,g),l[d]={y:a}}else a+=f+u/2,y=this.$flow.operation(x,a,100,u,g);y.$step=v,this.drag(y),"F"==v.type?y.c.attr("fill",r):y.c.attr("fill",o),a+=u/2,y&&(this.Nodes[v.code]=y,this.line(y))}}}},{key:"createFeatureKey",value:function(t,e){this.$flow.operation(20,20,20,20,"男").c.attr("fill",e);this.$flow.operation(20,60,20,20,"女").c.attr("fill",t)}},{key:"drag",value:function(t){!function(t,e){var n={};t.c.drag(function(r,o){r+=n.x,o+=n.y,t.move(r,o),e.line&&"arrow"==e.line?t.ToSyncArrow(r,o):t.ToSyncLine(r,o)},function(){var t,e;if("circle"==this.type)t=this.attr("cx"),e=this.attr("cy");else if("rect"==this.type)t=this.attr("x"),e=this.attr("y");else if("path"==this.type){var r=this.attr("path")[0];t=r[1],e=r[2]}n.x=t,n.y=e},function(){})}(t,this.config)}},{key:"line",value:function(t){var e=this,n=c.Util.clone(t.$step);if(n.parent&&(n.parent=n.parent.replace(/\s/g,"")),n.parent){var r,o=this.config,i=function(t,n){var r,i=e.getNodeByCode(t),a=e.getNodeByCode(n);if(i&&a){var c=i.getStlnP(),u=a.getEnlnP();o.line&&"arrow"==o.line?(r=e.$flow.arrow([c.x,c.y],[u.x,u.y],4)).c.attr("fill","rgb(14, 10, 10)"):r=e.$flow.line([c.x,c.y],[u.x,u.y]),i.recordLine("from",r),a.recordLine("to",r)}};r=n.parent.indexOf(",")>-1?n.parent.split(","):[n.parent];for(var a=0;a<r.length;a++)i(r[a],n.code)}}},{key:"setOption",value:function(t){"object"==(void 0===t?"undefined":o(t))&&(this.option=c.Util.clone(t))}},{key:"getNodeByCode",value:function(t){return this.Nodes[t]?this.Nodes[t]:null}},{key:"codeIndex",value:function(t){if("object"==(void 0===t?"undefined":o(t))){for(var e={},n=0;n<t.length;n++){var r=t[n],i=r.code;if(r.parent)for(var a=r.parent.replace(/\s/g,"").split(","),f=0;f<a.length;f++){var l=a[f],s=e[l]?e[l]:0;if("object"==(void 0===s?"undefined":o(s))&&s.length&&(s=1==s.length?s[0]:s),s+=1,e[i]){if("object"!=o(e[i])){var p=e[i];if(2==s&&e[l]){e[l]=p-1;continue}e[i]=[p]}e[i].push(s),e[i]=c.Util.ArrayMergeSameValue(e[i])}else e[i]=s}else e[i]=1}console.log(e),u.default.src(this.$index,"clsMap",e)}else if(t){if(e=u.default.src(this.$index,"clsMap")){var h=e[t]||null,y=[t];for(var v in e)h==e[v]&&-1==$.inArray(v,y)&&y.push(v);return y}}}},{key:"getStandX",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cx");break;case"rect":e=n.attr("x")+n.attr("width")/2;break;case"path":e=t.opt.cx}}return e}},{key:"feature",value:function(t,e){e=e||null;var n=this.option.feature;if(t&&"object"==(void 0===n?"undefined":o(n))){t=t.replace(/\s/g,"").split(".");var r=c.Util.clone(n);c.Util.each(t,function(t,n){if(r&&"object"==(void 0===r?"undefined":o(r)))r=r[n]||e;else if(!r)return r=e,!1}),e=r}return e}}]),t}();e.default=f},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=(n(0),r(n(2))),a=r(n(3)),c=r(n(4)),u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.paper=e}return o(t,[{key:"operation",value:function(t,e,n,r,o){var a=new i.default(this.paper);return a.create(t,e,n,r,o),a}},{key:"line",value:function(t,e){var n=new a.default(this.paper);return n.create(t,e),n}},{key:"arrow",value:function(t,e,n){var r=new c.default(this.paper);return r.create(t,e,n),r}}]),t}();e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(10),a=n(0),c=function(t){return t&&t.__esModule?t:{default:t}}(n(5)),u=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$index=c.default.getIndex(),this.config=a.Util.clone(e),this.$raphael=c.default.createInstance(this.config),this.$flow=new i.Flow(this.$raphael),this.setOption(n),this.leastLineQue=[],this.draw()}return o(t,[{key:"cNodeMap",value:function(t,e){var n=c.default.src(this.$index,"CodeNodeMaps");return n||(n={}),t?e?(n[t]=e,c.default.src(this.$index,"CodeNodeMaps",n),this):n[t]||!1:n}},{key:"draw2",value:function(){var t=this;if(this.option){var e=this.option.step;this.codeIndex(e);for(var n=this.config,r=n.x||parseInt(.4*n.w),o=n.y||10,i=n.cH||50,c=n.dH||30,u={},f=function(e){var n=t.codeIndex(e),r=null;return n&&n.length>0&&a.Util.each(n,function(t,e){if(u[e])return r=u[e].y,!1}),r},l=function(e){var n=t.codeIndex(e),r=n.length,o=0;return a.Util.each(n,function(t,e){u[e]&&(o+=1)}),r-o},s=0;s<e.length;s++){var p=e[s],h=p.code,y=p.name||h,v=this.cNodeMap(h),d=!1;if(v&&(d=!0),!d)if(1==p.type)o+=c+i/2,(v=this.$flow.endpoint(r,o,i/2,y)).c.attr("fill","rgb(181, 216, 126)"),v.$step=p,this.drag(v),o+=i/2;else if(2==p.type){var g=100,b=this.codeIndex(h),x=r;if(p.prev&&-1==p.prev.indexOf(",")){var w=this.getNodeByCode(p.prev);w&&w.c&&(x=this.getStandX(w))}if(b&&b.length>1){var m=l(h),k=Math.ceil(b.length/2),M=x+(25+g)*(k-m),P=f(h);P?M=x+(25+g)*(k-m):o+=c+i/2,P=P||o,v=this.$flow.operation(M,P,g,i,y),u[h]={y:o}}else o+=c+i/2,v=this.$flow.operation(x,o,g,i,y);v.$step=p,this.drag(v),v.c.attr("fill","rgb(224, 223, 226)"),o+=i/2}else 3==p.type?(o+=c+i/2,(v=this.$flow.judge(r,o,g+60,i,y)).c.attr("fill","rgb(49, 174, 196)"),v.$step=p,this.drag(v),o+=i/2):9==p.type&&(o+=c+i/2,(v=this.$flow.endpoint(r,o,i/2,y)).c.attr("fill","rgb(34, 185, 41)"),v.$step=p,this.drag(v));v&&(d?this.line(v,p):(this.cNodeMap(h,v),this.line(v),this._eventBind(v)))}}}},{key:"checkPaperHight",value:function(t){var e=this.config.dom.find("svg"),n=e.height();n<t+50&&e.css({height:n+150})}},{key:"draw",value:function(){var t=this;this.getNodeCls();var e=c.default.src(this.$index,"_nodeCls"),n=a.Util.clone(this.option),r=.21,o=this.conf("cH",50),i=this.conf("dH",30),u=this.conf("h"),f=e.clsValue,l=this.conf("sColumnMk",!0);r=l?.43:o*(f-1)+i*f<u?.43:r;var s=this.conf("x",parseInt(this.conf("w")*r)),p=s,h=this.conf("y",10),y=h,v=this.conf("bkgOperCol","rgb(224, 223, 226)"),d=this.conf("bkgJudgeCol","rgb(49, 174, 196)");this.conf("currentCode",!1);e.isMuti=function(t){var n=e.map[t];return e.mapDt[n].length>1},e.getMutiY=function(n,r){var o=0;r=r||0;var i=e.map[n],c=e.mapDt[i];return c.length>1&&a.Util.each(c,function(e,n){var r=t.getNodeByCode(n);if(r)return o=t.getStandY(r),!1}),o=o||r},e.getMutiCtt=function(n){var r=e.map[n],o=e.mapDt[r],i=o.length,c=0;return i>1&&a.Util.each(o,function(e,n){t.getNodeByCode(n)&&(c+=1)}),{len:i,hasEd:c}},a.Util.each(n.step,function(n,r){var a,c,f=r.type,g=r.code,b=r.name||g;switch(l?t.checkPaperHight(y):y+2*o>u&&(y=h,p+=s),f){case 1:y+=i,(a=t.$flow.endpoint(p,y,o/2,b)).c.attr("fill",t.conf("pkgStartCol","rgb(181, 216, 126)"));break;case 2:if(c=p,e.isMuti(g)){var x=e.getMutiY(g,null),w=e.getMutiCtt(g);if(2==w.len)w.hasEd>0&&(c+=50+1.5*o);else if(w.len>2){var m=Math.ceil(w.len/2);c+=(25+2*o)*(m-(w.len-w.hasEd))}x?y=x:y+=e.getMutiY(g,2*i+o/2)}else y+=2*i+o/2;(a=t.$flow.operation(c,y,100,o,b)).c.attr("fill",v);break;case 3:y+=2*i+o/2,(a=t.$flow.judge(p,y,100,o,b)).c.attr("fill",d);break;case 9:y+=2*i+o/2,(a=t.$flow.endpoint(p,y,o/2,b)).c.attr("fill",t.conf("bkgEndCol","rgb(34, 185, 41)"))}a&&(a.$step=r,a.c.data("_code",g),t.cNodeMap(g,a),t.line(a),t._eventBind(a),t.drag(a))}),this.connectLeastLines()}},{key:"getNodeCls",value:function(){var t=a.Util.clone(this.option),e=0,n={},r={};a.Util.each(t.step,function(t,o){var i=o.prev,a=o.code;i&&n[i]&&(e=n[i]),e+=1,n[a]=e,r[e]?r[e].push(a):r[e]=[a]}),c.default.src(this.$index,"_nodeCls",{map:n,mapDt:r,clsValue:e})}},{key:"drag",value:function(t){!function(t,e){var n={};t.c.drag(function(r,o){r+=n.x,o+=n.y,t.move(r,o),e.line&&"arrow"==e.line?t.ToSyncArrow(r,o):t.ToSyncLine(r,o)},function(){var t,e;if("circle"==this.type)t=this.attr("cx"),e=this.attr("cy");else if("rect"==this.type)t=this.attr("x"),e=this.attr("y");else if("path"==this.type){var r=this.attr("path")[0];t=r[1],e=r[2]}n.x=t,n.y=e},function(){})}(t,this.config)}},{key:"line",value:function(t,e){var n=this,r=a.Util.clone(t.$step);if(r.prev&&(r.prev=r.prev.replace(/\s/g,"")),r.prev){var o,i=this.config,c=void 0===i.rightAngle||i.rightAngle,u=function(t,e){var r,o=n.getNodeByCode(t),a=n.getNodeByCode(e);if(o&&a){if(i.line&&"arrow"==i.line){var u=o.getStlnP(),f=a.getEnlnP();(r=n.$flow.arrow([u.x,u.y],[f.x,f.y],i.arrowLen?i.arrowLen:4)).position={from:u.position,to:f.position},r.c.attr("fill","rgb(14, 10, 10)")}else{u=o.getStlnP(),f=a.getEnlnP();(r=c?n.$flow.rightAngleLine({p1:{x:u.x,y:u.y},p2:{x:f.x,y:f.y}}):n.$flow.line([u.x,u.y],[f.x,f.y])).position={from:u.position,to:f.position}}o.recordLine("from",r),a.recordLine("to",r);var l=n.nodeRunedMk(e);if(l&&r){var s=n.conf("bkgRunedCol","rgb(255, 0, 0)");r.c.attr({fill:s,stroke:s}),a.c.attr({stroke:s}),2==l&&o.c.attr({stroke:s})}}else n.leastLineQue.push({from:t,to:e})};o=(e=e||r).prev.indexOf(",")>-1?e.prev.split(","):[e.prev];for(var f=0;f<o.length;f++)u(o[f],e.code)}}},{key:"connectLeastLines",value:function(){var t=this,e=this.config,n=void 0===e.rightAngle||e.rightAngle;a.Util.each(this.leastLineQue,function(r,o){!function(r,o){var i,a=t.getNodeByCode(r),c=t.getNodeByCode(o);if(a&&c){if(e.line&&"arrow"==e.line){var u=a.getStlnP(),f=c.getEnlnP();(i=t.$flow.arrow([u.x,u.y],[f.x,f.y],e.arrowLen?e.arrowLen:4)).position={from:u.position,to:f.position},i.c.attr("fill","rgb(14, 10, 10)")}else u=a.getStlnP(),f=c.getEnlnP(),(i=n?t.$flow.rightAngleLine({p1:{x:u.x,y:u.y},p2:{x:f.x,y:f.y}}):t.$flow.line([u.x,u.y],[f.x,f.y])).position={from:u.position,to:f.position};a.recordLine("from",i),c.recordLine("to",i);var l=t.nodeRunedMk(o);if(l&&i){var s=t.conf("bkgRunedCol","rgb(255, 0, 0)");i.c.attr({fill:s,stroke:s}),c.c.attr({stroke:s}),2==l&&a.c.attr({stroke:s})}}}(o.from,o.to)})}},{key:"setOption",value:function(t){"object"==(void 0===t?"undefined":r(t))&&(this.option=a.Util.clone(t))}},{key:"getNodeByCode",value:function(t){var e=null,n=this.cNodeMap(t);return n&&(e=n),e}},{key:"codeIndex",value:function(t){if("object"==(void 0===t?"undefined":r(t))){for(var e={},n=0;n<t.length;n++){var o=t[n],i=o.code;if(o.prev)for(var u=o.prev.replace(/\s/g,"").split(","),f=0;f<u.length;f++){var l=u[f],s=e[l]?e[l]:0;if("object"==(void 0===s?"undefined":r(s))&&s.length&&(s=1==s.length?s[0]:s),s+=1,e[i]){if("object"!=r(e[i])){var p=e[i];e[i]=[p]}e[i].push(s),e[i]=a.Util.ArrayMergeSameValue(e[i])}else e[i]=s}else e[i]=1}c.default.src(this.$index,"clsMap",e)}else if(t){if(e=c.default.src(this.$index,"clsMap")){var h=e[t]||null,y=[t];for(var v in e)h==e[v]&&-1==$.inArray(v,y)&&y.push(v);return y}}}},{key:"getStandX",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cx");break;case"rect":e=n.attr("x")+n.attr("width")/2;break;case"path":e=t.opt.cx}}return e}},{key:"getStandY",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cy");break;case"rect":e=n.attr("y")+n.attr("height")/2;break;case"path":e=t.opt.cy}}return e}},{key:"removeBBox",value:function(){var t=this.cNodeMap();for(var e in t){var n=t[e];n.bBox&&n.bBox.remove()}}},{key:"_eventBind",value:function(t){var e=this;t.c.click(function(){e.removeBBox(),t.bBox&&t.bBox.remove();var n=this.getBBox();t.bBox=t.instance.rect(n.x-5,n.y-5,n.width+10,n.height+10),t.bBox.attr({stroke:e.conf("bkgNodeBox","rgb(15, 13, 105)")})})}},{key:"conf",value:function(t,e){return e=e||null,void 0!==this.config[t]&&(e=this.config[t]),e}},{key:"nodeRunedMk",value:function(t){var e=this.conf("currentCode",!1);if(e){var n=c.default.src(this.$index,"_nodeCls"),r=n.map[e],o=n.map[t];e=o<=r&&o}return e}}]),t}();e.default=u},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.NodeJudge=e.NodeOperation=e.NodeEndpoint=e.NodeArrow=e.NodeLine=e.Flow=void 0;var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=(n(0),r(n(11))),a=r(n(2)),c=r(n(12)),u=r(n(3)),f=r(n(4)),l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.paper=e}return o(t,[{key:"endpoint",value:function(t,e,n,r){var o=new i.default(this.paper);return o.create(t,e,n,r),o}},{key:"judge",value:function(t,e,n,r,o){var i=new c.default(this.paper);return i.create(t,e,n,r,o),i}},{key:"operation",value:function(t,e,n,r,o){var i=new a.default(this.paper);return i.create(t,e,n,r,o),i}},{key:"line",value:function(t,e){var n=new u.default(this.paper);return n.create(t,e),n}},{key:"rightAngleLine",value:function(t){var e=new u.default(this.paper);return e.RightAngle(t),e}},{key:"arrow",value:function(t,e,n){var r=new f.default(this.paper);return r.create(t,e,n),r}},{key:"getEmptyNode",value:function(t){var e=null;switch(t){case"endpoint":e=new i.default(this.paper);break;case"judge":e=new c.default(this.paper);break;case"operation":e=new a.default(this.paper);break;case"line":e=new u.default(this.paper);break;case"arrow":e=new f.default(this.paper)}return e}}]),t}();e.Flow=l,e.NodeLine=u.default,e.NodeArrow=f.default,e.NodeEndpoint=i.default,e.NodeOperation=a.default,e.NodeJudge=c.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=(n(0),function(t){return t&&t.__esModule?t:{default:t}}(n(1))),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.instance=t,n.opt={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.default),o(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":r(t))){var e=arguments;t={cx:e[0],cy:e[1],r:e[2]},e[3]&&(t.text=e[3])}this.opt=t,this.c=this.instance.circle(t.cx,t.cy,t.r);var n;n=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=n}},{key:"move",value:function(t,e){this.c.attr({cx:t,cy:e}),this.label.attr({x:t,y:e})}},{key:"ToSyncLine",value:function(t,e){var n=this;this.syncLineMove(function(r,o,i){var a,c=i.position;if("from"==o){var u=r.attr("path");a="get"+c.from+"p";var f=n[a](t,e);u[0]=["M",f.x,f.y],r.attr("path",u)}else if("to"==o){var l=r.attr("path");a="get"+c.to+"p";var s=n[a](t,e);l[l.length-1]=["L",s.x,s.y],r.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this;this.syncLineMove(function(r,o,i){var a,c=i.position;if("from"==o){a="get"+c.from+"p";var u=n[a](t,e);i.updatePath([u.x,u.y])}else if("to"==o){a="get"+c.to+"p";var f=n[a](t,e);i.updatePath(null,[f.x,f.y])}})}},{key:"getStlnP",value:function(){var t=this.getDp();return t.position="D",t}},{key:"getEnlnP",value:function(){var t=this.getBp();return t.position="B",t}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.r,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.r,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.r,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.r,{x:t,y:e}}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(n(1)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.instance=t,n.opt={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.default),o(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":r(t))){var e=arguments;t={cx:e[0],cy:e[1],w:e[2],h:e[3]},e[4]&&(t.text=e[4])}this.opt=t;var n=this.getAp(),o=this.getBp(),i=this.getCp(),a=this.getDp();this.c=this.instance.path("M"+n.x+","+n.y+"L"+o.x+","+o.y+"L"+i.x+","+i.y+"L"+a.x+","+a.y+"Z");var c;c=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=c}},{key:"move",value:function(t,e){var n=this.getCpByAp(t,e),r=this.getBp(n.x,n.y),o=this.getCp(n.x,n.y),i=this.getDp(n.x,n.y);this.c.attr("path",[["M",t,e],["L",r.x,r.y],["L",o.x,o.y],["L",i.x,i.y],["Z"]]),this.label.attr(n)}},{key:"ToSyncLine",value:function(t,e){var n=this,r=this.getCpByAp(t,e);this.syncLineMove(function(t,e,o){var i,a=o.position;if("from"==e){i="get"+a.from+"p";var c=n[i](r.x,r.y),u=t.attr("path");u[0]=["M",c.x,c.y],t.attr("path",u)}else if("to"==e){i="get"+a.to+"p";var f=n[i](r.x,r.y),l=t.attr("path");l[l.length-1]=["L",f.x,f.y],t.attr("path",l)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this,r=this.getCpByAp(t,e);this.syncLineMove(function(t,e,o){var i,a=o.position;if("from"==e){i="get"+a.from+"p";var c=n[i](r.x,r.y);o.updatePath([c.x,c.y])}else if("to"==e){i="get"+a.to+"p";var u=n[i](r.x,r.y);o.updatePath(null,[u.x,u.y])}})}},{key:"getStlnP",value:function(){var t=this.getDp(),e="D";this.isCoincidence(t,"from")&&(t=this.getCp(),e="C");return{x:t.x,y:t.y,position:e}}},{key:"getEnlnP",value:function(){var t=this.getBp();return t.position="B",t}},{key:"getCpByAp",value:function(t,e){return t+=this.opt.w/2,{x:t,y:e}}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.h/2,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.h/2,{x:t,y:e}}},{key:"isCoincidence",value:function(t,e){var n=!1;if(t&&"object"==(void 0===t?"undefined":r(t))&&void 0!==t.x&&void 0!==t.y)if("from"==e){if(this.fromLine.length>0)for(var o=0;o<this.fromLine.length;o++){if((c=(a=this.fromLine[o].c.attr("path"))[0])[1]==t.x&&c[2]==t.y){n=!0;break}}}else if("to"==e&&this.toLine.length>0)for(var i=0;i<this.toLine.length;i++){var a,c;if((c=(a=this.toLine[i].c.attr("path"))[a.length-1])[1]==t.x&&c[2]==t.y){n=!0;break}}return n}}]),e}();e.default=a}]);