!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=8)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"clone",value:function(t){t="object"==(void 0===t?"undefined":i(t))?t:{};return $.extend(!0,{},t)}},{key:"ArrayMergeSameValue",value:function(t){if("object"==(void 0===t?"undefined":i(t))&&t.length&&t.length>1){for(var e={},n=[],r=0;r<t.length;r++)e[t[r]]||(n.push(t[r]),e[t[r]]=!0);t=n}return t}},{key:"each",value:function(t,e){if("object"==(void 0===t?"undefined":i(t)))if($.isArray(t))for(var n=0;n<t.length&&!1!==e(n,t[n]);n++);else for(var r in t)if(!1===e(r,t[r]))break}}]),t}();e.Util=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fromLine=[],this.toLine=[],this.NodeType=null}return i(t,[{key:"recordLine",value:function(t,e){"from"==t?this.fromLine.push(e):"to"==t&&this.toLine.push(e)}},{key:"syncLineMove",value:function(t){"function"!=typeof t&&(t=function(t,e){});for(var e=this.fromLine,n=this.toLine,i=0;i<e.length;i++){var r=e[i].c;r.attr("path");t(r,"from",e[i])}for(var o=0;o<n.length;o++){t(n[o].c,"to",n[o])}}},{key:"toJson",value:function(){var t={NodeType:this.NodeType,opt:this.opt,c:{attr:this.c.attr()}};return this.label&&(t.label={attr:this.label.attr()}),t}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=0,a={},c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"createInstance",value:function(t){return(t="object"==(void 0===t?"undefined":i(t))?t:{}).dom,"string"==typeof t.dom&&(t.dom=$(t.dom)),t.w||(t.w=parseInt(1.1*$(window).width())),t.h||(t.h=parseInt(1.1*$(window).height())),Raphael(t.dom.get(0),t.w,t.h)}},{key:"onMoveEvt",value:function(){}},{key:"onStartEvt",value:function(){}},{key:"onEndEvt",value:function(){}},{key:"getIndex",value:function(){return o+=1}},{key:"src",value:function(t,e,n){a[t]||(a[t]={});var i=a[t];return void 0===e?i:void 0===n?i[e]||null:void(i[e]=n)}}]),t}();e.default=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(1)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.NodeType="opera",n.instance=t,n.opt={},n.bBox=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),r(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":i(t))){var e=arguments;t={cx:e[0],cy:e[1],w:e[2],h:e[3]},e[4]&&(t.text=e[4])}this.opt=t,this.minWidth=t.w;var n=this.getAp();this.c=this.instance.rect(n.x,n.y,t.w,t.h);var r;r=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=r,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("w");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=10,this.opt.w=e;var i=this.getAp();this.c.attr({width:e,x:i.x,y:i.y})}}},{key:"move",value:function(t,e){var n=this.getCtpByAp(t,e);this.c.attr({x:t,y:e}),this.label.attr(n),this.opt.cx=t,this.opt.cy=e}},{key:"ToSyncLine",value:function(t,e){var n=this,i=this.getCtpByAp(t,e);this.syncLineMove(function(t,e,r){var o,a=r.position;if("from"==e){var c=t.attr("path");o="get"+a.from+"p";var u=n[o](i.x,i.y);c[0]=["M",u.x,u.y],t.attr("path",c)}else if("to"==e){o="get"+a.to+"p";var l=n[o](i.x,i.y),s=t.attr("path");s[s.length-1]=["L",l.x,l.y],t.attr("path",s)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this,i=this.getCtpByAp(t,e);this.syncLineMove(function(t,e,r){var o,a=r.position;if("from"==e){o="get"+a.from+"p";var c=n[o](i.x,i.y);r.updatePath([c.x,c.y])}else if("to"==e){o="get"+a.to+"p";var u=n[o](i.x,i.y);r.updatePath(null,[u.x,u.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"Bt")+"p"]();return e.position=t,e}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"T")+"p"]();return e.position=t,e}},{key:"getCtpByAp",value:function(t,e){var n=this.opt;return t+=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e-=n.h/2,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,e+=n.h/2,{x:t,y:e}}},{key:"getTp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.h/2,{x:t,y:e}}},{key:"getRp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,{x:t,y:e}}},{key:"getBtp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.h/2,{x:t,y:e}}},{key:"getLp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,{x:t,y:e}}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=n(0),o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.NodeType="line",this.instance=e,this.opt={},this.position={},this.rightAngle=!1}return i(t,[{key:"create",value:function(t,e){this.opt={p1:t,p2:e},this.c=this.instance.path("M"+t[0]+","+t[1]+"L"+e[0]+","+e[1])}},{key:"RightAngle",value:function(t){this.opt=t,this.rightAngle=!0;var e=t.p1,n=t.p2,i=20;t.d&&(i=t.d);var r="";if(e.x!=n.x&&e.y!=n.y){var o=n.x-e.x;r="L"+(e.x+o+i*(o>0?1:-1))+","+e.y+"L"+(e.x+o+i*(o>0?1:-1))+","+n.y}this.c=this.instance.path("M"+e.x+","+e.y+r+"L"+n.x+","+n.y)}},{key:"createByPoint",value:function(t){this.opt=t;var e="";r.Util.each(this.opt.points,function(t,n){n&&(e+=(e?"L":"M")+n.x+","+n.y)}),this.c=this.instance.path(e)}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.NodeType="arrow",this.instance=e,this.opt={},this.position={}}return i(t,[{key:"create",value:function(t,e,n){this.opt={p1:t,p2:e,r:n};var i=this.getPoints();this.c=this.instance.path("M"+t[0]+","+t[1]+"L"+e[0]+","+e[1]+"L"+i.cP.x+","+i.cP.y+"L"+i.dP.x+","+i.dP.y+"L"+e[0]+","+e[1])}},{key:"getPoints",value:function(t,e,n){var i=this.opt;t||(t=i.p1),e||(e=i.p2),n||(n=i.r);var r=Math.atan2(t[1]-e[1],e[0]-t[0])*(180/Math.PI),o=e[0]-n*Math.cos(r*(Math.PI/180)),a=e[1]+n*Math.sin(r*(Math.PI/180));return{cP:{x:o+n*Math.cos((r+120)*(Math.PI/180)),y:a-n*Math.sin((r+120)*(Math.PI/180))},dP:{x:o+n*Math.cos((r+240)*(Math.PI/180)),y:a-n*Math.sin((r+240)*(Math.PI/180))}}}},{key:"updatePath",value:function(t,e,n){var i=this.opt;t||(t=i.p1),e||(e=i.p2),n||(n=i.r);var r=this.getPoints(t,e,n);this.c.attr("path",[["M",t[0],t[1]],["L",e[0],e[1]],["L",r.cP.x,r.cP.y],["L",r.dP.x,r.dP.y],["L",e[0],e[1]]]),this.opt={p1:t,p2:e,r:n}}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.NodeJudge=e.NodeOperation=e.NodeEndpoint=e.NodeArrow=e.NodeLine=e.Flow=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=(n(0),i(n(12))),a=i(n(3)),c=i(n(7)),u=i(n(4)),l=i(n(5)),s=i(n(13)),f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.paper=e}return r(t,[{key:"endpoint",value:function(t,e,n,i){var r=new o.default(this.paper);return r.create(t,e,n,i),r}},{key:"judge",value:function(t,e,n,i,r){var o=new c.default(this.paper);return o.create(t,e,n,i,r),o}},{key:"operation",value:function(t,e,n,i,r){var o=new a.default(this.paper);return o.create(t,e,n,i,r),o}},{key:"line",value:function(t,e){var n=new u.default(this.paper);return n.create(t,e),n}},{key:"rightAngleLine",value:function(t){var e=new u.default(this.paper);return e.RightAngle(t),e}},{key:"arrow",value:function(t,e,n){var i=new l.default(this.paper);return i.create(t,e,n),i}},{key:"bow",value:function(t){var e=new s.default(this.paper);return e.create(t),e}},{key:"getEmptyNode",value:function(t){var e=null;switch(t){case"endpoint":e=new o.default(this.paper);break;case"judge":e=new c.default(this.paper);break;case"operation":e=new a.default(this.paper);break;case"line":e=new u.default(this.paper);break;case"arrow":e=new l.default(this.paper)}return e}}]),t}();e.Flow=f,e.NodeLine=u.default,e.NodeArrow=l.default,e.NodeEndpoint=o.default,e.NodeOperation=a.default,e.NodeJudge=c.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(1)),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.NodeType="judge",n.instance=t,n.opt={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),r(e,[{key:"onlyCell",value:function(t,e,n,i){this.opt={cx:t,cy:e,w:n,h:i};var r=this.getAp(),o=this.getBp(),a=this.getCp(),c=this.getDp();return this.instance.path("M"+r.x+","+r.y+"L"+o.x+","+o.y+"L"+a.x+","+a.y+"L"+c.x+","+c.y+"Z")}},{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":i(t))){var e=arguments;t={cx:e[0],cy:e[1],w:e[2],h:e[3]},e[4]&&(t.text=e[4])}this.opt=t,this.minWidth=t.w;var n=this.getAp(),r=this.getBp(),o=this.getCp(),a=this.getDp();this.c=this.instance.path("M"+n.x+","+n.y+"L"+r.x+","+r.y+"L"+o.x+","+o.y+"L"+a.x+","+a.y+"Z");var c;c=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=c,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("w");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=25,this.opt.w=e,this.resizeByOpt()}}},{key:"resizeByOpt",value:function(){var t=this.getAp(),e=this.getBp(),n=this.getCp(),i=this.getDp();this.c.attr("path",[["M",t.x,t.y],["L",e.x,e.y],["L",n.x,n.y],["L",i.x,i.y],["Z"]])}},{key:"move",value:function(t,e){var n=this.getCpByAp(t,e),i=this.getBp(n.x,n.y),r=this.getCp(n.x,n.y),o=this.getDp(n.x,n.y);this.c.attr("path",[["M",t,e],["L",i.x,i.y],["L",r.x,r.y],["L",o.x,o.y],["Z"]]),this.opt.cx=n.x,this.opt.cy=n.y,this.label.attr(n)}},{key:"ToSyncLine",value:function(t,e){var n=this,i=this.getCpByAp(t,e);this.syncLineMove(function(t,e,r){var o,a=r.position;if("from"==e){o="get"+a.from+"p";var c=n[o](i.x,i.y),u=t.attr("path");u[0]=["M",c.x,c.y],t.attr("path",u)}else if("to"==e){o="get"+a.to+"p";var l=n[o](i.x,i.y),s=t.attr("path");s[s.length-1]=["L",l.x,l.y],t.attr("path",s)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this,i=this.getCpByAp(t,e);this.syncLineMove(function(t,e,r){var o,a=r.position;if("from"==e){o="get"+a.from+"p";var c=n[o](i.x,i.y);r.updatePath([c.x,c.y])}else if("to"==e){o="get"+a.to+"p";var u=n[o](i.x,i.y);r.updatePath(null,[u.x,u.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"D")+"p"]();this.isCoincidence(e,"from")&&(e=this.getCp(),t="C");return{x:e.x,y:e.y,position:t}}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"B")+"p"]();return e.position=t,e}},{key:"getCpByAp",value:function(t,e){return t+=this.opt.w/2,{x:t,y:e}}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.w/2,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.h/2,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.w/2,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.h/2,{x:t,y:e}}},{key:"isCoincidence",value:function(t,e){var n=!1;if(t&&"object"==(void 0===t?"undefined":i(t))&&void 0!==t.x&&void 0!==t.y)if("from"==e){if(this.fromLine.length>0)for(var r=0;r<this.fromLine.length;r++){if((c=(a=this.fromLine[r].c.attr("path"))[0])[1]==t.x&&c[2]==t.y){n=!0;break}}}else if("to"==e&&this.toLine.length>0)for(var o=0;o<this.toLine.length;o++){var a,c;if((c=(a=this.toLine[o].c.attr("path"))[a.length-1])[1]==t.x&&c[2]==t.y){n=!0;break}}return n}}]),e}();e.default=a},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.worker=e.tree=void 0;var r=i(n(9)),o=i(n(11));e.tree=r.default,e.worker=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=i(n(10)),c=n(0),u=i(n(2)),l=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$index=u.default.getIndex(),this.Nodes={},this.config=c.Util.clone(e),this.$raphael=u.default.createInstance(this.config),this.$flow=new a.default(this.$raphael),this.setOption(n),this.draw()}return o(t,[{key:"draw",value:function(){var t=this;if(this.option){var e=this.option.nodes;this.codeIndex(e);var n=this.config,i=this.feature("background.female","rgb(190, 113, 82)"),r=this.feature("background.male","rgb(224, 223, 226)");this.createFeatureKey(i,r);for(var o=n.x||parseInt(.4*n.w),a=n.y||10,u=n.cH||50,l=n.dH||30,s={},f=function(e){var n=t.codeIndex(e),i=null;return n&&n.length>0&&c.Util.each(n,function(t,e){if(s[e])return i=s[e].y,!1}),i},h=function(e){var n=t.codeIndex(e),i=n.length,r=0;return c.Util.each(n,function(t,e){s[e]&&(r+=1)}),i-r},p=0;p<e.length;p++){var y,d=e[p],v=d.code,g=d.name||v,x=this.codeIndex(d.code),b=o;if(d.parent&&-1==d.parent.indexOf(",")){var k=this.getNodeByCode(d.parent);k&&k.c&&(b=this.getStandX(k))}if(x&&x.length>1){var w=h(v),m=Math.ceil(x.length/2),M=b-50,_=(M=b+125*(m-w),f(v));_?M=b+125*(m-w):a+=l+u/2,_=_||a,y=this.$flow.operation(M,_,100,u,g),s[v]={y:a}}else a+=l+u/2,y=this.$flow.operation(b,a,100,u,g);y.$step=d,this.drag(y),"F"==d.type?y.c.attr("fill",i):y.c.attr("fill",r),a+=u/2,y&&(this.Nodes[d.code]=y,this.line(y))}}}},{key:"createFeatureKey",value:function(t,e){this.$flow.operation(20,20,20,20,"男").c.attr("fill",e);this.$flow.operation(20,60,20,20,"女").c.attr("fill",t)}},{key:"drag",value:function(t){!function(t,e){var n={};t.c.drag(function(i,r){i+=n.x,r+=n.y,t.move(i,r),e.line&&"arrow"==e.line?t.ToSyncArrow(i,r):t.ToSyncLine(i,r)},function(){var t,e;if("circle"==this.type)t=this.attr("cx"),e=this.attr("cy");else if("rect"==this.type)t=this.attr("x"),e=this.attr("y");else if("path"==this.type){var i=this.attr("path")[0];t=i[1],e=i[2]}n.x=t,n.y=e},function(){})}(t,this.config)}},{key:"line",value:function(t){var e=this,n=c.Util.clone(t.$step);if(n.parent&&(n.parent=n.parent.replace(/\s/g,"")),n.parent){var i,r=this.config,o=function(t,n){var i,o=e.getNodeByCode(t),a=e.getNodeByCode(n);if(o&&a){var c=o.getStlnP(),u=a.getEnlnP();r.line&&"arrow"==r.line?(i=e.$flow.arrow([c.x,c.y],[u.x,u.y],4)).c.attr("fill","rgb(14, 10, 10)"):i=e.$flow.line([c.x,c.y],[u.x,u.y]),o.recordLine("from",i),a.recordLine("to",i)}};i=n.parent.indexOf(",")>-1?n.parent.split(","):[n.parent];for(var a=0;a<i.length;a++)o(i[a],n.code)}}},{key:"setOption",value:function(t){"object"==(void 0===t?"undefined":r(t))&&(this.option=c.Util.clone(t))}},{key:"getNodeByCode",value:function(t){return this.Nodes[t]?this.Nodes[t]:null}},{key:"codeIndex",value:function(t){if("object"==(void 0===t?"undefined":r(t))){for(var e={},n=0;n<t.length;n++){var i=t[n],o=i.code;if(i.parent)for(var a=i.parent.replace(/\s/g,"").split(","),l=0;l<a.length;l++){var s=a[l],f=e[s]?e[s]:0;if("object"==(void 0===f?"undefined":r(f))&&f.length&&(f=1==f.length?f[0]:f),f+=1,e[o]){if("object"!=r(e[o])){var h=e[o];if(2==f&&e[s]){e[s]=h-1;continue}e[o]=[h]}e[o].push(f),e[o]=c.Util.ArrayMergeSameValue(e[o])}else e[o]=f}else e[o]=1}console.log(e),u.default.src(this.$index,"clsMap",e)}else if(t){if(e=u.default.src(this.$index,"clsMap")){var p=e[t]||null,y=[t];for(var d in e)p==e[d]&&-1==$.inArray(d,y)&&y.push(d);return y}}}},{key:"getStandX",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cx");break;case"rect":e=n.attr("x")+n.attr("width")/2;break;case"path":e=t.opt.cx}}return e}},{key:"feature",value:function(t,e){e=e||null;var n=this.option.feature;if(t&&"object"==(void 0===n?"undefined":r(n))){t=t.replace(/\s/g,"").split(".");var i=c.Util.clone(n);c.Util.each(t,function(t,n){if(i&&"object"==(void 0===i?"undefined":r(i)))i=i[n]||e;else if(!i)return i=e,!1}),e=i}return e}}]),t}();e.default=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=(n(0),i(n(3))),a=i(n(4)),c=i(n(5)),u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.paper=e}return r(t,[{key:"operation",value:function(t,e,n,i,r){var a=new o.default(this.paper);return a.create(t,e,n,i,r),a}},{key:"line",value:function(t,e){var n=new a.default(this.paper);return n.create(t,e),n}},{key:"arrow",value:function(t,e,n){var i=new c.default(this.paper);return i.create(t,e,n),i}}]),t}();e.default=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(6),c=n(0),u=i(n(2)),l=i(n(14)),s=i(n(15)),f=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$index=u.default.getIndex(),this.config=c.Util.clone(e),this.$raphael=u.default.createInstance(this.config),this.$flow=new a.Flow(this.$raphael),this.setOption(n),this.leastLineQue=[],this.draw()}return o(t,[{key:"cNodeMap",value:function(t,e){var n=u.default.src(this.$index,"CodeNodeMaps");return n||(n={}),t?e?(n[t]=e,u.default.src(this.$index,"CodeNodeMaps",n),this):n[t]||!1:n}},{key:"draw2",value:function(){var t=this;if(this.option){var e=this.option.step;this.codeIndex(e);for(var n=this.config,i=n.x||parseInt(.4*n.w),r=n.y||10,o=n.cH||50,a=n.dH||30,u={},l=function(e){var n=t.codeIndex(e),i=null;return n&&n.length>0&&c.Util.each(n,function(t,e){if(u[e])return i=u[e].y,!1}),i},s=function(e){var n=t.codeIndex(e),i=n.length,r=0;return c.Util.each(n,function(t,e){u[e]&&(r+=1)}),i-r},f=0;f<e.length;f++){var h=e[f],p=h.code,y=h.name||p,d=this.cNodeMap(p),v=!1;if(d&&(v=!0),!v)if(1==h.type)r+=a+o/2,(d=this.$flow.endpoint(i,r,o/2,y)).c.attr("fill","rgb(181, 216, 126)"),d.$step=h,this.drag(d),r+=o/2;else if(2==h.type){var g=100,x=this.codeIndex(p),b=i;if(h.prev&&-1==h.prev.indexOf(",")){var k=this.getNodeByCode(h.prev);k&&k.c&&(b=this.getStandX(k))}if(x&&x.length>1){var w=s(p),m=Math.ceil(x.length/2),M=b+(25+g)*(m-w),_=l(p);_?M=b+(25+g)*(m-w):r+=a+o/2,_=_||r,d=this.$flow.operation(M,_,g,o,y),u[p]={y:r}}else r+=a+o/2,d=this.$flow.operation(b,r,g,o,y);d.$step=h,this.drag(d),d.c.attr("fill","rgb(224, 223, 226)"),r+=o/2}else 3==h.type?(r+=a+o/2,(d=this.$flow.judge(i,r,g+60,o,y)).c.attr("fill","rgb(49, 174, 196)"),d.$step=h,this.drag(d),r+=o/2):9==h.type&&(r+=a+o/2,(d=this.$flow.endpoint(i,r,o/2,y)).c.attr("fill","rgb(34, 185, 41)"),d.$step=h,this.drag(d));d&&(v?this.line(d,h):(this.cNodeMap(p,d),this.line(d),this._eventBind(d)))}}}},{key:"checkPaperHight",value:function(t){var e=this.config.dom.find("svg"),n=e.height();n<t+180&&e.css({height:n+80})}},{key:"draw",value:function(){var t=this;this.getNodeCls();var e=u.default.src(this.$index,"_nodeCls"),n=c.Util.clone(this.option),i=.21,r=this.conf("cH",50),o=this.conf("dH",30),a=this.conf("h"),l=e.clsValue,s=this.conf("sColumnMk",!0);i=s?.43:r*(l-1)+o*l<a?.43:i;var f=this.conf("x",parseInt(this.conf("w")*i)),h=f,p=this.conf("y",10),y=p,d=this.conf("bkgOperCol","rgb(224, 223, 226)"),v=this.conf("bkgJudgeCol","rgb(49, 174, 196)");this.conf("currentCode",!1);e.isMuti=function(t){var n=e.map[t];return e.mapDt[n].length>1},e.getMutiY=function(n,i){var r=0;i=i||0;var o=e.map[n],a=e.mapDt[o];return a.length>1&&c.Util.each(a,function(e,n){var i=t.getNodeByCode(n);if(i)return r=t.getStandY(i),!1}),r=r||i},e.getMutiCtt=function(n){var i=e.map[n],r=e.mapDt[i],o=r.length,a=0;return o>1&&c.Util.each(r,function(e,n){t.getNodeByCode(n)&&(a+=1)}),{len:o,hasEd:a}},c.Util.each(n.step,function(n,i){var c,u,l=i.type,g=i.code,x=i.name||g;switch(s?t.checkPaperHight(y):y+2*r>a&&(y=p,h+=f),l){case 1:y+=o,(c=t.$flow.endpoint(h,y,r/2,x)).c.attr("fill",t.conf("pkgStartCol","rgb(181, 216, 126)"));break;case 2:if(u=h,e.isMuti(g)){var b=e.getMutiY(g,null),k=e.getMutiCtt(g);if(2==k.len)k.hasEd>0&&(u+=50+1.5*r);else if(k.len>2){var w=Math.ceil(k.len/2);u+=(25+2*r)*(w-(k.len-k.hasEd))}b?y=b:y+=e.getMutiY(g,2*o+r/2)}else y+=2*o+r/2;(c=t.$flow.operation(u,y,100,r,x)).c.attr("fill",d);break;case 3:y+=2*o+r/2,(c=t.$flow.judge(h,y,100,r,x)).c.attr("fill",v);break;case 9:y+=2*o+r/2,(c=t.$flow.endpoint(h,y,r/2,x)).c.attr("fill",t.conf("bkgEndCol","rgb(34, 185, 41)"))}c&&(c.$step=i,c.c.data("_code",g),c.c.data("_type",l),t.cNodeMap(g,c),t.line(c),t._eventBind(c),t.drag(c))}),this.connectLeastLines()}},{key:"getNodeCls",value:function(){var t=c.Util.clone(this.option),e=0,n={},i={};c.Util.each(t.step,function(t,r){var o=r.prev,a=r.code;o&&n[o]&&(e=n[o]),e+=1,n[a]=e,i[e]?i[e].push(a):i[e]=[a]}),u.default.src(this.$index,"_nodeCls",{map:n,mapDt:i,clsValue:e})}},{key:"drag",value:function(t){!function(t,e){var n={};t.c.drag(function(i,r){i+=n.x,r+=n.y,t.move(i,r),!e.line||"arrow"!=e.line&&"bow"!=e.line?t.ToSyncLine(i,r):t.ToSyncArrow(i,r)},function(){var t,e;if("ellipse"==this.type)t=this.attr("cx"),e=this.attr("cy");else if("rect"==this.type)t=this.attr("x"),e=this.attr("y");else if("path"==this.type){var i=this.attr("path")[0];t=i[1],e=i[2]}n.x=t,n.y=e},function(){})}(t,this.config)}},{key:"line",value:function(t,e){var n=this,i=c.Util.clone(t.$step);if(i.prev&&(i.prev=i.prev.replace(/\s/g,"")),i.prev){var r,o=this.config,a=void 0===o.rightAngle||o.rightAngle,u=this.conf("bkgLineCol","rgb(14, 10, 10)"),l=function(t,e){var i,r=n.getNodeByCode(t),c=n.getNodeByCode(e);if(r&&c){if(o.line&&"arrow"==o.line){var l=r.getStlnP(),s=c.getEnlnP();(i=n.$flow.arrow([l.x,l.y],[s.x,s.y],o.arrowLen?o.arrowLen:4)).position={from:l.position,to:s.position},i.c.attr("fill",u)}else if(o.line&&"bow"==o.line){l=r.getStlnP(),s=c.getEnlnP();var f={queue:[{x:l.x,y:l.y},{x:s.x,y:s.y}]};(i=n.$flow.bow(f)).position={from:l.position,to:s.position},i.arrow.attr({fill:u,stroke:u})}else{l=r.getStlnP(),s=c.getEnlnP();(i=a?n.$flow.rightAngleLine({p1:{x:l.x,y:l.y},p2:{x:s.x,y:s.y}}):n.$flow.line([l.x,l.y],[s.x,s.y])).position={from:l.position,to:s.position}}r.recordLine("from",i),c.recordLine("to",i);var h=n.nodeRunedMk(e);if(h&&i){var p=n.conf("bkgRunedCol","rgb(255, 0, 0)");i.c.attr({stroke:p}),i.arrow&&i.arrow.attr({fill:p,stroke:p}),c.c.attr({stroke:p}),2==h&&r.c.attr({stroke:p})}}else n.leastLineQue.push({from:t,to:e})};r=(e=e||i).prev.indexOf(",")>-1?e.prev.split(","):[e.prev];for(var s=0;s<r.length;s++)l(r[s],e.code)}}},{key:"connectLeastLines",value:function(){var t=this,e=this.config,n=void 0===e.rightAngle||e.rightAngle,i=this.conf("bkgRunedCol","rgb(255, 0, 0)"),r=this.conf("bkgLineCol","rgb(14, 10, 10)");c.Util.each(this.leastLineQue,function(o,a){!function(o,a){var c,u=t.getNodeByCode(o),l=t.getNodeByCode(a);if(u&&l){if(e.line&&"arrow"==e.line){var s=u.getStlnP(),f=l.getEnlnP();(c=t.$flow.arrow([s.x,s.y],[f.x,f.y],e.arrowLen?e.arrowLen:4)).position={from:s.position,to:f.position},c.c.attr("fill",r)}else if(e.line&&"bow"==e.line){var h=3==u.c.data("_type"),p=(s=u.getStlnP(h?"A":null),!1);h&&(p=2==l.c.data("_type")?"L":"A"),f=l.getEnlnP(p);var y={queue:[{x:s.x,y:s.y},{x:s.x-50,y:s.y},{x:s.x-50,y:f.y},{x:f.x,y:f.y}]};(c=t.$flow.bow(y)).position={from:s.position,to:f.position},c.arrow.attr({fill:r,stroke:r})}else s=u.getStlnP(),f=l.getEnlnP(),(c=n?t.$flow.rightAngleLine({p1:{x:s.x,y:s.y},p2:{x:f.x,y:f.y}}):t.$flow.line([s.x,s.y],[f.x,f.y])).position={from:s.position,to:f.position};u.recordLine("from",c),l.recordLine("to",c);var d=t.nodeRunedMk(a);d&&c&&(c.c.attr({stroke:i}),c.arrow&&c.arrow.attr({fill:i,stroke:i}),l.c.attr({stroke:i}),2==d&&u.c.attr({stroke:i}))}}(a.from,a.to)})}},{key:"setOption",value:function(t){"object"==(void 0===t?"undefined":r(t))&&(this.option=c.Util.clone(t))}},{key:"getNodeByCode",value:function(t){var e=null,n=this.cNodeMap(t);return n&&(e=n),e}},{key:"codeIndex",value:function(t){if("object"==(void 0===t?"undefined":r(t))){for(var e={},n=0;n<t.length;n++){var i=t[n],o=i.code;if(i.prev)for(var a=i.prev.replace(/\s/g,"").split(","),l=0;l<a.length;l++){var s=a[l],f=e[s]?e[s]:0;if("object"==(void 0===f?"undefined":r(f))&&f.length&&(f=1==f.length?f[0]:f),f+=1,e[o]){if("object"!=r(e[o])){var h=e[o];e[o]=[h]}e[o].push(f),e[o]=c.Util.ArrayMergeSameValue(e[o])}else e[o]=f}else e[o]=1}u.default.src(this.$index,"clsMap",e)}else if(t){if(e=u.default.src(this.$index,"clsMap")){var p=e[t]||null,y=[t];for(var d in e)p==e[d]&&-1==$.inArray(d,y)&&y.push(d);return y}}}},{key:"getStandX",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cx");break;case"rect":e=n.attr("x")+n.attr("width")/2;break;case"path":e=t.opt.cx}}return e}},{key:"getStandY",value:function(t){var e=null;if(t&&t.c){var n=t.c;switch(n.type){case"circle":e=n.attr("cy");break;case"rect":e=n.attr("y")+n.attr("height")/2;break;case"path":e=t.opt.cy}}return e}},{key:"removeBBox",value:function(){var t=this.cNodeMap();for(var e in t){var n=t[e];n.bBox&&n.bBox.remove()}}},{key:"_eventBind",value:function(t){var e=this;t.c.click(function(){e.removeBBox(),t.bBox&&t.bBox.remove();var n=this.getBBox();t.bBox=t.instance.rect(n.x-5,n.y-5,n.width+10,n.height+10),t.bBox.attr({stroke:e.conf("bkgNodeBox","rgb(15, 13, 105)")})});var n=this.conf("texteditor",!1),i=t.label;if(n&&i){var o=this.conf("texteditor");(o="object"==(void 0===o?"undefined":r(o))?o:{}).id=o.id?o.id:"worker-txteditor",o.class=o.class?o.class:"worker-txteditor-div",i.dblclick(function(){var e=i.attr("text"),n=$("#"+o.id);if(0==n.length){var r='<div class="'+o.class+'"><input type="text" id="'+o.id+'"></div>';$("body").append(r),n=$("#"+o.id)}n.show(),n.val(e),n.css({top:i.attr("y"),left:i.attr("x")}),n.focus(),n.off("blur").on("blur",function(){var e=$(this),n=e.val();n&&i.attr("text",n),e.hide(),"function"==typeof t.resizeByText&&t.resizeByText()})})}}},{key:"conf",value:function(t,e){return e=e||null,void 0!==this.config[t]&&(e=this.config[t]),e}},{key:"nodeRunedMk",value:function(t){var e=this.conf("currentCode",!1);if(e){var n=u.default.src(this.$index,"_nodeCls"),i=n.map[e],r=n.map[t];e=r<=i&&r}return e}}],[{key:"editor",value:function(t){return new l.default(t)}}]),t}();f.Version=s.default,e.default=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=(n(0),function(t){return t&&t.__esModule?t:{default:t}}(n(1))),a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.NodeType="endpnt",n.instance=t,n.opt={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),r(e,[{key:"create",value:function(t){if("object"!=(void 0===t?"undefined":i(t))){var e=arguments;t={cx:e[0],cy:e[1],r:e[2]},e[3]&&(t.text=e[3])}t.h=t.h?t.h:t.r,this.minWidth=2*t.r,this.opt=t,this.c=this.instance.ellipse(t.cx,t.cy,t.r,t.h);var n;n=t.text?this.instance.text(t.cx,t.cy,t.text):this.instance.text(t.cx,t.cy),this.label=n,this.resizeByText()}},{key:"resizeByText",value:function(){if(this.label){var t=this.label.getBBox(),e=Math.ceil(t.width),n=this.c.attr("rx");if(e<this.minWidth&&n<this.minWidth)return;e<this.minWidth?e=this.minWidth:e+=2,this.opt.r=e/2,this.resizeByOpt()}}},{key:"resizeByOpt",value:function(){var t=this.opt;this.c.attr({cx:t.cx,cy:t.cy,rx:t.r,ry:t.h})}},{key:"move",value:function(t,e){this.c.attr({cx:t,cy:e}),this.label.attr({x:t,y:e}),this.opt.cx=t,this.opt.cy=e}},{key:"ToSyncLine",value:function(t,e){var n=this;this.syncLineMove(function(i,r,o){var a,c=o.position;if("from"==r){var u=i.attr("path");a="get"+c.from+"p";var l=n[a](t,e);u[0]=["M",l.x,l.y],i.attr("path",u)}else if("to"==r){var s=i.attr("path");a="get"+c.to+"p";var f=n[a](t,e);s[s.length-1]=["L",f.x,f.y],i.attr("path",s)}})}},{key:"ToSyncArrow",value:function(t,e){var n=this;this.syncLineMove(function(i,r,o){var a,c=o.position;if("from"==r){a="get"+c.from+"p";var u=n[a](t,e);o.updatePath([u.x,u.y])}else if("to"==r){a="get"+c.to+"p";var l=n[a](t,e);o.updatePath(null,[l.x,l.y])}})}},{key:"getStlnP",value:function(t){var e=this["get"+(t=t||"D")+"p"]();return e.position=t,e}},{key:"getEnlnP",value:function(t){var e=this["get"+(t=t||"B")+"p"]();return e.position=t,e}},{key:"getAp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t-=n.r,{x:t,y:e}}},{key:"getBp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e-=n.r,{x:t,y:e}}},{key:"getCp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,t+=n.r,{x:t,y:e}}},{key:"getDp",value:function(t,e){var n=this.opt;return t=t||n.cx,e=e||n.cy,e+=n.r,{x:t,y:e}}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.NodeType="bow",this.instance=e,this.opt={},this.position={}}return i(t,[{key:"create",value:function(t){this.opt=t,this.queueCheck(),this.bodySharp(),this.arrowSharp()}},{key:"arrowSharp",value:function(){var t=this.opt,e=t.queue,n=t.r?t.r:5,i=e.length,r=e[i-1],o=e[i-2],a=Math.atan2(o.y-r.y,r.x-o.x)*(180/Math.PI),c=r.x-n*Math.cos(a*(Math.PI/180)),u=r.y+n*Math.sin(a*(Math.PI/180)),l=c+n*Math.cos((a+120)*(Math.PI/180)),s=u-n*Math.sin((a+120)*(Math.PI/180)),f=c+n*Math.cos((a+240)*(Math.PI/180)),h=u-n*Math.sin((a+240)*(Math.PI/180));this.arrow?this.arrow.attr("path",[["M",r.x,r.y],["L",l,s],["L",f,h],["L",r.x,r.y]]):this.arrow=this.instance.path("M"+r.x+","+r.y+"L"+l+","+s+"L"+f+","+h+"L"+r.x+","+r.y)}},{key:"bodySharp",value:function(){var t=this.opt.queue,e="",n=[],i=!1,r=!0;i=!!this.c;for(var o=0;o<t.length;o++){var a=t[o];i?(r&&n.length>0&&(r=!1),n.push([r?"M":"L",a.x,a.y])):e+=(e?"L":"M")+","+a.x+","+a.y}i?this.c.attr("path",n):this.c=this.instance.path(e)}},{key:"queueCheck",value:function(){var t=this.opt.queue;if(2==t.length){var e=[],n=t[0],i=t[1];n.x<i.x?e.push({x:i.x,y:n.y}):n.x>i.x&&(e.push({x:n.x,y:i.y-20}),e.push({x:i.x,y:i.y-20})),this.opt.queue=[n].concat(e,i)}}},{key:"updatePath",value:function(t,e,n){var i=this.opt;if(t&&(i.queue[0]={x:t[0],y:t[1]}),e){var r=i.queue.length-1;i.queue[r]={x:e[0],y:e[1]}}this.queueCheck(),this.bodySharp(),this.arrowSharp()}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=i(n(2)),c=i(n(7)),u=n(6),l={type:1,text:"开始"},s={type:2,text:"任务"},f={type:3,text:"判断"},h={type:9,text:"结束"},p={type:1801,text:"箭头"},y={type:1802,text:"文本框",size:10,selected:{"font-size":20,fill:"red"},defAtrr:{"font-size":10,fill:"black"}},d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.raphael=a.default.createInstance(e),this._configMergeToDefule(),this._rIdx=0,this._code2EidDick={},this._LineDragingP=null,this.flow=new u.Flow(this.raphael),this.nodeQueues=[],this.lineQueues=[],this.textQueues=[],this.tempNodes=[],this.MagneticCore=null,this.config.noToolBar||this._toolbar(),this.config.stepCfg&&this.loadStep(this.config.stepCfg)}return o(t,[{key:"_configMergeToDefule",value:function(){var t=this.config.pkgClr||{};t.start=t.start||"rgb(181, 216, 126)",t.opera=t.opera||"rgb(224, 223, 226)",t.judge=t.judge||"rgb(49, 174, 196)",t.end=t.end||"rgb(34, 185, 41)",t.arrow=t.arrow||"rgb(3, 84, 41)",t.NodeBox=t.NodeBox||"rgb(15, 13, 105)",this.config.pkgClr=t,this.config.prefCode=this.config.prefCode||"A",this.config.listener=this.config.listener||{},this.config.noToolBar=this.config.noToolBar||!1}},{key:"_toolbar",value:function(){var t={},e=this.raphael,n=5,i=5,r=this.config.pkgClr;t.containerIst=e.rect(5,5,75,300),t.containerIst.attr("fill","#ffffff"),n+=20,i+=50,t.startIst=e.ellipse(n,i,8,6),t.startIst.attr("fill",r.start),t.startTxtIst=e.text(n+30,i,l.text),i+=20,t.operaIst=e.rect(n-8,i,16,12),t.operaIst.attr("fill",r.opera),t.operaTxtIst=e.text(n+30,i+4,s.text),i+=30,t.judgeIst=new c.default(e).onlyCell(n,i,16,12),t.judgeIst.attr("fill",r.judge),t.judgeTxtIst=e.text(n+30,i,f.text),i+=30,t.endIst=e.ellipse(n,i,8,6),t.endIst.attr("fill",r.end),t.endTxtIst=e.text(n+30,i,h.text),i+=30,t.arrowIst=this.flow.arrow([n-5,i],[n+10,i],3),t.arrowIst.c.attr("fill",r.arrow),t.arrowTxtIst=e.text(n+30,i,p.text),i+=30,t.textInst=this.raphael.text(n+10,i,y.text),this.$tool=t,this._toolbarDragEvt()}},{key:"_toolbarDragEvt",value:function(){var t=this,e=this.config.pkgClr,n=function(e,n){t.MagneticCore=null;var i={};e.drag(function(e,n){e+=i.dx,n+=i.dy;var r=t.getLastElem();r&&r.move(e,n)},function(){var e,r;if(2==n)e=this.attr("x"),r=this.attr("y");else if(3==n){var o=this.attr("path")[0];e=o[1],r=o[2]}else e=this.attr("cx"),r=this.attr("cy");i.dx=e+5,i.dy=r+10,t._createNode(i,n)},function(){})};n(this.$tool.startIst,l.type),n(this.$tool.startTxtIst,l.type),n(this.$tool.operaIst,s.type),n(this.$tool.operaTxtIst,s.type),n(this.$tool.judgeIst,f.type),n(this.$tool.judgeTxtIst,f.type),n(this.$tool.endIst,h.type),n(this.$tool.endTxtIst,h.type);var i=function(n){var i={x:0,y:0},r=null;n.drag(function(t,e){t+=i.x,e+=i.y,r&&r.updatePath([t,e],[t+50,e])},function(){if("text"==n.type)i.x=n.attr("x"),i.y=n.attr("y");else{var o=n.attr("path");o=o[0],i.x=o[1],i.y=o[2]}(r=t.flow.arrow([i.x,i.y],[i.x+50,i.y],5)).c.attr("fill",e.arrow),t._lineTragEvent(r),t.lineQueues.push(r)},function(){})};i(this.$tool.arrowIst.c),i(this.$tool.arrowTxtIst),function(){var e={x:0,y:0},n=null;t.$tool.textInst.drag(function(t,i){t+=e.x,i+=e.y,n&&n.attr({x:t,y:i})},function(){e.x=this.attr("x")+5,e.y=this.attr("y")+5,n=t.raphael.text(e.x,e.y,"文本框"),t._textBindEvent(n),t.textQueues.push(n)},function(){})}()}},{key:"_getOrderCode",value:function(){this._rIdx+=1;var t=this.config.prefCode+this._rIdx;return this._code2EidDick[t]&&(t=this._getOrderCode()),t}},{key:"removeBBox",value:function(){this.MagneticCore=null;for(var t=this.nodeQueues,e=0;e<t.length;e++){var n=t[e];n.bBox&&(n.bBox.remove(),n.bBox=null)}for(var i=this.tempNodes,r=0;r<i.length;r++){i[r].remove()}for(var o=this.lineQueues,a=0;a<o.length;a++){var c=o[a];o.selectEdMk&&(c.selectEdMk=!1)}this.removeIntersectMk(),this.tempNodes=[]}},{key:"removeNode",value:function(t){if(t||(t=this.getSelected()),t){var e="object"==(void 0===t?"undefined":r(t))?t:this._code2EidDick[t]?this.raphael.getById(this._code2EidDick[t]):this.raphael.getById(t);if("object"==(void 0===e?"undefined":r(e))){var n=e.id,i=!1;if("arrow"==e.NodeType&&(i=!0),e.bBox&&(e.bBox.remove(),e.bBox=null),e.label&&(e.label.remove(),e.label=null),e.selectEdMk&&(e.selectEdMk=!1),e.c.remove(),e=null,i){for(var o=this.lineQueues,a=[],c=0;c<o.length;c++){var u=o[c];n!=u.c.id&&a.push(u)}this.lineQueues=a}else{for(var l=this.nodeQueues,s=[],f=0;f<l.length;f++){var h=l[f];n!=h.c.id&&s.push(h)}this.nodeQueues=s}return this.removeBBox(),!0}}return!1}},{key:"removeIntersectMk",value:function(){for(var t=this.nodeQueues,e=null,n=0;n<t.length;n++){var i=t[n];if(i._IntersectMk){i._IntersectMk=!1;var r=i.NodeType,o=this.config.pkgClr;o[r]?i.c.attr("fill",o[r]):1==(r=i.c.data("type"))?i.c.attr("fill",o.start):9==r&&i.c.attr("fill",o.end),e=i}}return e}},{key:"removeConLine",value:function(t,e){if(t&&e)for(var n=this.nodeQueues,i=t.c.id,r=0;r<n.length;r++){var o=n[r],a=e+"Line";if(o[a]&&o[a].length){for(var c=o[a],u=[],l=0;l<c.length;l++){var s=c[l];i!=s.c.id&&u.push(s)}o[a]=u}}return!1}},{key:"getNodeByCode",value:function(t){for(var e=null,n=this.nodeQueues,i=0;i<n.length;i++){var r=n[i];if(r.c.data("code")==t){e=r;break}}return e}},{key:"getNodeByEid",value:function(t){for(var e=null,n=this.nodeQueues,i=0;i<n.length;i++){var r=n[i];if(r.c.id==t){e=r;break}}return e}},{key:"code2Id",value:function(t,e){if(t&&!e)return this._code2EidDick[t]||null;if(e&&!t){var n=this._code2EidDick;for(var i in n)if(e==n[i])return i;return null}return e&&t?(this._code2EidDick[t]=e,this):void 0}},{key:"setOption",value:function(t,e){if(t){"object"!=(void 0===t?"undefined":r(t))&&(t={text:t}),e||(e=this.getSelected());var n="object"==(void 0===e?"undefined":r(e))?e:this.getNodeByCode(e);n&&t.text&&n.label&&(n.label.attr("text",t.text),n.opt=n.opt||{},n.opt.text=t.text,"function"==typeof n.resizeByText&&n.resizeByText())}return!1}},{key:"cloneNode",value:function(t){if(t||(t=this.getSelected()),t){var e="object"==(void 0===t?"undefined":r(t))?t:this.raphael.getById(t);if("object"==(void 0===e?"undefined":r(e))){e.id;return e.c.clone(),e.label.clone(),!0}}return!1}},{key:"getSelected",value:function(){for(var t=this.nodeQueues,e=null,n=0;n<t.length;n++){var i=t[n];if(i.bBox){e=i;break}}if(!e)for(var r=this.lineQueues,o=0;o<r.length;o++){var a=r[o];a.selectEdMk&&(e=a)}return e}},{key:"getLastElem",value:function(){var t=null,e=this.nodeQueues;return e.length>0&&(t=e[e.length-1]),t}},{key:"getFlowStep",value:function(){for(var t=[],e=this.nodeQueues,n=0;n<e.length;n++){var i=e[n],r=this.getFlowJson(i);t.push(r)}return t}},{key:"getFlowJson",value:function(t){t||(t=this.getSelected());var e={};if(t){var n=t.label||null,i=t.c;e={name:n?n.attr("text"):"",code:i.data("code"),type:i.data("type"),_struct:t.toJson()};for(var r=t.toLine,o=[],a=0;a<r.length;a++){(s=this.getLineCntCode("from",r[a].c.id,t))&&o.push(s)}e.prev=o.length>0?o.join(","):"";for(var c=t.fromLine,u=[],l=0;l<c.length;l++){var s;(s=this.getLineCntCode("to",c[l].c.id,t))&&u.push(s)}e.next=u.length>0?u.join(","):""}else e=null;return e}},{key:"getLineCntCode",value:function(t,e,n){if(t&&e){var i=this.nodeQueues,r=null;n&&(r="string"==typeof n?n:n.c.data("code"));for(var o=t+"Line",a=0;a<i.length;a++){var c=i[a],u=c.c.data("code");if(r!=u)for(var l=c[o],s=0;s<l.length;s++){if(e==l[s].c.id)return u}}}return null}},{key:"getIntersectElem",value:function(t){var e=null;if("object"==(void 0===t?"undefined":r(t)))for(var n=this.nodeQueues,i=0;i<n.length;i++){var o=n[i],a=o.NodeType;if("endpnt"==a){var c=(f=o.c).attr("cx"),u=f.attr("cy"),l=f.attr("rx"),s=f.attr("ry");if(t.x>=c-l&&t.x<=c+l&&t.y>=u-s&&t.y<=u+s){e=o;break}}else if("opera"==a){var f,h=(f=o.c).attr("x"),p=f.attr("y"),y=f.attr("width"),d=f.attr("height");if(t.x>=h&&t.x<=h+y&&t.y>=p&&t.y<=p+d){e=o;break}}else if("judge"==a){var v=o.opt;c=v.cx,u=v.cy,d=v.h,y=v.w;if(t.x>=c-y/2&&t.x<=c+y/2&&t.y>=u-d/2&&t.y<=u+d/2){e=o;break}}}return e}},{key:"loadStep",value:function(t){if("object"==(void 0===t?"undefined":r(t))){for(var e={},n=this.config.pkgClr,i=function(t,n){if(-1==t.indexOf(","))for(var i=-1==n.indexOf(",")?[n]:n.split(","),r=0;r<i.length;r++){var o=t+"__"+i[r];e[o]||(e[o]=!0)}else if(-1==n.indexOf(","))for(var a=-1==t.indexOf(",")?[t]:t.split(","),c=0;c<a.length;c++){o=a[c]+"__"+n;e[o]||(e[o]=!0)}},o=0;o<t.length;o++){var a=t[o],c=a._struct.opt,u=(n=this.config.pkgClr,a.type),l=null;if(1==u||9==u?(l=this.flow.endpoint(c.cx,c.cy,c.r,c.text),1==u?l.c.attr("fill",n.start):l.c.attr("fill",n.end)):2==u?(l=this.flow.operation(c.cx,c.cy,c.w,c.h,c.text)).c.attr("fill",n.opera):3==u&&(l=this.flow.judge(c.cx,c.cy,c.w,c.h,c.text)).c.attr("fill",n.judge),l){var s=a.code||l.c.data("code"),f=l.c.id;s||(s=this._getOrderCode()),l.c.data("code",s),this._code2EidDick[s]=f,l.c.data("type",u),this._bindEvent(l),this.nodeQueues.push(l);var h=a.prev||null;h&&i(h,s);var p=a.next||null;p&&i(s,p)}}for(var y in e){var d=y.split("__"),v=this.getNodeByCode(d[0]),g=this.getNodeByCode(d[1]),x=v.getStlnP(),b=g.getEnlnP(),k=this.flow.arrow([x.x,x.y],[b.x,b.y],5);k.position||(k.position={}),k.position.from=x.position,v.recordLine("from",k),g.recordLine("to",k),k.position.to=b.position,k.c.attr("fill",n.arrow),this._lineTragEvent(k),this.lineQueues.push(k)}}return this}},{key:"_createNode",value:function(t,e){var n=null,i=this.config.pkgClr;switch(e){case 1:(n=this.flow.endpoint(t.dx,t.dy,10,"开始")).c.attr("fill",i.start);break;case 2:(n=this.flow.operation(t.dx,t.dy,50,40,"操作流程")).c.attr("fill",i.opera);break;case 3:(n=this.flow.judge(t.dx,t.dy,50,40,"流程判断")).c.attr("fill",i.judge);break;case 9:(n=this.flow.endpoint(t.dx,t.dy,10,"结束")).c.attr("fill",i.end)}if(n){var r=r=this._getOrderCode();n.c.data("code",r),this._code2EidDick[r]=n.c.id,n.c.data("type",e),this._bindEvent(n),this.nodeQueues.push(n)}}},{key:"_bindEvent",value:function(t){if(t){var e=this,n=this.config.pkgClr;!function(){var e={};t.c.drag(function(n,i){n+=e.x,i+=e.y,t.move(n,i),t.ToSyncArrow(n,i)},function(){var t,n;if("ellipse"==this.type)t=this.attr("cx"),n=this.attr("cy");else if("rect"==this.type)t=this.attr("x"),n=this.attr("y");else if("path"==this.type){var i=this.attr("path")[0];t=i[1],n=i[2]}e.x=t,e.y=n},function(){e={x:0,y:0}})}(),t.c.click(function(){e.removeBBox();var i=this.getBBox();t.bBox=t.instance.rect(i.x-5,i.y-5,i.width+10,i.height+10),t.bBox.attr({stroke:n.NodeBox}),e.onNodeClick(t)})}}},{key:"_lineTragEvent",value:function(t){if(!t||"object"!=(void 0===t?"undefined":r(t)))return!1;var e=this;return function(t){t.c.click(function(){e.removeBBox(),t.selectEdMk=!0;var n=t.opt,i=e.raphael.circle(n.p1[0],n.p1[1],3);i.attr("fill","#000000");var r=e.raphael.circle(n.p2[0],n.p2[1],3);r.attr("fill","#000000");var o=function(n,i){var r={ax:0,ay:0};n.drag(function(n,o){n+=r.ax,o+=r.ay;var a=e.getIntersectElem({x:n,y:o});if(a){e.removeIntersectMk(),a.c.attr("fill","#FF0000"),a._IntersectMk=!0;var c;n=(c=i?a.getEnlnP():a.getStlnP()).x,o=c.y;var u=i?"to":"from";e.removeConLine(t,u),a.recordLine(u,t),t.position||(t.position={}),t.position[u]=c.position}i?(t.updatePath(null,[n,o]),this.data("type","to")):(t.updatePath([n,o]),this.data("type","from")),e.MagneticCore=this,this.attr({cx:n,cy:o})},function(){r.ax=this.attr("cx"),r.ay=this.attr("cy")},function(){e.MagneticCore=null})};o(i),o(r,!0),e.tempNodes.push(i,r)})}(t),!0}},{key:"_textBindEvent",value:function(t){var e=this;!function(t){var e={x:0,y:0};t.drag(function(n,i){n+=e.x,i+=e.y,t.attr({x:n,y:i})},function(){e.x=t.attr("x"),e.y=t.attr("y")},function(){})}(t),t.click(function(){e._removeTxtSelect(),this.attr(y.selected),this.data("selectMk",!0)})}},{key:"_removeTxtSelect",value:function(){for(var t=this.textQueues,e=0;e<t.length;e++){var n=t[e];n.data("selectMk")&&(n.attr(y.defAtrr),n.data("selectMk",!1))}}},{key:"onNodeClick",value:function(t){}}]),t}();e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={version:"1.1.7",release:"20180315",author:"Joshua Conero"}}]);