!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);var n,i=0,r={},a=function(){function t(){}return t.createInstance=function(t){return(t="object"==typeof t?t:{}).dom,"string"==typeof t.dom&&(t.dom=$(t.dom)),t.w||(t.w=1.1*$(window).width()),t.h||(t.h=1.1*$(window).height()),Raphael(t.dom.get(0),t.w,t.h)},t.onMoveEvt=function(){},t.onStartEvt=function(){},t.onEndEvt=function(){},t.getIndex=function(){return i+=1},t.src=function(t,e,o){r[t]||(r[t]={});var n=r[t];return void 0===e?n:void 0===o?n[e]||null:void(n[e]=o)},t}(),c={version:"2.2.11",release:"20180710",author:"Joshua Conero",name:"zmapp-workflow-ts"},s=function(){function t(){}return t.clone=function(t){t="object"==typeof t?t:{};return $.extend(!0,{},t)},t.ArrayMergeSameValue=function(t){if("object"==typeof t&&t.length&&t.length>1){for(var e={},o=[],n=0;n<t.length;n++)e[t[n]]||(o.push(t[n]),e[t[n]]=!0);t=o}return t},t.each=function(t,e){if("object"==typeof t)if(this.isArray(t))for(var o=0;o<t.length&&!1!==e(o,t[o]);o++);else for(var n in t)if(!1===e(n,t[n]))break},t.ucFirst=function(t,e){e=e||"_";var o=t.split(e);return o.forEach(function(t,e){o[e]=t.substr(0,1).toUpperCase()+t.substr(1)}),o.join("")},t.isArray=function(t){return"object"==typeof t&&t instanceof Array},t.jsonMerge=function(e,o){return e=e||{},t.each(o,function(t,o){e[t]=o}),e},t.jsonValues=function(e){var o=[];return t.each(e,function(t,e){o.push(e)}),o},t.subArray=function(t,e,o){var n=[],i=t.length;e=e||0,(o=o||t.length-1)<0&&(o=i+o-1);for(var r=0;r<i;r++)r>=e&&r<=o&&n.push(t[r]);return n},t.inArray=function(t,e){e=e||[];for(var o=0;o<e.length;o++)if(t==e[o])return o;return-1},t.MergeArr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=[],n=0;n<t.length;n++){var i=t[n];i="object"==typeof i?i:[i],o=o.concat(i)}return o},t}(),h={begin:{type:1,text:"开始"},task:{type:2,text:"任务"},cond:{type:3,text:"判断"},audit:{type:4,text:"审核"},sign:{type:5,text:"会签"},parallel:{type:6,text:"并行"},merge:{type:7,text:"合并"},subFlow:{type:8,text:"子流程"},end:{type:9,text:"结束"},text:{type:9994,text:"文本"}},p=function(){function t(){}return t.ps2arrow=function(t,e,o,n){var i=Math.atan2(t.y-e.y,e.x-t.x)*(180/Math.PI),r=e.x-o*Math.cos(i*(Math.PI/180)),a=e.y+o*Math.sin(i*(Math.PI/180)),c=[e],s=[{x:r+o*Math.cos((i+120)*(Math.PI/180)),y:a-o*Math.sin((i+120)*(Math.PI/180))},{x:r+o*Math.cos((i+240)*(Math.PI/180)),y:a-o*Math.sin((i+240)*(Math.PI/180))},e];return c=n?s:c.concat(s)},t.getPLen=function(t,e){return Math.pow(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2),.5)},t.point2Poly=function(t,e,o){var n;return t.x!=e.x&&t.y!=e.y&&(n=o?{x:t.x,y:e.y}:{x:e.x,y:t.y}),n},t.ps2Path=function(t,e){for(var o="",n=0;n<t.length;n++)o+=(o?"L":"M")+t[n].x+","+t[n].y;return e&&(o+="Z"),o},t.path2ps=function(t){var e=[];return s.each(t.attr("path"),function(t,o){e.push({x:o[1],y:o[2]})}),e},t.ps2PathAttr=function(t,e){for(var o=[],n=0;n<t.length;n++){var i=["L"];0==o.length&&(i[0]="M"),i.push(t[n].x,t[n].y),o.push(i)}return e&&o.push(["Z"]),o},t.middP=function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},t.polyP=function(t,e,o){var n;return o=o?o.toLowerCase():"la",t.x!=e.x&&t.y!=e.y&&("ua"==o?n={x:e.x,y:t.y}:"la"==o&&(n={x:t.x,y:e.y})),n},t}(),l=function(){function t(t,e){if(this.conLns={from:[],to:[]},this.tRElem={},this._dataQueueDick={},this.isSelEd=!1,this.paper=t,this.NodeType=null,e){e.bkgMagnetic=e.bkgMagnetic||"#FF0000";e.features;this.opt=e}this._onInit()}return t.prototype.feature=function(t,e,o){var n=this.opt.features||{};if(e)return"object"==typeof t?n=s.jsonMerge(n,t):n[t]=e,this.opt.features=n,this;if("object"==typeof t)return null;var i=n[t]||null;return o&&!i?(n[t]=o,this.opt.features=n,o):i},t.prototype.data=function(t,e){var o=this;return void 0===e?void 0===t?s.clone(this._dataQueueDick):"object"==typeof t?(s.each(t,function(t,e){o._dataQueueDick[t]=e}),this):this._dataQueueDick[t]:(this._dataQueueDick[t]=e,this._code||"_code"!=t||(this._code=e),this)},Object.defineProperty(t.prototype,"code",{get:function(){return this._code},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){var t=this.opt.text||"";return t&&t.indexOf("\n")>-1&&(t=t.replace(/\n/g,"")),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_key",{get:function(){var t=this.NodeType;if(t.indexOf("_")>-1){var e=t.split("_");s.each(e,function(t,o){t>0&&(o=o.substr(0,1).toLocaleUpperCase()+o.substr(1),e[t]=o)}),t=e.join("")}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){this.code;var t=h[this._key];return t?t.type:null},enumerable:!0,configurable:!0}),t.prototype.creator=function(t){return this._whenCreatorEvt(),this},t.prototype._ps2Path=function(t,e){return p.ps2Path(t,e)},t.prototype._ps2PathAttr=function(t,e){return p.ps2PathAttr(t,e)},t.prototype.line=function(t,e){return e?this.conLns.to.push(t):this.conLns.from.push(t),this},t.prototype.rmLine=function(t,e){if(t)if(e){var o=[];s.each(this.conLns.to,function(e,n){n!=t&&o.push(n)}),this.conLns.to=o}else{var n=[];s.each(this.conLns.from,function(e,o){o!=t&&n.push(o)}),this.conLns.from=n}return this},t.prototype._whenCreatorEvt=function(){},t.prototype._onInit=function(){},t.prototype.onDrag=function(){},t.prototype.getPLen=function(t,e){return Math.pow(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2),.5)},t.prototype._updAttr=function(t){for(var e in t)void 0!==this.opt[e]&&(this.opt[e]=t[e]);return this},t.prototype._getTextPnt=function(){var t=this.opt;return{x:t.cx+1,y:t.cy+1}},t.prototype.delete=function(){this.c.remove(),this.label&&this.label.remove(),this.inlineEle&&this.inlineEle.remove(),this.inlinesEle&&this.inlinesEle.forEach(function(t){t.remove()}),this.clearTmpElem()},t.prototype.hide=function(){return this.c&&this.c.hide(),this.label&&this.label.hide(),this.inlinesEle&&this.inlinesEle.forEach(function(t){t.hide()}),this.inlineEle&&this.inlineEle.hide(),this},t.prototype.show=function(){return this.c&&this.c.show(),this.label&&this.label.show(),this.inlinesEle&&this.inlinesEle.forEach(function(t){t.show()}),this.inlineEle&&this.inlineEle.show(),this},t.prototype.moveable=function(t){var e=this;t="object"==typeof t?t:{},this.c.undrag();var o={cx:0,cy:0};return this.c.drag(function(n,i){n==i&&0==i||t.beforeMv&&"function"==typeof t.beforeMv&&!1===t.beforeMv(e)||(n+=o.cx,i+=o.cy,e.updAttr({cx:n,cy:i}),e.select(),t.afterUpd&&"function"==typeof t.afterUpd&&t.afterUpd(n,i,e))},function(){var t=e.opt,n=t.cx,i=t.cy;o={cx:n,cy:i}}),e},t.prototype.updAttr=function(t){return this},t.prototype.updTextAttr=function(t){var e=this._getTextPnt(),o=e.x,n=e.y;return this.label&&this.label.attr({x:o,y:n}),t&&(this.label?this.label.attr("text",t):this.label=this.paper.text(o,n,t)),this},t.prototype.getBBox=function(){var t=this.c.getBBox(),e=t.x,o=t.y,n=t.width,i=t.height,r=this.feature("boxPadding",null,3),a=(e-=r)+(n+=2*r)/2,c=e+n,s=(o-=r)+(i+=2*r)/2,h=o+i;return{attr:{x:e,y:o,width:n,height:i},ps:{a:{x:e,y:o},b:{x:a,y:o},c:{x:c,y:o},d:{x:c,y:s},e:{x:c,y:h},f:{x:a,y:h},g:{x:e,y:h},h:{x:e,y:s}}}},t.prototype.getIconP=function(){var t=this._getTextPnt(),e=this.opt,o=e.w,n=e.h;return t.x-=o/2-5,t.y-=n/2-5,t},t.prototype.magnCore=function(t,e){var o,n,i=this.getBBox(),r=i.attr,a=i.ps,c=r.x,s=r.y,h=r.width,p=r.height,l=c+h/4,u=c+.75*h,f=s+p/4,d=s+.75*p,y=null;return t<=l&&e<=f?(o=a.a,y="a"):t>l&&t<u&&e<=f?(o=a.b,y="b"):t>=u&&e<=f?(o=a.c,y="c"):t>=u&&e>f&&e<d?(o=a.d,y="d"):t>=u&&e>=d?(o=a.e,y="e"):t>l&&t<u&&e>=d?(o=a.f,y="f"):t<=l&&e>=d?(o=a.g,y="g"):t<=l&&e>f&&e<d&&(o=a.h,y="h"),this.clearTmpElem("mc"),o&&(this.tRElem.mc=this.paper.circle(o.x,o.y,3).attr("fill",this.opt.bkgMagnetic).data("pcode",this.code).data("posi",y)),this.tRElem.mc&&(n=this.tRElem.mc),n},t.prototype.select=function(){var t=this.getBBox(),e=t.attr,o=t.ps,n=e.x,i=e.y,r=e.width,a=e.height,c=this.paper;for(var s in this.removeBox(),this.isSelEd=!0,this.tRElem.box=c.rect(n,i,r,a).attr({stroke:"#0033FF","stroke-width":"0.8"}),o){var h=o[s],p=h.x,l=h.y;this.tRElem["__p"+s]=c.circle(p,l,2).attr("fill","#000000").data("pcode",this.code).data("posi",s),this.onCreateBoxPnt(this.tRElem["__p"+s])}return this},t.prototype.removeBox=function(){for(var t in this.tRElem||(this.tRElem={}),this.tRElem.box&&(this.tRElem.box.remove(),delete this.tRElem.box),this.tRElem)t.indexOf("__p")>-1&&(this.tRElem[t].remove(),delete this.tRElem[t]);return this.isSelEd=!1,this},t.prototype.zoomOut=function(t){t=t||.05;this.c;var e=this.opt;return e.w=e.w*(1+t),e.h=e.h*(1+t),this.updAttr({w:e.w,h:e.h}),this.select(),this},t.prototype.zoomIn=function(t){t=t||.05;this.c;var e=this.opt;return e.w=e.w*(1-t),e.h=e.h*(1-t),this.updAttr({w:e.w,h:e.h}),this.select(),this},t.prototype.move=function(t,e){e=e||.05;var o,n=this.opt;switch(t=t?t.toUpperCase():t){case"T":o={cy:n.cy*(1-e)};break;case"B":o={cy:n.cy*(1+e)};break;case"L":o={cx:n.cx*(1-e)};break;case"R":o={cx:n.cx*(1+e)}}return o&&(this.updAttr(o),this.select()),this},t.prototype.move2T=function(t){return this.move("T",t),this},t.prototype.move2B=function(t){return this.move("B",t),this},t.prototype.move2L=function(t){return this.move("L",t),this},t.prototype.move2R=function(t){return this.move("R",t),this},t.prototype.background=function(t){var e=this;if("object"!=typeof t){switch(t&&(t=t.toLowerCase()),t){case"magn":this.c.attr("fill",this.opt.bkgMagnetic);break;case"text":this.opt.bkgTxt||(this.opt.bkgTxt="#000000"),this.label&&this.label.attr("fill",this.opt.bkgTxt);break;case"node":default:this.c.attr("fill",this.opt.bkg)}return this}s.each(t,function(t,o){e.background(o)})},t.prototype.clearTmpElem=function(t){var e=this;if(t){var o=[];o="object"==typeof t?t:[t],s.each(this.tRElem,function(t,n){s.inArray(t,o)>-1&&(n.remove(),delete e.tRElem[t])})}else s.each(this.tRElem,function(t,o){o.remove(),delete e.tRElem[t]});return this},t.prototype.onCreateBoxPnt=function(t){},t.prototype.onSize=function(){},t}(),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype._onInit=function(){this.NodeType="begin"},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#851E07";var t=this.opt;if(this.c=this.paper.ellipse(t.cx,t.cy,t.w/2,t.h/2),this.c.attr("fill",t.bkg),t.text){var e=this._getTextPnt(),o=e.x,n=e.y;this.label=this.paper.text(o,n,t.text)}},e.prototype.updAttr=function(t){var e=this._updAttr(t).opt;return this.c.attr({cx:e.cx,cy:e.cy,rx:e.w/2,ry:e.h/2}),this.updTextAttr(t.text),this.onSize(),this},e}(l),d=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return d(e,t),e.prototype._onInit=function(){this.NodeType="task"},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#88EEEA";var t=this.opt2Attr(),e=this.opt,o=e.bkg;if(this.c=this.paper.rect(t.x,t.y,t.w,t.h),this.c.attr("fill",o),e.text){var n=this._getTextPnt(),i=n.x,r=n.y;this.label=this.paper.text(i,r,e.text)}},e.prototype.opt2Attr=function(t){var e=t||this.opt;return{x:e.cx-e.w/2,y:e.cy-e.h/2,w:e.w,h:e.h}},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt2Attr(),o={x:e.x,y:e.y,width:e.w,height:e.h};return this.c.attr(o),this.updTextAttr(t.text),this.onSize(),this},e.prototype.getIconP=function(){var t=this.opt,e=t.cx,o=t.cy;return{x:e-t.w/2+2,y:o-t.h/2+2}},e}(l),v=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype._onInit=function(){this.NodeType="audit",this.xRate=.2},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#88EEEA";var t=this.opt2Attr(),e=this.opt;if(this.c=this.paper.path(this._ps2Path(t,!0)),this.c.attr("fill",e.bkg),e.text){var o=this._getTextPnt(),n=o.x,i=o.y;this.label=this.paper.text(n,i,e.text)}},e.prototype.opt2Attr=function(t){var e=t||this.opt,o=e.cx,n=e.cy,i=e.w,r=e.h,a=this.xRate;return[{x:o-i/2,y:n-r/2},{x:o+i/2+i*a,y:n-r/2},{x:o+i/2,y:n+r/2},{x:o-i/2-i*a,y:n+r/2}]},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt2Attr();return this.c.attr("path",this._ps2PathAttr(e,!0)),this.updTextAttr(t.text),this.onSize(),this},e}(l),g=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return g(e,t),e.prototype._onInit=function(){this.NodeType="sign",this.xRate=.2},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#88EEEA";var t=this.opt2Attr(),e=this.opt,o=e.bkg;if(this.c=this.paper.path(this._ps2Path(t,!0)),this.c.attr("fill",o),e.text){var n=this._getTextPnt(),i=n.x,r=n.y;this.label=this.paper.text(i,r,e.text)}},e.prototype.opt2Attr=function(t){var e=t||this.opt,o=e.cx,n=e.cy,i=e.w,r=e.h,a=this.xRate;return[{x:o-i/2-i*a,y:n-r/2},{x:o+i/2+i*a,y:n-r/2},{x:o+i/2,y:n+r/2},{x:o-i/2,y:n+r/2}]},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt2Attr();return this.c.attr("path",this._ps2PathAttr(e,!0)),this.updTextAttr(t.text),this.onSize(),this},e}(l),b=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return b(e,t),e.prototype._onInit=function(){this.NodeType="cond"},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#88EEEA";var t=this.opt2Attr(),e=this.opt;if(this.c=this.paper.path(this._ps2Path(t,!0)),this.c.attr("fill",e.bkg),e.text){var o=this._getTextPnt(),n=o.x,i=o.y;this.label=this.paper.text(n,i,e.text)}},e.prototype.opt2Attr=function(t){var e=t||this.opt,o=e.cx,n=e.cy,i=e.w,r=e.h;return[{x:o,y:n-r/2},{x:o+i/2,y:n},{x:o,y:n+r/2},{x:o-i/2,y:n}]},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt2Attr();return this.c.attr("path",this._ps2PathAttr(e,!0)),this.updTextAttr(t.text),this.onSize(),this},e}(l),m=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype._onInit=function(){this.NodeType="sub_flow",this.xRate=.15},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#88EEEA";var t=this.opt2Attr(),e=t.cAttr,o=t.lLine,n=t.rLine,i=this.opt,r=i.bkg;if(this.c=this.paper.rect(e.x,e.y,e.w,e.h),this.c.attr("fill",r),this.inlinesEle=[this.paper.path(this._ps2Path(o)),this.paper.path(this._ps2Path(n))],i.text){var a=this._getTextPnt(),c=a.x,s=a.y;this.label=this.paper.text(c,s,i.text)}},e.prototype.opt2Attr=function(t){var e=t||this.opt,o=e.cx-e.w/2,n=e.cy-e.h/2,i=e.w,r=e.h,a=this.xRate;return{cAttr:{x:o,y:n,w:i,h:r},lLine:[{x:o+i*a,y:n},{x:o+i*a,y:n+r}],rLine:[{x:o+i-i*a,y:n},{x:o+i-i*a,y:n+r}]}},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt2Attr(),o=e.cAttr,n=e.lLine,i=e.rLine;return this.c.attr({x:o.x,y:o.y,width:o.w,height:o.h}),this.inlinesEle[0].attr("path",this._ps2PathAttr(n)),this.inlinesEle[1].attr("path",this._ps2PathAttr(i)),this.updTextAttr(t.text),this.onSize(),this},e}(l),w=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return w(e,t),e.prototype._onInit=function(){this.NodeType="parallel",this.xRate=.2},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#88EEEA";var t=this.opt2Attr(),e=this.opt.bkg;this.c=this.paper.path(this._ps2Path(t.cAttr,!0)),this.c.attr("fill",e),this.inlineEle=this.paper.path(this._ps2Path(t.inLine))},e.prototype.opt2Attr=function(t){var e=t||this.opt,o=e.cx-e.w/2,n=e.cy-e.h/2,i=e.w,r=e.h,a=i*(1-2*this.xRate);return{cAttr:[{x:o-a/2,y:n-r/2},{x:o+a/2,y:n-r/2},{x:o+i/2,y:n},{x:o+a/2,y:n+r/2},{x:o-a/2,y:n+r/2},{x:o-i/2,y:n}],inLine:[{x:o-a/2-.1*a,y:n},{x:o+a/2+.1*a,y:n}]}},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt2Attr(),o=e.cAttr,n=e.inLine;return this.c.attr("path",this._ps2PathAttr(o,!0)),this.inlineEle.attr("path",this._ps2PathAttr(n)),this.onSize(),this},e}(l),A=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return A(e,t),e.prototype._onInit=function(){this.NodeType="merge",this.xRate=.2},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#88EEEA";var t=this.opt2Attr(),e=this.opt.bkg;this.c=this.paper.path(this._ps2Path(t.cAttr,!0)),this.c.attr("fill",e),this.inlinesEle=[this.paper.path(this._ps2Path(t.vLine)),this.paper.path(this._ps2Path(t.hLine))]},e.prototype.opt2Attr=function(t){var e=t||this.opt,o=e.cx-e.w/2,n=e.cy-e.h/2,i=e.w,r=e.h,a=i*(1-2*this.xRate);return{cAttr:[{x:o-a/2,y:n-r/2},{x:o+a/2,y:n-r/2},{x:o+i/2,y:n},{x:o+a/2,y:n+r/2},{x:o-a/2,y:n+r/2},{x:o-i/2,y:n}],vLine:[{x:o,y:n-r/2*.8},{x:o,y:n+r/2*.8}],hLine:[{x:o-a/2-.1*a,y:n},{x:o+a/2+.1*a,y:n}]}},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt2Attr(),o=e.cAttr,n=e.vLine,i=e.hLine;return this.c.attr("path",this._ps2PathAttr(o,!0)),this.inlinesEle[0].attr("path",this._ps2PathAttr(n)),this.inlinesEle[1].attr("path",this._ps2PathAttr(i)),this.onSize(),this},e}(l),D=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return D(e,t),e.prototype._onInit=function(){this.NodeType="end"},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"#2EF25F";var t=this.opt;if(this.c=this.paper.ellipse(t.cx,t.cy,t.w/2,t.h/2),this.c.attr("fill",this.opt.bkg),t.text){var e=this._getTextPnt(),o=e.x,n=e.y;this.label=this.paper.text(o,n,t.text)}},e.prototype.updAttr=function(t){var e=this._updAttr(t).opt;return this.c.attr({cx:e.cx,cy:e.cy,rx:e.w/2,ry:e.h/2}),this.updTextAttr(t.text),this.onSize(),this},e}(l),C=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return C(e,t),e.prototype._onInit=function(){this.NodeType="ln",this.data("maxR",5)},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"rgb(3, 84, 41)";this.opt.bkg;this.c=this.paper.path(this._ps2Path(this.opt2Attr())).attr("stroke-width","2px").attr("fill",this.opt.bkg).attr("stroke",this.opt.bkg)},e.prototype.opt2Attr=function(t){var e=t||this.opt,o=e.P1,n=e.P2,i=e.r||.2*this.getLen(),r=this.data("maxR");i>r&&(i=r);var a=Math.atan2(o.y-n.y,n.x-o.x)*(180/Math.PI),c=n.x-i*Math.cos(a*(Math.PI/180)),s=n.y+i*Math.sin(a*(Math.PI/180));return[o,n,{x:c+i*Math.cos((a+120)*(Math.PI/180)),y:s-i*Math.sin((a+120)*(Math.PI/180))},{x:c+i*Math.cos((a+240)*(Math.PI/180)),y:s-i*Math.sin((a+240)*(Math.PI/180))},n]},e.prototype.updAttr=function(t){return this._updAttr(t),this.c.attr("path",this._ps2PathAttr(this.opt2Attr())),this},e.prototype.getLen=function(t){var e=t||this.opt,o=e.P1,n=e.P2;return this.getPLen(o,n)},e.prototype.select=function(){var t=this,e=this.getFocusPoint();return this.removeBox(),this.isSelEd=!0,s.each(e,function(e,o){var n=t.paper.circle(o.x,o.y,3).attr("fill",t.feature("focusPBkg",null,"#990000")).data("pcode",t.code).data("posi",e);t.tRElem["__p"+e]=n,t.onCreateBoxPnt(t.tRElem["__p"+e])}),this},e.prototype.getFocusPoint=function(){var t=this.opt,e=t.P1,o=t.P2,n=this.getPLen(e,o),i=this.c.getPointAtLength(n/2);return{f:e,m:{x:i.x,y:i.y},t:o}},e}(l),S=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return S(e,t),e.prototype._onInit=function(){this.NodeType="ln_poly"},e.prototype._whenCreatorEvt=function(){this.opt.bkg=this.opt.bkg||"rgb(3, 84, 41)";this.opt.bkg;var t=this.opt2Attr(),e=t.pQue,o=t.arrowPs;this.c=this.paper.path(this._ps2Path(e)).attr("stroke-width","2px").attr("stroke",this.opt.bkg),this.inlineEle=this.paper.path(this._ps2Path(s.jsonValues(o))),this.inlineEle.attr("fill",this.opt.bkg).attr("stroke",this.opt.bkg).attr("stroke-width","2px")},e.prototype.opt2Attr=function(t){var e=[],o=t||this.opt,n=o.P1,i=o.P2,r=this.getLen(),a=o.rX||.35,c=o.r||r*(1-a)*.2,h=o.MPs||[];if(e=[n],h.length>0){if(h[0].x!=n.x&&h[0].y!=n.y){var l=this.getMiddP(n,h[0]);h=s.MergeArr([l],h)}var u=h.length-1;if(h[u].x!=i.x&&h[u].y!=i.y){var f=this.getMiddP(h[u],i);h=s.MergeArr(h,[f])}e=e.concat(h),this.opt.MPs=h}else{n.x,n.y,i.x,i.y;var d=this.getMiddP(n,i);d&&(h.push(d),e.push(d),this.opt.MPs=h)}e.push(i);var y={};if(e.length>1){var v=e.length-1;y=p.ps2arrow(e[v-1],e[v],c)}return{pQue:e,arrowPs:y}},e.prototype.getMiddP=function(t,e){var o;return t.x!=e.x&&t.y!=e.y&&(o={x:t.x,y:e.y}),o},e.prototype.getLen=function(t){var e=t||this.opt,o=e.P1,n=e.P2;return this.getPLen(o,n)},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt2Attr(),o=e.pQue,n=e.arrowPs;return this.c.attr("path",this._ps2PathAttr(o)),this.inlineEle.attr("path",this._ps2PathAttr(s.jsonValues(n))),this},e.prototype.select=function(){var t=this,e=this.getFocusPoint();return this.removeBox(),this.isSelEd=!0,s.each(e,function(e,o){var n=t.paper.circle(o.x,o.y,3).attr("fill",t.feature("focusPBkg",null,"#990000")).data("pcode",t.code).data("posi",e);t.tRElem["__p"+e]=n,t.onCreateBoxPnt(t.tRElem["__p"+e])}),this},e.prototype.getFocusPoint=function(){this._mpsMerge();var t=this.opt,e=t.P1,o=t.P2,n=this.opt.MPs||[],i={f:e},r=0;s.each(n,function(t,e){i["m"+t]=e,r=t}),i.t=o;for(var a=s.jsonValues(i),c=a.length,h={},l=-1,u=0;u<c-1;u++){r+=1;var f=a[u],d=a[u+1];h["f"+(l+=1)]=f,h["f"+(l+=1)]=p.middP(f,d)}return h["f"+(l+=1)]=a[c-1],h},e.prototype._mpsMerge=function(){var t=this.opt,e=t.MPs,o=[],n=e.length;s.each(e,function(i,r){var a=0==i?t.P1:e[i-1],c=i==n-1?t.P2:e[i+1];Math.abs(a.x-r.x)<=1&&Math.abs(c.x-r.x)<=1||Math.abs(a.y-r.y)<=1&&Math.abs(c.y-r.y)<=1||o.push(r)}),this.updAttr({MPs:o})},e.prototype.mvEndPoint=function(t,e){var o,n=this.c.attr("path"),i=this.opt;if(e){var r={x:(a=n[n.length-2])[1],y:a[2]};(o=this.getMiddP(r,i.P2))?(i.MPs=i.MPs?i.MPs:[],i.MPs.length>0&&(i.MPs[i.MPs.length-1]=o)):i.MPs=[],i.P2=t}else{var a;r={x:(a=n[1])[1],y:a[2]};(o=this.getMiddP(i.P1,r))?(i.MPs=i.MPs?i.MPs:[],i.MPs.length>0&&(i.MPs[0]=o)):i.MPs=[],i.P1=t}this.updAttr(i)},e}(l),j=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype._onInit=function(){this.NodeType="text"},e.prototype._whenCreatorEvt=function(){var t=this.opt,e=t.cx,o=t.cy,n=t.text;this.c=this.paper.text(e,o,n)},e.prototype.updAttr=function(t){this._updAttr(t);var e=this.opt;return this.c.attr({x:e.cx,y:e.cy,text:e.text}),this},e}(l),R=function(){function t(t){this.paper=t}return t.prototype.make=function(t,e){var o,n=s.ucFirst(t),i=this.paper;switch(n){case"Begin":o=new f(i,e);break;case"Task":o=new y(i,e);break;case"Audit":o=new x(i,e);break;case"Sign":o=new _(i,e);break;case"Cond":o=new k(i,e);break;case"SubFlow":o=new P(i,e);break;case"Parallel":o=new E(i,e);break;case"Merge":o=new M(i,e);break;case"End":o=new T(i,e);break;case"Ln":o=new B(i,e);break;case"LnPoly":o=new N(i,e);break;case"Text":o=new O(i,e)}return o},t}(),L=function(){function t(t){"object"!=typeof t||t instanceof Array?this.jsonObj={}:this.jsonObj=t}return t.prototype.get=function(t,e){return void 0!==this.jsonObj[t]?this.jsonObj[t]:e},t.prototype.set=function(t,e){return this.jsonObj[t]=e,this},t.value=function(t,e,o){return"object"==typeof t?void 0===t[e]?o:t[e]:o},t}(),F=function(){function t(t,e){this._tools=[],this.rData={cp:{x:5,y:5},th0:23,th1:23,th2:23,nh:0,ch:0,cw:75},this.paper=t,this.ndMer=new R(this.paper),this.option=e,this.config=e.toolBar||{};var o=!1;o=!(this.config.hasIcon||!this.config.aUpSrc&&!this.config.aDownSrc)||(this.config.hasIcon||!1),this.config.aUpSrc=L.value(this.config,"aUpSrc",o?"arrow_up.png":null),this.config.aDownSrc=L.value(this.config,"aDownSrc",o?"arrow_down.png":null),this._headBar(),this._nodeBar(),this._connBar()}return t.prototype._headBar=function(){var t,e=this,o=this.rData,n=o.cp,i=o.cw,r=o.th0,a=n.x,c=n.y,s=this.paper;this.headElems={},t=s.rect(a,c,i,r).attr("fill","#3A0088").click(function(){"H"!=this.data("toggle")?(this.data("toggle","H"),e.toggle("H")):(this.data("toggle","S"),e.toggle("S"))}),this.headElems.icon=t,t=s.text(a+i/2,c+10,L.value(this.config,"title","工具栏")).attr("fill","#ffffff"),this.headElems.title=t},t.prototype._nodeBar=function(){var t,e=this,o=this.rData,n=o.cp,i=o.cw,r=o.th1,a=o.nh,c=n.x,p=n.y,l=this.paper,u=this.ndMer,f=this.config,d={};this.nodeElems={};var y=f.menu||!1;y||(y=["begin","task","sign","cond","subFlow","parallel","merge","end","text"]),p+=r,this.nodeElems.title=l.rect(c,p,i,23).attr("fill","#E8CCFF").click(function(){var t=this.data("toggle"),o=e.nodeElems.icon;"H"!=t?(this.data("toggle","H"),o&&o.attr("src",f.aDownSrc),e.tToggle("H")):(this.data("toggle","S"),o&&o.attr("src",f.aUpSrc),e.tToggle("S"))}),this.nodeElems.icon=l.image(f.aUpSrc,c+.7*i,p+1,20,20),a=p,p+=23,this.nodeElems.tBody=l.rect(c,p,i,250).attr("fill","#ffffff"),c+=32,s.each(y,function(e,o){if("object"!=typeof o&&(e=o,o={}),h[e]){p+=32;var n=o.text||h[e].text,i=c,r=p;"parallel"==e?(r+=5,i+=20):"merge"==e&&(r+=5,i+=20),(t=u.make(e,{cx:i,cy:r,w:40,h:20,text:n}).creator()).label&&t.label.attr("fill","#FF8C00"),"text"==e&&t.c.attr({"font-size":15,stroke:"none"}),d[e]=t}}),this.tBodyNds=d,this.rData.nh=p-a,this.nodeElems.tBody.attr("height",this.rData.nh)},t.prototype._connBar=function(){var t,e=this,o=this.rData,n=o.cp,i=o.cw,r=o.th2,a=o.ch,c=o.th0,s=o.th1,h=o.nh,p=n.x,l=n.y,u=this.paper,f=this.ndMer,d=this.config,y={};this.connElems={},l+=c+s+h,this.connElems.title=u.rect(p,l,i,r).attr("fill","#D1BBFF").click(function(){var t=this.data("toggle"),o=e.connElems.icon;"H"!=t?(this.data("toggle","H"),o&&o.attr("src",d.aDownSrc),e.cToggle("H")):(this.data("toggle","S"),o&&o.attr("src",d.aUpSrc),e.cToggle("S"))}),this.connElems.icon=u.image(d.aUpSrc,p+.7*i,l+1,20,20),a=l,l+=r;this.config.lnSeledBkg=this.config.lnSeledBkg||"#CCFF99",this.config.lnDefBkg=this.config.lnDefBkg||"#ffffff";var v=this.config.lnDefBkg;this.connElems.lnCon=u.rect(p,l,i,30).attr("fill",v);var x=l+10.5,g=p+20;t=f.make("ln",this._lnConXyCrt(p,l,g,x)).creator(),y.ln=t,l+=20,this.connElems.lnPolyCon=u.rect(p,l,i,30).attr("fill",v),x=l+10.5,g=p+20,t=f.make("lnPoly",this._lnPolyConXyCrt(p,l,g,x)).creator(),y.lnPoly=t,this.cBodyNds=y,a=l-a,this.connElems.lnCon.attr("height",a/2),this.connElems.lnPolyCon.attr("height",a/2)},t.prototype._lnPolyConXyCrt=function(t,e,o,n){return{P1:{x:o-5,y:n-5},P2:{x:o+25,y:n+2},h:4}},t.prototype._lnConXyCrt=function(t,e,o,n){return{P1:{x:o-5,y:n},P2:{x:o+25,y:n}}},t.prototype.connSizeNode=function(t){var e=this.connElems,o=e.title,n=e.icon,i=e.lnCon,r=e.lnPolyCon,a=this.rData,c=a.cp,s=(a.cw,a.th2),h=(a.ch,a.th0),p=a.th1,l=a.nh,u=c.x,f=c.y,d=this.cBodyNds,y=d.ln,v=d.lnPoly;f+=t?h+p+l:h+p,o.attr("y",f),n.attr("y",f+1),f+=s;i.attr("y",f);var x=f+10.5,g=u+20;y.updAttr(this._lnConXyCrt(u,f,g,x)),f+=20,r.attr("y",f),x=f+10.5,g=u+20,v.opt.MPs=[],v.updAttr(this._lnPolyConXyCrt(u,f,g,x))},t.prototype.tToggle=function(t,e){var o=this.tBodyNds,n=this.nodeElems,i=n.tBody;"H"!=t?(s.each(o,function(t,e){e.show()}),e&&(n.title.show(),n.icon.show()),i&&i.show(),this.connSizeNode(!0)):(s.each(o,function(t,e){e.hide()}),e&&(n.title.hide(),n.icon.hide()),i&&i.hide(),this.connSizeNode())},t.prototype.cToggle=function(t,e){var o=this.cBodyNds,n=this.connElems,i=n.lnCon,r=n.lnPolyCon;"H"!=t?(s.each(o,function(t,e){e.show()}),e&&(n.title.show(),n.icon.show()),i&&i.show(),r&&r.show()):(s.each(o,function(t,e){e.hide()}),e&&(n.title.hide(),n.icon.hide()),i&&i.hide(),r&&r.hide())},t.prototype.toggle=function(t){this.tToggle(t,!0),this.cToggle(t,!0)},t.prototype.show=function(){this.toggle("S"),this.cToggle("S"),s.each(this.headElems,function(t,e){e.show()})},t.prototype.hide=function(){this.toggle("H"),this.cToggle("H"),s.each(this.headElems,function(t,e){e.hide()})},t}(),I=function(){function t(){}return t.agentNodeCnP=function(t,e,o){var n,i,r=(o="object"==typeof o?o:{}).dn||20,a=(o.box||t.getBBox()).ps;switch(e){case"b":n={x:(i=a.b).x,y:i.y-r};break;case"d":n={x:(i=a.d).x+r,y:i.y};break;case"f":n={x:(i=a.f).x,y:i.y+r};break;case"h":n={x:(i=a.h).x-r,y:i.y}}return n},t}();function z(t,e,o){var n=t.data(),i=n.from_code,r=n.to_code,a=n.from_posi,c=n.to_posi;o||(o=e.nodeDick[r]);var s=e.nodeDick[i];if(o&&o.code==s.code){var h={box:s.getBBox()},l=I.agentNodeCnP(s,a,h),u=I.agentNodeCnP(s,c,h),f=void 0;"f"==a&&("d"==c||"h"==c)||"b"==a&&("h"==c||"d"==c)?f=p.polyP(l,u,"ua"):"h"!=a&&"d"!=a||"f"!=c||(f=p.polyP(l,u,"la")),f&&t.updAttr({MPs:[l,f,u]})}else if(o){var d=e.nodeDick[i],y=t.opt.P1,v=t.opt.P2,x=d.opt,g=o.opt,_=[],b=void 0;if("d"==a||"h"==a)if(Math.abs(x.cx-g.cx)<=10){var k=30*("d"==a?1:-1);a==c&&(b=y.x+k,_.push({x:b,y:y.y},{x:b,y:v.y}),t.updAttr({P2:v,MPs:_}))}else if("b"==c){(m=p.polyP(y,v,"ua"))&&(_.push(m),t.updAttr({P2:v,MPs:_}))}else if("d"==a||"h"==a){k=30*("d"==c?1:-1);var m,P={x:v.x+k,y:v.y};(m=p.polyP(y,P,"ua"))&&(_.push(m,P),t.updAttr({P2:v,MPs:_}))}}}var H=function(){function t(t){this.worker=t,this._addPlg()}return t.prototype._addPlg=function(){var t=this.worker.config;(t.bindOEvts||t.onKeydown&&"function"==typeof t.onKeydown)&&(t.bindOEvts=!0,this.operHelpEvts())},t.prototype.operHelpEvts=function(){var t=this.worker,e=t.config,o=e.dom;o.attr("tabindex","0").css({outline:"none"}),o.off("keydown").on("keydown",function(o){var n=o.keyCode;if(e.onKeydown&&"function"==typeof e.onKeydown&&!1===e.onKeydown(n,t,o))return;if(o.shiftKey){if(68==n)t.remove();else if(84==n)t.tab();else if(67==n)t.tab("c");else if(76==n)t.tab("t");else if(65==n)t.allSelect();else if(82==n)t.allRemove();else if(86==n)t.clone();else if(69==n)t.error();else if(s.inArray(n,[38,40,37,39,107,109])>-1){var i=t.select();if(i)switch(n){case 38:i.move2T();break;case 40:i.move2B();break;case 37:i.move2L();break;case 39:i.move2R();break;case 107:i.zoomOut();break;case 109:i.zoomIn()}}}else 46==n&&t.remove()})},t}(),U=function(){function t(t){if(this.idxDick={c:0,n:0,t:0},this.nodeDick={},this.connDick={},this.textDick={},this.tmpNodeMap={},this.tmpMapRElm={},this.config=t,this.paper=a.createInstance(t),this.ndMer=new R(this.paper),this._magnCoreHistory={},this._configMergeToDefule(),this._readonly(),this._cerateToolBar(),t.data)try{this.load(t.data)}catch(t){console.log(t)}this._domListener(),new H(this)}return t.prototype._configMergeToDefule=function(){var t=this.config.pkgClr||{};t.start=t.start||"rgb(181, 216, 126)",t.opera=t.opera||"rgb(224, 223, 226)",t.judge=t.judge||"rgb(49, 174, 196)",t.end=t.end||"rgb(34, 185, 41)",t.arrow=t.arrow||"rgb(3, 84, 41)",t.NodeBox=t.NodeBox||"rgb(15, 13, 105)",this.config.pkgClr=t,this.config.prefCode=this.config.prefCode||"A",this.config.listener=this.config.listener||{},this.config.noToolBar=this.config.noToolBar||!1},t.prototype._lineMoveSync=function(t,e,o){var n=this,i=o.conLns,r=i.from,a=i.to,c=this;s.each(r,function(t,e){var i=c.connDick[e];if("ln"==i.NodeType){i.data("from_code");var r=i.data("from_posi"),a=o.getBBox().ps;i.updAttr({P1:a[r]})}else{i.data("from_code"),r=i.data("from_posi"),a=o.getBBox().ps;i.mvEndPoint(a[r]),z(i,n)}}),s.each(a,function(i,r){var a=c.connDick[r];if("ln"==a.NodeType){a.updAttr({P2:{x:t,y:e}});a.data("to_code");var s=a.data("to_posi"),h=o.getBBox().ps;a.updAttr({P2:h[s]})}else{a.updAttr({P2:{x:t,y:e}});a.data("to_code"),s=a.data("to_posi"),h=o.getBBox().ps;a.mvEndPoint(h[s],!0),z(a,n,o)}})},t.prototype._cerateToolBar=function(){var t=this;if(this.config.noToolBar)return null;this.toolbarCtrl=new F(this.paper,this.config);var e=this,o=e.toolbarCtrl,n=o.tBodyNds,i=o.cBodyNds,r=o.connElems,a=this.config.bkg||{};s.each(n,function(t,o){var n,i={x:0,y:0};o.c.drag(function(t,e){t+=i.x,e+=i.y,n&&n.updAttr({cx:t,cy:e})},function(){var r=o.opt,c=r.cx,s=r.cy;i.x=c,i.y=s;var p={cx:c+=25,cy:s,w:50,h:40};h[t]&&(p.text=h[t].text),p.bkg=a.urunNd||"#CDC5BF",n=e.ndMer.make(t,p).creator()},function(){if(n.moveable({beforeMv:function(t){if(e.previewMk)return!1},afterUpd:function(t,o,n){e._lineMoveSync(t,o,n),e.onNodeResize()}}),e._nodeBindEvt(n),"text"==n.NodeType){var t=e._order("t","T");n.data("_code",t),e.textDick[t]=n}else{var o=e._order("n","A");n.data("_code",o),e.nodeDick[o]=n}})});var c=r.lnCon,p=r.lnPolyCon,l=e.toolbarCtrl.config,u=l.lnSeledBkg,f=l.lnDefBkg;c.data("con","ln"),p.data("con","lnPoly"),this.lineCnMode={isSelEd:!1,type:null};var d=function(){s.each(i,function(t,e){e.isSelEd=!1}),t.lineCnMode={isSelEd:!1,type:null},c.attr("fill",f),p.attr("fill",f)},y=function(){var t=e.select();t&&t.select()};s.each(i,function(t,o){o.c.click(function(){var t=o.isSelEd;d(),t||(o.isSelEd=!0,e.lineCnMode={isSelEd:!0,type:o.NodeType},"ln"==o.NodeType?c.attr("fill",u):p.attr("fill",u),y())})});var v=function(){!e.lineCnMode.isSelEd||e.lineCnMode.isSelEd&&this.data("con")!=e.lineCnMode.type?(d(),this.attr("fill",u),e.lineCnMode={isSelEd:!0,type:this.data("con")},y()):d()};c.click(v),p.click(v)},t.prototype._nodeBindEvt=function(t){this._baseNodeBindEvt(t);var e=this,o=this.ndMer,n=this.config,i=n.bkg||{},r=function(t){t.c.click(function(){e.removeAllSeled(),t.select(),e.onClick(t)}),t.c.dblclick(function(){e.onDbClick(t)}),t.onCreateBoxPnt=function(t){if(e.previewMk||e.config.disDragble)return null;var r;if(e.lineCnMode&&e.lineCnMode.isSelEd){if(n.disConnNode)return null;var a={x:0,y:0};t.drag(function(t,o){if(r){t+=a.x,o+=a.y;var n=e.collisionByP(t,o);if(e.allBackground(),n){var i=n.magnCore(t,o);i&&(e._magnCoreHistory[i.id]=i,t=i.attr("cx"),o=i.attr("cy"),r.data("to_code",i.data("pcode")).data("to_posi",i.data("posi"))),n.background("magn")}else r.data("to_code",null).data("to_posi",null),e._clearMagnCoreHistory();"ln"==e.lineCnMode.type?r.updAttr({P2:{x:t,y:o}}):(r.opt.MPs=[],r.updAttr({P2:{x:t,y:o}}),z(r,e,n))}else console.log("选择框连线拖动出错！")},function(){e.removeTmpNode("connLnIst"),e.removeAllSeled("conn"),a.x=this.attr("cx"),a.y=this.attr("cy");var n={},c=a.x,s=a.y;(n="ln"==e.lineCnMode.type?{P1:{x:c,y:s},P2:{x:c+10,y:s+5}}:{P1:{x:c,y:s},P2:{x:c+4,y:s+4},r:5}).bkg=i.urunNd||"#CDC5BF",r=o.make(e.lineCnMode.type,n).creator().data("from_code",t.data("pcode")).data("from_posi",t.data("posi")),e.tmpNodeMap.connLnIst=r},function(){if(r.data("to_code")&&r.data("to_posi")){var t=e._order("c","C"),o=r.data("from_code"),n=r.data("to_code");r.data("_code",t);var i=e.nodeDick[o],a=e.nodeDick[n];i.line(t),i.clearTmpElem("mc"),a.line(t,!0),a.clearTmpElem("mc"),e.allBackground(),e._lineBindEvt(r),e.connDick[t]=r,e.tmpNodeMap.connLnIst=null}e.removeTmpNode("connLnIst")})}else if(!n.disEpDragble){var c={x:0,y:0},s={pcode:null,posi:null};t.drag(function(t,o){t+=c.x,o+=c.y;var n=s.pcode?e.nodeDick[s.pcode]:null;if(n&&s.pcode&&s.posi){var i=n.opt,r=i.cx,a=i.cy,h=i.h,p=i.w,l=n.feature("boxPadding"),u=void 0,f=void 0,d=void 0,y=void 0,v=void 0,x=void 0,g=void 0,_=void 0,b=void 0,k=void 0,m=void 0,P=void 0;switch(s.posi){case"a":g=t+l,y=r+p/2,(v=o+l)<=(f=a+h/2)&&g<=y&&(m=Math.abs(v-f),b=g+(P=Math.abs(g-y))/2,k=v+m/2,n.updAttr({h:m,w:P,cx:b,cy:k}));break;case"b":(v=o+l)<=(f=a+h/2)&&(k=v+(m=Math.abs(f-v))/2,n.updAttr({h:m,cy:k}));break;case"c":_=t-l,d=r-p/2,(v=o+l)<=(f=a+h/2)&&_>=d&&(m=Math.abs(v-f),b=_-(P=Math.abs(_-d))/2,k=v+m/2,n.updAttr({h:m,w:P,cx:b,cy:k}));break;case"d":(_=t-l)>=(d=r-p/2)&&(b=_-(P=Math.abs(d-_))/2,n.updAttr({w:P,cx:b}));break;case"e":_=t-l,d=r-p/2,(x=o-l)>=(u=a-h/2)&&_>=d&&(m=Math.abs(x-u),b=_-(P=Math.abs(_-d))/2,k=x-m/2,n.updAttr({h:m,w:P,cx:b,cy:k}));break;case"f":(x=o-l)>=(u=a-h/2)&&(k=x-(m=Math.abs(u-x))/2,n.updAttr({h:m,cy:k}));break;case"g":g=t+l,y=r+p/2,(x=o-l)>=(u=a-h/2)&&g<=y&&(m=Math.abs(x-u),b=g+(P=Math.abs(g-y))/2,k=x-m/2,n.updAttr({h:m,w:P,cx:b,cy:k}));break;case"h":(g=t+l)<=(y=r+p/2)&&(b=g+(P=Math.abs(y-g))/2,n.updAttr({w:P,cx:b}))}}},function(){c.x=this.attr("cx"),c.y=this.attr("cy"),s.pcode=this.data("pcode"),s.posi=this.data("posi")},function(){})}},t.onSize=function(){var t=this.opt;e._lineMoveSync(t.cx,t.cy,this)}};if(t)r(t);else for(var a in this.nodeDick)r(this.nodeDick[a])},t.prototype._lineBindEvt=function(t){this._baseNodeBindEvt(t);var e=this;if(t){var o=this.config.bkg||{},n=function(o){var n={x:0,y:0};o.drag(function(o,i){o+=n.x,i+=n.y;var r=e.collisionByP(o,i),a=t.data("from_code"),c=t.code;if(a&&e.nodeDick[a].rmLine(c),e.allBackground(),r){var s=r.magnCore(o,i);s&&(o=s.attr("cx"),i=s.attr("cy"),t.data("from_code",s.data("pcode")).data("from_posi",s.data("posi"))),r.background("magn"),r.line(c)}else t.data("from_code",null).data("from_posi",null);t.updAttr({P1:{x:o,y:i}})},function(){n.x=this.attr("cx"),n.y=this.attr("cy")},function(){})},i=function(o){var n={x:0,y:0};o.drag(function(o,i){o+=n.x,i+=n.y;var r=e.collisionByP(o,i),a=t.data("to_code"),c=t.code;if(a&&e.nodeDick[a].rmLine(c,!0),e.allBackground(),r){var s=r.magnCore(o,i);s&&(o=s.attr("cx"),i=s.attr("cy"),t.data("to_code",s.data("pcode")).data("to_posi",s.data("posi"))),r.background("magn"),r.line(c,!0)}else t.data("to_code",null).data("to_posi",null);t.updAttr({P2:{x:o,y:i}}),"ln_poly"==t.NodeType&&z(t,e,r)},function(){n.x=this.attr("cx"),n.y=this.attr("cy")},function(){})};"ln"==t.NodeType?(t.onCreateBoxPnt=function(t){if(e.previewMk||e.config.disDragble)return null;t.data("pcode");var o=t.data("posi");"f"==o?n(t):"t"==o&&i(t)},t.c.click(function(){e.removeAllSeled(),t.select()})):(t.c.click(function(){e.removeAllSeled(),t.select()}),t.onCreateBoxPnt=function(o){if(e.previewMk||e.config.disDragble)return null;o.data("pcode");var r=o.data("posi"),a="f"+(2*(2+t.opt.MPs.length)-2);if("f0"==r)n(o);else if(a==r)i(o);else{var c,h={x:0,y:0},l={},u=-1,f=-1;o.drag(function(t,e){t+=h.x,e+=h.y;var o=p.path2ps(c),n=o.length,i=o[0],r=o[n-1],a=[i];i.x==r.x||i.y==r.y?i.x==r.x?a.push({x:t,y:i.y},{x:t,y:r.y}):a.push({x:i.x,y:e},{x:r.x,y:e}):a.push({x:t,y:i.y},{x:t,y:e},{x:r.x,y:e}),a.push(r),c.attr("path",p.ps2Path(a))},function(){h.x=this.attr("cx"),h.y=this.attr("cy"),l=t.getFocusPoint();var o=parseInt(r.replace("f","")),n="f"+(u=o-1),i="f"+(f=o+1),s=l[n],d=l[r],y=l[i];"f0"==n&&(s=p.middP(s,d)),a==i&&(y=p.middP(d,y)),c=this.paper.path(p.ps2Path([s,d,y])).attr("stroke","#00FF00"),e.rmTempElem("ln_ploy_point"),e.tmpMapRElm.ln_ploy_point=c},function(){var o=p.path2ps(c),n=[],i=!1;s.each(l,function(t,e){var r=parseInt(t.replace("f",""));r>=u&&r<=f?i||(n=n.concat(n,o),i=!0):n.push(e)});var r=s.subArray(n,1,-1);t.updAttr({MPs:r}),t.select(),e.rmTempElem("ln_ploy_point")})}}),t.c.hover(function(){var e=o.lnHover||"#FF0000";this.attr("stroke-width","4px").attr("stroke",e),t.inlineEle&&t.inlineEle.attr("fill",e).attr("stroke",e).attr("stroke-width","4px")},function(){t.opt.bkg;this.attr("stroke-width","2px").attr("stroke",t.opt.bkg),t.inlineEle&&(t.inlineEle.attr("fill",t.opt.bkg),t.inlineEle.attr("stroke",t.opt.bkg))})}},t.prototype._baseNodeBindEvt=function(t){this._nodeToolTip(t)},t.prototype._order=function(t,e,o){var n;if(e=e||"",t&&void 0!==this.idxDick[t])switch(this.idxDick[t]+=1,n=o||e+this.idxDick[t],t){case"c":this.connDick[n]&&(n=this._order(t,e));break;case"n":this.nodeDick[n]&&(n=this._order(t,e));break;case"t":this.textDick[n]&&(n=this._order(t,e))}return n},t.prototype._domListener=function(){var t=this.config.dom,e=this;t.find("svg").dblclick(function(){e.removeAllSeled()})},t.prototype._nodeToolTip=function(t){if(!this.config.closeToolTip&&t){var e=this;t.c.hover(function(){var o=t.textTip;if(o){var n=e.getDomOffset();e.tooltip(o,this.attr("x")+n.left+20,this.attr("y")+n.top+2)}},function(){e.tooltip("")})}},t.prototype._readonly=function(){this.config.readonly&&(this.config.noToolBar=!0,this.config.disEpDragble=!0,this.config.disConnNode=!0,this.config.disDragble=!0)},t.prototype._clearMagnCoreHistory=function(){var t=this;s.each(this._magnCoreHistory,function(e,o){o.remove(),delete t._magnCoreHistory[e]})},t.prototype.removeAllSeled=function(t){var e=this;(t=t?"object"==typeof t?t:[t]:"")||(t=["c","t","n"]),s.each(t,function(t,o){!function(t){s.each(t,function(t,e){e.isSelEd&&e.removeBox()})}("c"==o||"conn"==o?e.connDick:"t"==o||"text"==o?e.textDick:e.nodeDick)}),this.rmTempElem("allBorde"),this._clearMagnCoreHistory()},t.prototype.allSelect=function(){if(this.allNdSeled(),!this.previewMk){var t=this.getAllSelPs(),e=t.x,o=t.y,n=t.w,i=t.h,r=this;this.rmTempElem("allBorde");var a={x:0,y:0},c={},h=this.paper.rect(e,o,n,i).attr("fill-opacity",.75).attr("fill","#9999FF").dblclick(function(){r.removeAllSeled()}).drag(function(t,e){this.attr("x",a.x+t),this.attr("y",a.y+e),s.each(r.nodeDick,function(o,n){var i=c[o];n.updAttr({cx:i.x+t,cy:i.y+e}),n.select()}),r.allNdSeled("conn")},function(){a.x=this.attr("x"),a.y=this.attr("y"),s.each(r.nodeDick,function(t,e){var o=e.opt;c[t]={x:o.cx,y:o.cy}})},function(){});this.tmpMapRElm.allBorde=h}},t.prototype.getAllSelPs=function(){var t,e=0,o=0,n=0,i=0;s.each(this.nodeDick,function(r,a){a.c;var c=a.getBBox().attr,s=c.x,h=c.y,p=c.width,l=h,u=h+c.height,f=s,d=s+p;t||(t=a.feature("boxPadding",null,3)),0==e&&(e=l),0==o&&(o=u),0==n&&(n=f),0==i&&(i=d),e>l&&(e=l),o<u&&(o=u),n>f&&(n=f),i<d&&(i=d)});var r=n,a=e,c=Math.abs(n-i),h=Math.abs(e-o),p=2*(t*=2);return{x:r-t,y:a-t,w:c+p,h:h+p}},t.prototype.allNdSeled=function(t){var e=this;t=t?"object"==typeof t?t:[t]:["c","t","n"],s.each(t,function(t,o){var n={};n="c"==o||"conn"==o?e.connDick:"t"==o||"text"==o?e.textDick:e.nodeDick,s.each(n,function(t,e){e.select()})})},t.prototype.rmAllNode=function(){var t=this;s.each(this.nodeDick,function(e,o){t.remove(o)})},t.prototype.rmAllLine=function(){var t=this;s.each(this.connDick,function(e,o){t.remove(o)})},t.prototype.rmAllText=function(){var t=this;s.each(this.textDick,function(e,o){t.remove(o)})},t.prototype.allRemove=function(){this.rmAllLine(),this.rmAllNode(),this.rmAllText()},t.prototype.allBackground=function(t){s.each(this.nodeDick,function(e,o){o.background(t)})},t.prototype.rmTempElem=function(t,e){var o=this;t&&!e?this.tmpMapRElm[t]&&this.tmpMapRElm[t].remove():s.each(this.tmpMapRElm,function(n,i){e&&t?n.indexOf(t)>-1&&o.rmTempElem(n):o.rmTempElem(n)})},t.prototype.last=function(){var t=null;for(var e in this.nodeDick)t=this.nodeDick[e];return t},t.prototype.remove=function(t){var e,o=this,n=!1;if(e=function(t){if(t){var i=t.NodeType,r=t.code;if("ln"==i||"ln_poly"==i){var a=t.data("from_code"),c=t.data("to_code"),h=o.nodeDick[a],p=o.nodeDick[c];h&&h.rmLine(r),p&&p.rmLine(r,!0)}if("node"==o.getNdType(t)){var l=t.conLns;s.each(l.from,function(t,n){e(o.connDick[n])}),s.each(l.to,function(t,n){e(o.connDick[n])})}t.delete(),o.nodeDick[r]?delete o.nodeDick[r]:o.connDick[r]?delete o.connDick[r]:o.textDick[r]&&delete o.textDick[r],n=!0;var u=o.last();u&&u.select()}},t)e("object"==typeof t?t:this.nodeDick[t]);else{var i=this.selectGroup(),r=i.node,a=i.text,c=i.conn,h=function(t){s.each(t,function(t,o){e(o)})};h(r),h(a),h(c)}return n},t.prototype.getNdType=function(t){var e;return"object"==typeof t&&(t=t.code),t&&(this.nodeDick[t]?e="node":this.connDick[t]?e="conn":this.textDick[t]&&(e="text")),e},t.prototype.tab=function(t){var e=this,o=this.select(),n=o?o.code:null,i=!1,r=!1,a=o?o.NodeType:"",c=function(t,a){return o?i?(e.removeAllSeled(),a.select(),r=!0,!1):void(n==a.code&&(i=!0)):(a.select(),r=!0,!1)};if("c"==t)!a||"ln"==a&&"ln_poly"==a||this.removeAllSeled(),s.each(this.connDick,function(t,e){return c(0,e)});else if("t"==t)a&&"text"!=a&&this.removeAllSeled(),s.each(this.textDick,function(t,e){return c(0,e)});else{var h=!1;a&&("ln"==a||"ln_poly"==a?h=!0:"text"==a&&(h=!0)),h&&this.removeAllSeled(),s.each(this.nodeDick,function(t,e){return c(0,e)})}i&&!r&&(this.removeAllSeled(),this.tab(t))},t.prototype.clone=function(t){var e,o,n=this;if(e=t&&"string"==typeof t?this.nodeDick[t]:t&&"object"==typeof t?t:this.select()){var i=s.clone(e.opt);if(i.cx+=.2*i.w,i.cy+=.2*i.h,o=this.ndMer.make(e.NodeType,i).creator().moveable({beforeMv:function(t){if(n.previewMk)return!1},afterUpd:function(t,e,o){n._lineMoveSync(t,e,o),n.onNodeResize()}}),this.removeAllSeled(),o.select(),this._nodeBindEvt(o),"text"==o.NodeType){var r=this._order("t","T");o.data("_code",r),this.textDick[r]=o}else{var a=this._order("n","A");o.data("_code",a),this.nodeDick[a]=o}}return o},t.prototype.paste=function(t){var e=this,o=this;return t="object"==typeof t?t:[],s.each(t,function(t,n){var i=n.code,r=n.opt,a=n.NodeType,c=n.type;r.cx+=.2*r.w,r.cy+=.2*r.h;var h=e.ndMer.make(a,r).creator();if("node"==c){h.moveable({beforeMv:function(t){if(o.previewMk)return!1},afterUpd:function(t,e,n){o._lineMoveSync(t,e,n),o.onNodeResize()}});var p=e._order("n","A",i);h.data("_code",p),e._nodeBindEvt(h),e.nodeDick[p]=h}else if("conn"==c){var l=e._order("c","C",i);h.data("_code",l),s.each(n.data,function(t,e){var n;switch(t){case"from_code":(n=o.nodeDick[e])&&n.line(l);break;case"to_code":(n=o.nodeDick[e])&&n.line(l,!0)}}),e._lineBindEvt(h),e.connDick[l]=h}else if("text"==c){p=e._order("t","T",i);h.data("_code",p),e.textDick[p]=h}h.data(n.data)}),this},t.prototype.copy=function(){var t=[],e=this.config.bkg||{},o=e.urunNd||"#CDC5BF",n=e.urunTxt||"#000000",i=!1,r=function(e,r,a){var c=s.clone(a.opt),h=a.NodeType,p=a.data();p.state&&c.bkg?(delete p.state,c.bkg=o,c.bkgTxt=n,i=!0):i&&"conn"==r&&(c.bkg=o),t.push({code:e,opt:c,NodeType:h,type:r,data:p})};return s.each(this.nodeDick,function(t,e){e.isSelEd&&r(t,"node",e)}),s.each(this.connDick,function(t,e){e.isSelEd&&r(t,"conn",e)}),s.each(this.textDick,function(t,e){e.isSelEd&&r(t,"text",e)}),t},t.prototype.select=function(){var t=null;return s.each(this.nodeDick,function(e,o){if(o.isSelEd)return t=o,!1}),t||s.each(this.connDick,function(e,o){if(o.isSelEd)return t=o,!1}),t||s.each(this.textDick,function(e,o){if(o.isSelEd)return t=o,!1}),t},t.prototype.selectGroup=function(){var t={node:[],conn:[],text:[]};return s.each(this.nodeDick,function(e,o){o.isSelEd&&t.node.push(o)}),s.each(this.connDick,function(e,o){o.isSelEd&&t.node.push(o)}),s.each(this.textDick,function(e,o){o.isSelEd&&t.node.push(o)}),t},t.prototype.step=function(t){var e,o,n=this;if("object"!=typeof(t=t||this.select())&&(t=this.connDick[t]),t){var i=t.conLns,r=i.from,a=i.to,c=[],h=[];s.each(r,function(t,e){var o=n.connDick[e];if(o){o.data("to_code"),o.data("to_posi");h.push(o.data("to_code"))}}),s.each(a,function(t,e){var o=n.connDick[e];if(o){o.data("from_code"),o.data("from_posi");c.push(o.data("from_code"))}}),(e={}).code=t.code,e.name=t.name,e.type=t.type,e.next=h.join(","),e.prev=c.join(","),o={opt:t.opt,NodeType:t.NodeType,textTip:t.textTip};var p=this.onStep(t,e);p&&(e=p)}return{step:e,_srroo:o}},t.prototype.save=function(){var t=this,e=[],o={},n={},i={};return s.each(this.nodeDick,function(n,i){var r=t.step(i);e.push(r.step),o[n]=r._srroo}),s.each(this.connDick,function(t,e){n[t]={data:e.data(),NodeType:e.NodeType,opt:e.opt,textTip:e.textTip}}),s.each(this.textDick,function(t,e){i[t]={data:e.data(),NodeType:e.NodeType,opt:e.opt,textTip:e.textTip}}),{step:e,_srroo:{node:o,line:n,text:i}}},t.prototype.load=function(t){var e=this,o=this,n=(t.step,t._srroo),i=this.config,r=(i.rCodes,i.bkg||{});i.icon,i.icon;return s.each(n.node,function(t,n){n.opt.bkg=r.urunNd||"#CDC5BF",n.opt.bkgTxt=r.urunTxt||"#000000";var a=e.ndMer.make(n.NodeType,n.opt).creator();i.disDragble||a.moveable({beforeMv:function(t){if(o.previewMk)return!1},afterUpd:function(t,e,n){o._lineMoveSync(t,e,n);var i=a.tRElem.icon;if(i){var r=a.getIconP();i.attr({x:r.x,y:r.y})}o.onNodeResize()}}),a.data("_code",t),a.textTip=n.textTip||null,e._nodeBindEvt(a),o.nodeDick[t]=a}),s.each(n.line,function(t,n){var r=n.data,a=e.ndMer.make(n.NodeType,n.opt).creator();i.disDragble||a.moveable({beforeMv:function(t){if(o.previewMk)return!1},afterUpd:function(t,e,n){o._lineMoveSync(t,e,n)}}),a.data("_code",t),a.data(r);var c=r.from_code,s=r.to_code,h=e.nodeDick[c],p=e.nodeDick[s];e._lineBindEvt(a),e.connDick[t]=a,h&&h.line(t),p&&p.line(t,!0),a.textTip=n.textTip||null}),s.each(n.text,function(t,n){var r=n.data,a=e.ndMer.make(n.NodeType,n.opt).creator();i.disDragble||a.moveable({beforeMv:function(t){if(o.previewMk)return!1},afterUpd:function(t,e,n){o._lineMoveSync(t,e,n)}}),a.data("_code",t),a.data(r),e._nodeBindEvt(a),e.textDick[t]=a,a.textTip=n.textTip||null}),i.closeSize||this.autoSize(),i.disSR||this.stateRender(),this},t.prototype.stateRender=function(){var t=this,e=this.config,o=e.rCodes,n=this;if(o){var i=e.bkg||{},r=(i.urunNd,i.urunNd,i.runningNd||"#0000FF"),a=i.runningTxt||"#FFFFFF",c=i.ranNd||"#32CD32",h=i.ranTxt||"#FFFFFF",p=void 0===e.icon,l=e.icon||{};"object"!=typeof o&&(o=o.indexOf(",")>-1?(o=o.replace(/\s/g,"")).split(","):[o]);var u=l.state||{},f=function(e,o){if(!p){var n=o.getIconP();if(n){o.tRElem.icon=t.paper.image(e,n.x,n.y,10,10)}}},d={};s.each(this.connDick,function(t,e){var o=e.data(),n=o.from_code,i=o.to_code;n&&i&&(d[n+"_"+i]=t)}),s.each(o,function(e,i){var s=!1;i.indexOf("*")>-1&&(i=i.replace("*",""),s=!0);var p=t.nodeDick[i];if(p){s?(p.data("state","isRunning"),p.opt.bkg=r,p.opt.bkgTxt=a,p.background(["node","text"]),f(u.ran||"state_ran.png",p)):(p.data("state","isRan"),p.opt.bkg=c,p.opt.bkgTxt=h,p.background(["node","text"]),f(u.ran||"state_ran.png",p));var l=p.tRElem.icon;l&&l.hover(function(){var t="";switch(p.data("state")){case"isRan":t="已经运行";break;case"isRunning":t="正在运行中"}var e=n.getDomOffset();n.tooltip(t,this.attr("x")+e.left+20,this.attr("y")+e.top+2)},function(){n.tooltip("")});var y,v,x=e>0?o[e-1]+"_"+i:null;if(x&&(y=d[x])&&(v=t.connDick[y])){var g=s?r:c;v.opt.bkg=g,v.c.attr("stroke",g),v.inlineEle&&(v.inlineEle.attr("stroke",g),v.inlineEle.attr("fill",g)),"ln"==v.NodeType&&v.c.attr("fill",g)}}})}return this},t.prototype.removeTmpNode=function(t){var e=this;if(t){var o=[];o="object"==typeof t?t:[t],s.each(o,function(t,o){e.tmpNodeMap[o]&&(e.tmpNodeMap[o].delete(),delete e.tmpNodeMap[o])})}else s.each(this.tmpNodeMap,function(t,o){o.delete(),delete e.tmpNodeMap[t]});return this},t.prototype.collisionByP=function(t,e){var o;if("object"==typeof t){var n=t.x,i=t.y;t=n,e=i}return t&&e&&s.each(this.nodeDick,function(n,i){var r=i.getBBox(),a=r.attr,c=(r.ps,a.width),s=a.height,h=a.x,p=a.y;if(t>=h&&t<=h+c&&e>=p&&e<=p+s)return o=i,!1}),o},t.prototype.preview=function(t){t?(this.toolbarCtrl&&this.toolbarCtrl.show(),this.previewMk=!1):(this.toolbarCtrl&&this.toolbarCtrl.hide(),this.previewMk=!0)},t.prototype.tooltip=function(t,e,o){var n=$(".flowts-tip");t?(0==n.length&&(n=$('<div class="flowts-tip"></div>'),$("body").append(n)),n.show(),n.html(t),e&&o&&n.css({top:o,left:e})):n.length>0&&n.hide()},t.prototype.getDomOffset=function(){var t=this.config.dom;return{left:t[0].offsetLeft,top:t[0].offsetTop}},t.prototype.errorLine=function(t){var e=!1;t||this.removeAllSeled();var o={};return s.each(this.connDick,function(t,n){var i=n.data(),r=i.to_code,a=i.from_code;if(r&&a){var c=a+"__"+r;o[c]?(n.select(),e=!0):o[c]=!0}else n.select(),e=!0}),e},t.prototype.errorNode=function(t){var e=this,o=!1;return t||this.removeAllSeled(),s.each(this.nodeDick,function(t,n){var i=n.type;if(1!=i&&9!=i){var r=e.step(n).step;r.next&&r.prev||(n.select(),o=!0)}}),o},t.prototype.error=function(){var t=!1;this.removeAllSeled(),t=this.errorLine(!0);var e=this.errorNode(!0);return t=t||e},Object.defineProperty(t.prototype,"maxHw",{get:function(){var t={h:0,w:0};return s.each(this.nodeDick,function(e,o){var n=o.getBBox().attr,i=n.y+n.height,r=n.x+n.width;i>t.h&&(t.h=i),r>t.w&&(t.w=r)}),s.each(this.textDick,function(e,o){var n=o.getBBox().attr,i=n.y+n.height,r=n.x+n.width;i>t.h&&(t.h=i),r>t.w&&(t.w=r)}),t},enumerable:!0,configurable:!0}),t.prototype.autoSize=function(){var t=this.config,e=this.maxHw,o=t.dom.find("svg");e.w>t.w&&o.attr("width",e.w+10),e.h>t.h&&o.attr("height",e.h+10)},t.prototype.onDbClick=function(t){},t.prototype.onClick=function(t){},t.prototype.onStep=function(t,e){return e},t.prototype.onNodeResize=function(){this.autoSize()},t.version=c,t}();e.default=U}]);